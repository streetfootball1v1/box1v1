<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover"/>
<meta name="theme-color" content="#0a0a0a">
<title>BOX1V1 | УЛИЧНЫЙ ФУТБОЛ 1 НА 1</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Anton&family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #050505;
  --surface: rgba(20, 20, 20, 0.6);
  --surface-solid: #121212;
  --text: #ffffff;
  --text-secondary: #a0a0a0;
  --accent: #00ff88;
  --accent-glow: rgba(0, 255, 136, 0.4);
  --neon-pink: #ff0080;
  --neon-blue: #00f0ff;
  --neon-purple: #bd00ff;
  --border: rgba(255, 255, 255, 0.1);
  --glass: rgba(255, 255, 255, 0.03);
  --font-display: 'Anton', sans-serif;
  --font-body: 'Inter', sans-serif;
  --nav-h: 80px;
  --radius: 16px;
  --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
  --ease-elastic: cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

@media (max-width: 420px) { :root { --nav-h: 70px; } }

*, *::before, *::after { 
  margin: 0; 
  padding: 0; 
  box-sizing: border-box; 
  -webkit-tap-highlight-color: transparent; 
}

html { 
  scroll-behavior: smooth; 
  background: var(--bg); 
  -webkit-font-smoothing: antialiased; 
}

body { 
  font-family: var(--font-body); 
  background: var(--bg); 
  color: var(--text); 
  line-height: 1.6; 
  overflow-x: hidden; 
  min-height: 100vh;
  background-image: 
    radial-gradient(circle at 20% 50%, rgba(0, 255, 136, 0.15) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(255, 0, 128, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 40% 20%, rgba(0, 240, 255, 0.1) 0%, transparent 40%);
  background-attachment: fixed;
}

/* GLITCH LOGO EFFECT */
.logo {
  font-family: var(--font-display);
  font-size: 2rem;
  letter-spacing: 2px;
  text-decoration: none;
  color: var(--text);
  position: relative;
  text-transform: uppercase;
  font-weight: 400;
  display: inline-block;
  padding: 8px 0;
}

.logo-accent {
  color: var(--accent);
  text-shadow: 0 0 20px var(--accent-glow);
  animation: neonPulse 2s ease-in-out infinite;
}

@keyframes neonPulse {
  0%, 100% { text-shadow: 0 0 20px var(--accent-glow), 0 0 40px var(--accent-glow); }
  50% { text-shadow: 0 0 10px var(--accent-glow), 0 0 20px var(--accent-glow); }
}

.logo::before,
.logo::after {
  content: 'BOX1V1';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
}

.logo:hover::before {
  animation: glitch1 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both infinite;
  color: var(--neon-pink);
  z-index: -1;
  opacity: 0.8;
}

.logo:hover::after {
  animation: glitch2 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) reverse both infinite;
  color: var(--neon-blue);
  z-index: -2;
  opacity: 0.8;
}

@keyframes glitch1 {
  0% { transform: translate(0); }
  20% { transform: translate(-2px, 2px); }
  40% { transform: translate(-2px, -2px); }
  60% { transform: translate(2px, 2px); }
  80% { transform: translate(2px, -2px); }
  100% { transform: translate(0); }
}

@keyframes glitch2 {
  0% { transform: translate(0); }
  20% { transform: translate(2px, -2px); }
  40% { transform: translate(2px, 2px); }
  60% { transform: translate(-2px, -2px); }
  80% { transform: translate(-2px, 2px); }
  100% { transform: translate(0); }
}

/* NAVIGATION - GLASSMORPHISM */
nav {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: calc(var(--nav-h) + env(safe-area-inset-top));
  padding-top: env(safe-area-inset-top);
  background: rgba(5, 5, 5, 0.7);
  backdrop-filter: blur(20px) saturate(180%);
  border-bottom: 1px solid var(--border);
  z-index: 1000;
  transition: all 0.3s var(--ease-out);
}

nav.scrolled {
  background: rgba(5, 5, 5, 0.9);
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
}

.nav-inner {
  max-width: 1400px;
  margin: 0 auto;
  height: var(--nav-h);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 max(20px, env(safe-area-inset-left)) 0 max(20px, env(safe-area-inset-right));
}

.nav-links {
  display: flex;
  gap: 12px;
}

.nav-links a {
  font-family: var(--font-display);
  font-size: 14px;
  letter-spacing: 1px;
  text-transform: uppercase;
  text-decoration: none;
  color: var(--text-secondary);
  padding: 12px 24px;
  border-radius: 100px;
  border: 1px solid transparent;
  transition: all 0.3s var(--ease-out);
  position: relative;
  overflow: hidden;
}

.nav-links a::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, var(--accent), var(--neon-blue));
  opacity: 0;
  transition: opacity 0.3s;
  z-index: -1;
}

.nav-links a:hover,
.nav-links a.active {
  color: var(--bg);
  border-color: var(--accent);
  transform: translateY(-2px);
  box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
}

.nav-links a:hover::before,
.nav-links a.active::before {
  opacity: 1;
}

/* BURGER */
.burger {
  display: none;
  cursor: pointer;
  width: 48px;
  height: 48px;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 6px;
  background: var(--glass);
  border: 1px solid var(--border);
  border-radius: 12px;
  transition: all 0.3s;
}

.burger span {
  width: 24px;
  height: 2px;
  background: var(--accent);
  border-radius: 2px;
  transition: all 0.3s var(--ease-elastic);
  box-shadow: 0 0 10px var(--accent-glow);
}

.burger.open span:nth-child(1) { transform: translateY(8px) rotate(45deg); }
.burger.open span:nth-child(2) { opacity: 0; transform: scaleX(0); }
.burger.open span:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }

/* DRAWER */
.drawer-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(10px);
  z-index: 1999;
  opacity: 0;
  visibility: hidden;
  transition: all 0.4s var(--ease-out);
}

.drawer-overlay.open {
  opacity: 1;
  visibility: visible;
}

.mobile-drawer {
  position: fixed;
  top: 0;
  right: -100%;
  width: min(86%, 380px);
  height: 100dvh;
  background: var(--surface-solid);
  z-index: 2000;
  padding: calc(env(safe-area-inset-top) + 20px) 24px calc(env(safe-area-inset-bottom) + 24px);
  display: flex;
  flex-direction: column;
  gap: 8px;
  transition: right 0.5s var(--ease-elastic);
  border-left: 1px solid var(--border);
  box-shadow: -20px 0 60px rgba(0, 255, 136, 0.1);
}

.mobile-drawer.open { right: 0; }
.mobile-drawer a {
  font-family: var(--font-display);
  font-size: 2rem;
  text-decoration: none;
  color: var(--text);
  text-transform: uppercase;
  letter-spacing: 2px;
  padding: 20px 0;
  border-bottom: 1px solid var(--border);
  transition: all 0.3s;
  opacity: 0;
  transform: translateX(20px);
}

.mobile-drawer.open a {
  opacity: 1;
  transform: translateX(0);
  transition-delay: calc(var(--i, 0) * 0.1s);
}

.mobile-drawer a:hover {
  color: var(--accent);
  padding-left: 10px;
  text-shadow: 0 0 20px var(--accent-glow);
}

/* MAIN */
.main-content {
  max-width: 1400px;
  margin: 0 auto;
  padding: calc(var(--nav-h) + 40px) max(20px, env(safe-area-inset-left)) calc(100px + env(safe-area-inset-bottom)) max(20px, env(safe-area-inset-right));
  min-height: 100vh;
}

section {
  display: none;
  opacity: 0;
  transform: translateY(40px);
  animation: fadeInUp 0.8s var(--ease-out) forwards;
}

section.active {
  display: block;
}

@keyframes fadeInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* INTRO - BRUTAL TYPOGRAPHY */
.intro-block {
  padding: 80px 0 120px;
  text-align: center;
  position: relative;
}

.intro-block span {
  display: inline-block;
  font-family: var(--font-display);
  font-size: 14px;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: var(--accent);
  margin-bottom: 32px;
  padding: 8px 20px;
  border: 1px solid var(--accent);
  border-radius: 100px;
  box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
  animation: float 6s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.intro-block h1 {
  font-family: var(--font-display);
  font-size: clamp(4rem, 15vw, 12rem);
  line-height: 0.9;
  margin-bottom: 32px;
  background: linear-gradient(135deg, #fff 0%, var(--accent) 50%, var(--neon-blue) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-transform: uppercase;
  letter-spacing: 4px;
  position: relative;
  display: inline-block;
}

.intro-block h1::after {
  content: 'BOX1V1';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  background: none;
  -webkit-text-fill-color: transparent;
  text-shadow: 
    2px 2px 0 var(--neon-pink),
    -2px -2px 0 var(--neon-blue);
  opacity: 0.3;
  animation: glitchText 3s infinite;
}

@keyframes glitchText {
  0%, 90%, 100% { opacity: 0; transform: translate(0); }
  92% { opacity: 0.3; transform: translate(-2px, 2px); }
  94% { opacity: 0.3; transform: translate(2px, -2px); }
  96% { opacity: 0; transform: translate(0); }
}

.intro-block p {
  font-size: clamp(1.25rem, 3vw, 1.75rem);
  color: var(--text-secondary);
  max-width: 600px;
  margin: 0 auto 48px;
  font-weight: 600;
}

/* BUTTONS - NEON */
.btn {
  padding: 20px 40px;
  border-radius: 100px;
  font-family: var(--font-display);
  font-size: 14px;
  letter-spacing: 2px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s var(--ease-out);
  border: none;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  position: relative;
  overflow: hidden;
  min-height: 60px;
  font-weight: 400;
}

.btn-primary {
  background: var(--accent);
  color: var(--bg);
  box-shadow: 
    0 0 20px var(--accent-glow),
    0 0 40px var(--accent-glow),
    inset 0 1px 0 rgba(255,255,255,0.3);
}

.btn-primary:hover {
  transform: translateY(-3px) scale(1.02);
  box-shadow: 
    0 0 30px var(--accent-glow),
    0 0 60px var(--accent-glow),
    0 10px 40px rgba(0,0,0,0.4);
}

.btn-outline {
  background: transparent;
  color: var(--text);
  border: 2px solid var(--text);
  box-shadow: 0 0 20px rgba(255,255,255,0.1);
}

.btn-outline:hover {
  background: var(--text);
  color: var(--bg);
  border-color: var(--text);
  box-shadow: 0 0 30px rgba(255,255,255,0.3);
  transform: translateY(-3px);
}

/* STATUS - ALERT BOX */
.status-context {
  margin-top: 80px;
  padding: 32px 48px;
  background: var(--surface);
  border: 1px solid var(--accent);
  border-radius: 24px;
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  box-shadow: 
    0 0 40px rgba(0, 255, 136, 0.2),
    inset 0 1px 0 rgba(255,255,255,0.1);
  position: relative;
  overflow: hidden;
}

.status-context::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, var(--accent) 0%, transparent 50%, var(--neon-blue) 100%);
  opacity: 0.1;
  pointer-events: none;
}

.status-label {
  font-family: var(--font-display);
  font-size: 12px;
  letter-spacing: 3px;
  color: var(--accent);
  text-transform: uppercase;
}

.status-text {
  font-family: var(--font-display);
  font-size: clamp(1.5rem, 4vw, 2.5rem);
  color: var(--text);
  letter-spacing: 2px;
}

.beta-badge {
  display: inline-block;
  background: var(--neon-pink);
  color: white;
  font-size: 10px;
  font-weight: 900;
  padding: 4px 12px;
  border-radius: 100px;
  margin-left: 12px;
  text-transform: uppercase;
  letter-spacing: 1px;
  box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
  animation: pulseBadge 2s infinite;
}

@keyframes pulseBadge {
  0%, 100% { box-shadow: 0 0 20px rgba(255, 0, 128, 0.5); }
  50% { box-shadow: 0 0 30px rgba(255, 0, 128, 0.8); }
}

/* BENTO GRID - GLASS CARDS */
.bento-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 24px;
  margin-top: 60px;
}

.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 40px;
  position: relative;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.4s var(--ease-out);
  backdrop-filter: blur(10px);
}

.card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 100%);
  opacity: 0;
  transition: opacity 0.3s;
}

.card:hover {
  transform: translateY(-8px) scale(1.02);
  border-color: var(--accent);
  box-shadow: 
    0 20px 60px rgba(0,0,0,0.5),
    0 0 40px rgba(0, 255, 136, 0.2);
}

.card:hover::before {
  opacity: 1;
}

.card h2, .card h3 {
  font-family: var(--font-display);
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 16px;
}

.card h2 {
  font-size: clamp(2.5rem, 5vw, 4rem);
  background: linear-gradient(135deg, #fff, var(--neon-blue));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.card p {
  color: var(--text-secondary);
  font-size: 1rem;
  line-height: 1.6;
}

/* PLAYER CARDS - BRUTAL STYLE */
.player-card {
  min-height: 520px;
  background: linear-gradient(180deg, rgba(20,20,20,0.8) 0%, rgba(0,0,0,0.9) 100%);
  border: 1px solid var(--border);
  padding: 0;
  display: flex;
  flex-direction: column;
  position: relative;
  overflow: hidden;
}

.player-card::after {
  content: '';
  position: absolute;
  inset: 0;
  border: 2px solid transparent;
  border-radius: var(--radius);
  transition: all 0.3s;
  pointer-events: none;
}

.player-card:hover::after {
  border-color: var(--accent);
  box-shadow: inset 0 0 40px rgba(0, 255, 136, 0.2);
}

.player-img {
  position: absolute;
  inset: 0;
  background-size: cover;
  background-position: center top;
  opacity: 1;
  filter: contrast(1.1) saturate(1.2);
  transition: all 0.5s var(--ease-out);
  z-index: 0;
}

/* УБРАНО ЗАТЕМНЕНИЕ - вместо него градиент снизу */
.player-card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(to top, 
    rgba(0,0,0,0.95) 0%, 
    rgba(0,0,0,0.6) 40%, 
    transparent 70%);
  z-index: 1;
  pointer-events: none;
}

.player-card:hover .player-img {
  transform: scale(1.1);
  filter: contrast(1.2) saturate(1.4);
}

.player-info {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 32px;
  z-index: 2;
  transform: translateY(20px);
  transition: transform 0.3s var(--ease-out);
}

.player-card:hover .player-info {
  transform: translateY(0);
}

.player-info span {
  font-family: var(--font-display);
  font-size: 12px;
  letter-spacing: 3px;
  color: var(--accent);
  text-transform: uppercase;
  display: block;
  margin-bottom: 8px;
  text-shadow: 0 0 10px var(--accent-glow);
}

.player-info h3 {
  font-family: var(--font-display);
  font-size: clamp(2rem, 4vw, 2.5rem);
  color: white;
  margin: 0;
  letter-spacing: 1px;
  text-shadow: 0 2px 10px rgba(0,0,0,0.8);
}

.player-badges {
  font-size: 11px;
  color: var(--neon-pink);
  margin-top: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.ovr-badge {
  position: absolute;
  top: 20px;
  right: 20px;
  background: var(--accent);
  color: var(--bg);
  font-family: var(--font-display);
  font-size: 20px;
  padding: 12px 20px;
  border-radius: 12px;
  font-weight: 400;
  letter-spacing: 1px;
  box-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
  z-index: 3;
  transform: rotate(3deg);
  transition: transform 0.3s var(--ease-elastic);
}

.player-card:hover .ovr-badge {
  transform: rotate(0) scale(1.1);
}

/* TABLE - DARK MODE */
.table-wrapper {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  backdrop-filter: blur(10px);
}

table {
  width: 100%;
  border-collapse: collapse;
  min-width: 400px;
}

th {
  font-family: var(--font-display);
  font-size: 12px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--accent);
  padding: 24px;
  text-align: left;
  border-bottom: 1px solid var(--border);
  background: rgba(0, 255, 136, 0.05);
}

td {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border);
  color: var(--text-secondary);
  transition: all 0.3s;
}

tbody tr {
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
}

tbody tr:hover {
  background: rgba(0, 255, 136, 0.05);
  color: var(--text);
}

tbody tr:hover td {
  color: var(--text);
}

.player-avatar-sm {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--border);
  transition: all 0.3s;
}

tbody tr:hover .player-avatar-sm {
  border-color: var(--accent);
  box-shadow: 0 0 20px var(--accent-glow);
}

.player-name-sm {
  font-family: var(--font-display);
  font-size: 16px;
  color: var(--text);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* MODAL - GLASS */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(20px);
  z-index: 3000;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
  opacity: 0;
  visibility: hidden;
  transition: all 0.4s var(--ease-out);
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background: var(--surface-solid);
  border: 1px solid var(--border);
  width: 100%;
  max-width: 560px;
  border-radius: 32px;
  padding: 48px;
  position: relative;
  max-height: 90dvh;
  overflow-y: auto;
  box-shadow: 
    0 40px 80px rgba(0,0,0,0.8),
    0 0 60px rgba(0, 255, 136, 0.1);
  transform: scale(0.9) translateY(40px);
  transition: all 0.5s var(--ease-elastic);
}

.modal-overlay.active .modal-content {
  transform: scale(1) translateY(0);
}

.modal-header-fixed {
  position: absolute;
  top: 20px;
  right: 20px;
  display: flex;
  gap: 12px;
  z-index: 10;
}

.modal-close, .download-circle {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border: 1px solid var(--border);
  background: rgba(255,255,255,0.05);
  color: var(--text);
  transition: all 0.3s;
}

.modal-close:hover, .download-circle:hover {
  background: var(--accent);
  color: var(--bg);
  border-color: var(--accent);
  transform: scale(1.1) rotate(90deg);
  box-shadow: 0 0 30px var(--accent-glow);
}

#m-img-container {
  width: 100%;
  aspect-ratio: 1;
  border-radius: 24px;
  overflow: hidden;
  margin-bottom: 32px;
  margin-top: 60px;
  position: relative;
  border: 2px solid var(--border);
  background: var(--bg);
}

#m-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  filter: contrast(1.1) saturate(1.2);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 32px;
}

#m-role {
  font-family: var(--font-display);
  font-size: 12px;
  letter-spacing: 3px;
  color: var(--accent);
  text-transform: uppercase;
  display: inline-block;
  margin-bottom: 8px;
  padding: 6px 16px;
  border: 1px solid var(--accent);
  border-radius: 100px;
}

#m-name {
  font-family: var(--font-display);
  font-size: clamp(2rem, 5vw, 3rem);
  text-transform: uppercase;
  letter-spacing: 2px;
  line-height: 1;
}

#m-ovr {
  font-family: var(--font-display);
  font-size: 4rem;
  color: var(--accent);
  text-shadow: 0 0 30px var(--accent-glow);
  line-height: 1;
}

.stat-bar-bg {
  height: 8px;
  background: rgba(255,255,255,0.1);
  border-radius: 100px;
  overflow: hidden;
  position: relative;
}

.stat-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--neon-blue));
  border-radius: 100px;
  width: 0%;
  transition: width 1s var(--ease-out);
  box-shadow: 0 0 20px var(--accent-glow);
}

/* CONTROLS */
.controls-row {
  margin-bottom: 40px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 20px;
}

.search-input {
  padding: 16px 28px;
  border-radius: 100px;
  border: 1px solid var(--border);
  background: rgba(255,255,255,0.05);
  width: 100%;
  max-width: 400px;
  font-family: var(--font-body);
  font-size: 16px;
  color: var(--text);
  transition: all 0.3s;
}

.search-input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 30px rgba(0, 255, 136, 0.2);
  background: rgba(255,255,255,0.08);
}

.search-input::placeholder {
  color: var(--text-secondary);
}

.filter-btn {
  padding: 12px 24px;
  border-radius: 100px;
  border: 1px solid var(--border);
  background: rgba(255,255,255,0.05);
  font-family: var(--font-display);
  font-size: 12px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.3s;
}

.filter-btn:hover, .filter-btn.active {
  background: var(--accent);
  color: var(--bg);
  border-color: var(--accent);
  box-shadow: 0 0 20px var(--accent-glow);
}

/* TOAST */
#toast-container {
  position: fixed;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10001;
  display: flex;
  flex-direction: column;
  gap: 12px;
  pointer-events: none;
}

.toast {
  background: var(--surface-solid);
  border: 1px solid var(--accent);
  color: var(--accent);
  padding: 16px 32px;
  border-radius: 100px;
  font-family: var(--font-display);
  font-weight: 400;
  letter-spacing: 1px;
  text-transform: uppercase;
  box-shadow: 0 0 40px rgba(0, 255, 136, 0.3);
  animation: slideUp 0.4s var(--ease-out);
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px) translateX(-50%);
  }
  to {
    opacity: 1;
    transform: translateY(0) translateX(-50%);
  }
}

/* SCROLLBAR */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg);
}

::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--neon-blue);
}

/* MOBILE */
@media (max-width: 1024px) {
  .bento-grid { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 768px) {
  .nav-links { display: none; }
  .burger { display: flex; }
  
  .bento-grid {
    grid-template-columns: 1fr;
    gap: 20px;
  }
  
  .card[style*="grid-column: span 2"] {
    grid-column: span 1 !important;
  }
  
  .player-card {
    min-height: 400px;
  }
  
  .modal-content {
    padding: 32px 24px;
    margin: 10px;
    width: calc(100% - 20px);
  }
  
  #m-ovr {
    font-size: 3rem;
  }
}

/* ANIMATION CLASSES */
.reveal {
  opacity: 0;
  transform: translateY(30px);
  transition: all 0.6s var(--ease-out);
}

.reveal.active {
  opacity: 1;
  transform: translateY(0);
}

/* PRELOADER */
#preloader {
  position: fixed;
  inset: 0;
  background: var(--bg);
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: opacity 0.6s, visibility 0.6s;
}

#preloader.loaded {
  opacity: 0;
  visibility: hidden;
}

.preloader-logo {
  font-family: var(--font-display);
  font-size: clamp(3rem, 10vw, 6rem);
  color: var(--accent);
  letter-spacing: 10px;
  animation: neonFlicker 1.5s infinite alternate;
}

@keyframes neonFlicker {
  0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
    text-shadow:
      0 0 40px var(--accent-glow),
      0 0 80px var(--accent-glow),
      0 0 120px var(--accent-glow);
    opacity: 1;
  }
  20%, 24%, 55% {
    text-shadow: none;
    opacity: 0.8;
  }
}

/* Error states dark */
.error-container {
  text-align: center;
  padding: 60px 20px;
  border: 2px dashed var(--neon-pink);
  border-radius: var(--radius);
  background: rgba(255, 0, 128, 0.05);
}

.error-title {
  font-family: var(--font-display);
  font-size: 1.5rem;
  color: var(--neon-pink);
  margin-bottom: 12px;
  text-transform: uppercase;
}

.error-retry {
  background: transparent;
  border: 2px solid var(--accent);
  color: var(--accent);
  padding: 12px 32px;
  border-radius: 100px;
  font-family: var(--font-display);
  text-transform: uppercase;
  letter-spacing: 2px;
  cursor: pointer;
  transition: all 0.3s;
  margin-top: 20px;
}

.error-retry:hover {
  background: var(--accent);
  color: var(--bg);
  box-shadow: 0 0 30px var(--accent-glow);
}
</style>
</head>
<body>

<div id="preloader">
  <div class="preloader-logo">BOX<span style="color: var(--neon-pink);">1</span>V1</div>
</div>

<div id="toast-container"></div>

<nav id="navbar">
  <div class="nav-inner">
    <a href="#home" class="logo" onclick="App.switchTab('home'); return false;">
      BOX<span class="logo-accent">1</span>V1
    </a>
    <div class="nav-links">
      <a href="#home" onclick="App.switchTab('home'); return false;" id="btn-home" class="active">Главная</a>
      <a href="#roster" onclick="App.switchTab('roster'); return false;" id="btn-roster">Участники</a>
      <a href="#stats" onclick="App.switchTab('stats'); return false;" id="btn-stats">Рейтинг</a>
    </div>
    <button class="burger" id="burger" onclick="App.toggleMenu()" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
  </div>
</nav>

<div class="drawer-overlay" id="drawer-overlay" onclick="App.toggleMenu()"></div>
<div class="mobile-drawer" id="mobile-drawer">
  <div style="margin-bottom: 40px;">
    <span class="logo">BOX<span class="logo-accent">1</span>V1</span>
  </div>
  <a href="#home" onclick="App.handleMobileNav('home')" style="--i:1">Главная</a>
  <a href="#roster" onclick="App.handleMobileNav('roster')" style="--i:2">Участники</a>
  <a href="#stats" onclick="App.handleMobileNav('stats')" style="--i:3">Рейтинг</a>
  <div class="btn-group" style="margin-top: auto;">
    <button class="btn btn-primary" onclick="App.handleMobileNav('applyModal', true)" style="width:100%">Вступить</button>
  </div>
</div>

<main class="main-content">
  <section id="home" class="active">
    <div class="intro-block">
      <span>Street Football • 1v1</span>
      <h1>BOX1V1</h1>
      <p>Решает не команда.<br>Решаешь ты.</p>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="App.switchTab('roster')">Смотреть игроков</button>
        <button class="btn btn-outline" onclick="App.openModal('applyModal')">Стать частью</button>
      </div>
      
      <div class="status-context">
        <div class="status-label">Статус</div>
        <div class="status-text">
          Набор открыт
          <span class="beta-badge">Beta</span>
        </div>
      </div>
    </div>

    <div class="bento-grid">
      <div class="card" style="grid-column: span 2;" onclick="App.openModal('rulesModal')">
        <span style="color: var(--neon-blue); font-family: var(--font-display); letter-spacing: 2px;">Документация</span>
        <h2>РЕГЛАМЕНТ</h2>
        <p>Правила игры в коробе. Читать обязательно.</p>
        <div style="margin-top: auto; padding-top: 30px; font-family: var(--font-display); color: var(--accent); letter-spacing: 1px;">
          Читать правила →
        </div>
      </div>
      
      <div class="card" onclick="window.open('https://t.me/streetbox1v1', '_blank')">
        <h3 style="color: var(--neon-blue);">TELEGRAM</h3>
        <p>Все анонсы и свежие новости проекта.</p>
      </div>
      
      <div class="card" onclick="window.open('https://instagram.com/box.1v1', '_blank')">
        <h3 style="color: var(--neon-pink);">INSTAGRAM</h3>
        <p>Фото и видео с игр. Контент everyday.</p>
      </div>
    </div>
  </section>

  <section id="roster">
    <div style="margin-bottom: 60px;">
      <h1 style="font-family: var(--font-display); font-size: clamp(3rem, 12vw, 8rem); letter-spacing: 4px;">
        УЧАСТНИКИ<span class="beta-badge">Предв.</span>
      </h1>
      <p style="color: var(--text-secondary); margin-top: 16px; font-size: 1.25rem;">Кто играет в BOX1V1</p>
    </div>
    
    <div class="controls-row">
      <input type="search" class="search-input" id="playerSearch" placeholder="Поиск по имени...">
      <div class="filter-bar">
        <button class="filter-btn active" data-role="Все">Все</button>
        <button class="filter-btn" data-role="Игрок">Полевые</button>
        <button class="filter-btn" data-role="Вратарь">Вратари</button>
      </div>
    </div>
    
    <div class="bento-grid" id="roster-grid"></div>
  </section>

  <section id="stats">
    <h1 style="font-family: var(--font-display); font-size: clamp(3rem, 12vw, 8rem); letter-spacing: 4px; margin-bottom: 40px;">
      РЕЙТИНГ<span class="beta-badge">Предв.</span>
    </h1>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Игрок</th>
            <th style="text-align:right;">OVR</th>
          </tr>
        </thead>
        <tbody id="stats-body"></tbody>
      </table>
    </div>
  </section>
</main>

<!-- MODALS -->

<div class="modal-overlay" id="playerModal" onclick="if(event.target === this) App.closeModal('playerModal')">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header-fixed">
      <button class="download-circle" id="download-card" title="Скачать карточку">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
      </button>
      <button class="modal-close" onclick="App.closeModal('playerModal')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <div id="m-img-container">
      <img id="m-img" src="" alt="">
    </div>
    
    <div class="modal-header">
      <div>
        <div id="m-role">ROLE</div>
        <h2 id="m-name" style="margin-top: 8px;">NAME</h2>
        <div id="m-badges" style="margin-top: 12px;"></div>
      </div>
      <div id="m-ovr">99</div>
    </div>
    
    <div id="m-stats" style="margin-bottom: 24px;"></div>
    
    <div style="display: flex; gap: 12px;">
      <button class="btn btn-primary" style="flex:1;" onclick="App.copyPlayerID()">Копировать ID</button>
      <button class="btn btn-outline" style="flex:1;" onclick="App.sharePlayer()">Поделиться</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="applyModal" onclick="if(event.target === this) App.closeModal('applyModal')">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header-fixed">
      <button class="modal-close" onclick="App.closeModal('applyModal')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <h2 style="font-family: var(--font-display); font-size: 2.5rem; margin-bottom: 20px; margin-top: 40px; letter-spacing: 2px;">ВСТУПИТЬ</h2>
    <p style="color: var(--text-secondary); line-height: 1.8; margin-bottom: 32px;">
      Оставь комментарий под постом в Telegram с хештегом <strong style="color: var(--accent);">#BOXУЧАСТВОВАТЬ</strong>. Мы проверим твою заявку и свяжемся.
    </p>
    <button class="btn btn-primary" style="width:100%" onclick="window.open('https://t.me/streetbox1v1', '_blank')">Открыть Telegram</button>
  </div>
</div>

<div class="modal-overlay" id="rulesModal" onclick="if(event.target === this) App.closeModal('rulesModal')">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header-fixed">
      <button class="modal-close" onclick="App.closeModal('rulesModal')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <h2 style="font-family: var(--font-display); font-size: 2.5rem; margin-bottom: 40px; margin-top: 40px; letter-spacing: 2px;">РЕГЛАМЕНТ</h2>
    
    <div style="display: flex; flex-direction: column; gap: 32px;">
      <div style="border-left: 3px solid var(--accent); padding-left: 20px;">
        <h3 style="font-family: var(--font-display); color: var(--accent); margin-bottom: 8px; letter-spacing: 2px;">01. ФОРМАТ</h3>
        <p style="color: var(--text-secondary); line-height: 1.6;">Матчи 1 на 1 с вратарем. Чистый скилл, никаких отмазок.</p>
      </div>
      <div style="border-left: 3px solid var(--neon-blue); padding-left: 20px;">
        <h3 style="font-family: var(--font-display); color: var(--neon-blue); margin-bottom: 8px; letter-spacing: 2px;">02. ВРЕМЯ</h3>
        <p style="color: var(--text-secondary); line-height: 1.6;">20 секунд на атаку. Думай быстро, действуй решительно.</p>
      </div>
      <div style="border-left: 3px solid var(--neon-pink); padding-left: 20px;">
        <h3 style="font-family: var(--font-display); color: var(--neon-pink); margin-bottom: 8px; letter-spacing: 2px;">03. ПОБЕДА</h3>
        <p style="color: var(--text-secondary); line-height: 1.6;">До 2 голов. Ничьих не бывает. Либо ты победил, либо проиграл.</p>
      </div>
    </div>
  </div>
</div>

<script>
const App = (function() {
  'use strict';
  
  const state = {
    players: [],
    filter: 'Все',
    searchQuery: '',
    lastFocused: null
  };

  const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vREjbeB6jNrU01kw1npVtFTvqGdP134ERjmyROoOYeYXbzjgL0ZCNK6KwF0VTk3c1yxZEZEUsJjy2Ur/pub?output=csv';

  const createEl = (tag, classes = '', attrs = {}, text = '') => {
    const el = document.createElement(tag);
    if (classes) el.className = classes;
    Object.entries(attrs).forEach(([k, v]) => el.setAttribute(k, v));
    if (text) el.textContent = text;
    return el;
  };

  const showToast = (message, duration = 3000) => {
    const container = document.getElementById('toast-container');
    const toast = createEl('div', 'toast', {}, message);
    container.appendChild(toast);
    setTimeout(() => {
      toast.style.opacity = '0';
      setTimeout(() => toast.remove(), 500);
    }, duration);
  };

  const parseCSV = (text) => {
    const lines = text.split('\n').filter(l => l.trim());
    if (lines.length < 2) return [];
    
    const players = [];
    for (let i = 1; i < lines.length; i++) {
      const line = lines[i];
      const values = [];
      let current = '';
      let inQuotes = false;
      
      for (let j = 0; j < line.length; j++) {
        const char = line[j];
        const nextChar = line[j + 1];
        
        if (char === '"') {
          if (inQuotes && nextChar === '"') {
            current += '"';
            j++;
          } else {
            inQuotes = !inQuotes;
          }
        } else if (char === ',' && !inQuotes) {
          values.push(current.trim());
          current = '';
        } else {
          current += char;
        }
      }
      values.push(current.trim());
      
      const player = {
        name: values[0] || '',
        ovr: parseInt(values[1]) || 0,
        role: values[2] || 'Игрок',
        drib: parseInt(values[3]) || 0,
        speed: parseInt(values[4]) || 0,
        shot: parseInt(values[5]) || 0,
        phys: parseInt(values[6]) || 0,
        photo: values[7] || '',
        status: values[8] || '',
        badges: values[9] ? values[9].split('|').map(b => b.trim()).filter(Boolean) : []
      };
      
      if (player.name && player.ovr) players.push(player);
    }
    return players;
  };

  const init = async () => {
    const preloader = document.getElementById('preloader');
    
    try {
      const controller = new AbortController();
      setTimeout(() => controller.abort(), 10000);
      
      const response = await fetch(CSV_URL, { 
        signal: controller.signal,
        headers: { 'Accept': 'text/csv' }
      });
      
      if (!response.ok) throw new Error(`HTTP ${response.status}`);
      
      const text = await response.text();
      state.players = parseCSV(text);
      
      if (state.players.length === 0) throw new Error('Нет данных');
      
      render();
      setupEventListeners();
      setupDownloadButton();
      
      setTimeout(() => preloader?.classList.add('loaded'), 500);
      
    } catch (error) {
      console.error(error);
      showErrorUI();
      preloader?.classList.add('loaded');
    }
  };

  const showErrorUI = () => {
    const grid = document.getElementById('roster-grid');
    const tbody = document.getElementById('stats-body');
    
    const html = `
      <div class="error-container">
        <div class="error-title">Ошибка загрузки</div>
        <p style="color: var(--text-secondary); margin-bottom: 20px;">Не удалось загрузить данные. Попробуй позже.</p>
        <button class="error-retry" onclick="location.reload()">Перезагрузить</button>
      </div>
    `;
    
    if (grid) grid.innerHTML = html;
    if (tbody) tbody.innerHTML = `<tr><td colspan="3" style="text-align: center; padding: 40px; color: var(--neon-pink);">Ошибка загрузки данных</td></tr>`;
  };

  const renderRoster = () => {
    const grid = document.getElementById('roster-grid');
    if (!grid) return;
    
    const filtered = state.players.filter(p => {
      const matchesSearch = p.name.toLowerCase().includes(state.searchQuery);
      const matchesRole = state.filter === 'Все' || p.role === state.filter;
      return matchesSearch && matchesRole;
    });
    
    grid.innerHTML = '';
    
    if (filtered.length === 0) {
      grid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 60px; color: var(--text-secondary); font-family: var(--font-display); letter-spacing: 2px;">НИКОГО НЕ НАЙДЕНО</div>`;
      return;
    }
    
    const fragment = document.createDocumentFragment();
    
    filtered.forEach((p, index) => {
      const card = createEl('div', 'card player-card', {
        tabindex: '0',
        style: `animation: fadeIn 0.5s ${index * 0.05}s backwards;`
      });
      
      const imgDiv = createEl('div', 'player-img');
      if (p.photo) {
        const img = new Image();
        img.onload = () => { imgDiv.style.backgroundImage = `url('${p.photo.replace(/'/g, "\\'")}')`; };
        img.src = p.photo;
      }
      
      const info = createEl('div', 'player-info');
      const role = createEl('span', '', {}, p.role);
      const name = createEl('h3', '', {}, p.name);
      
      info.appendChild(role);
      info.appendChild(name);
      
      if (p.badges.length) {
        const badges = createEl('div', 'player-badges', {}, p.badges[0]);
        info.appendChild(badges);
      }
      
      const ovr = createEl('span', 'ovr-badge', {}, p.ovr);
      
      card.appendChild(imgDiv);
      card.appendChild(info);
      card.appendChild(ovr);
      
      if (p.status) {
        const status = createEl('div', '', {
          style: 'position:absolute; top:20px; left:20px; background:rgba(0,0,0,0.8); color:var(--accent); padding:6px 16px; border-radius:100px; font-family:var(--font-display); font-size:11px; letter-spacing:2px; border:1px solid var(--accent); z-index:3;'
        }, p.status);
        card.appendChild(status);
      }
      
      card.addEventListener('click', () => openPlayerModal(p));
      card.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openPlayerModal(p);
        }
      });
      
      fragment.appendChild(card);
    });
    
    grid.appendChild(fragment);
  };

  const renderStats = () => {
    const tbody = document.getElementById('stats-body');
    if (!tbody) return;
    
    const sorted = [...state.players].sort((a, b) => b.ovr - a.ovr);
    tbody.innerHTML = '';
    
    const fragment = document.createDocumentFragment();
    
    sorted.forEach((p, i) => {
      const tr = createEl('tr', '', { tabindex: '0', style: `animation:fadeIn 0.3s ${i*0.03}s backwards` });
      
      tr.addEventListener('click', () => openPlayerModal(p));
      tr.addEventListener('keydown', (e) => { if(e.key==='Enter') openPlayerModal(p); });
      
      const tdPos = createEl('td', '', { style: 'font-family:var(--font-display); color:var(--text-secondary);' }, (i+1).toString().padStart(2,'0'));
      
      const tdPlayer = createEl('td');
      const row = createEl('div', 'player-row');
      
      const img = createEl('img', 'player-avatar-sm');
      img.onerror = function() {
        this.style.display='none';
        const fallback = createEl('div', '', {
          style: 'width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--neon-blue));display:flex;align-items:center;justify-content:center;font-family:var(--font-display);color:var(--bg);font-size:20px;'
        }, p.name.charAt(0));
        row.insertBefore(fallback, row.firstChild);
      };
      if (p.photo) img.src = p.photo;
      
      const info = createEl('div', 'player-info-sm');
      info.appendChild(createEl('div', 'player-name-sm', {}, p.name));
      info.appendChild(createEl('div', 'player-role-sm', {}, p.role));
      
      row.appendChild(img);
      row.appendChild(info);
      tdPlayer.appendChild(row);
      
      const tdOvr = createEl('td', '', { style: 'text-align:right;' });
      const badge = createEl('span', 'ovr-badge', { style: 'margin:0; position:static; transform:none; display:inline-flex;' }, p.ovr);
      tdOvr.appendChild(badge);
      
      tr.appendChild(tdPos);
      tr.appendChild(tdPlayer);
      tr.appendChild(tdOvr);
      fragment.appendChild(tr);
    });
    
    tbody.appendChild(fragment);
  };

  const openPlayerModal = (player) => {
    state.lastFocused = document.activeElement;
    
    document.getElementById('m-name').textContent = player.name;
    document.getElementById('m-role').textContent = player.role;
    document.getElementById('m-ovr').textContent = player.ovr;
    
    const img = document.getElementById('m-img');
    const container = document.getElementById('m-img-container');
    img.style.display = 'block';
    img.src = player.photo || '';
    img.onerror = () => {
      img.style.display = 'none';
      container.style.background = `linear-gradient(135deg, var(--surface), var(--bg))`;
      container.innerHTML = `<div style="display:flex;align-items:center;justify-content:center;height:100%;font-family:var(--font-display);font-size:64px;color:var(--accent);">${player.name.charAt(0)}</div>`;
    };
    img.onload = () => { container.innerHTML = ''; container.appendChild(img); };
    
    const badges = document.getElementById('m-badges');
    badges.innerHTML = '';
    player.badges.forEach(b => {
      badges.appendChild(createEl('span', 'badge', { style: 'background:var(--neon-pink); padding:4px 12px; border-radius:100px; font-size:10px; font-family:var(--font-display); letter-spacing:1px;' }, b));
    });
    
    const statsDiv = document.getElementById('m-stats');
    const isGK = player.role === 'Вратарь';
    const stats = [
      { k: isGK?'REF':'DRI', v: player.drib, l: isGK?'Реакция':'Дриблинг' },
      { k: isGK?'DIV':'SPD', v: player.speed, l: isGK?'Прыжок':'Скорость' },
      { k: isGK?'HAN':'SHT', v: player.shot, l: isGK?'Руки':'Удар' },
      { k: isGK?'POS':'PHY', v: player.phys, l: isGK?'Позиция':'Физика' }
    ];
    
    statsDiv.innerHTML = '';
    stats.forEach((s, i) => {
      const item = createEl('div', 'stat-item');
      item.innerHTML = `
        <div class="stat-header">
          <div class="stat-label-group" data-tooltip="${s.l}">
            <span class="stat-label" style="font-family:var(--font-display);">${s.k}</span>
            <i class="info-icon">?</i>
          </div>
          <span class="stat-value" style="font-family:var(--font-display); color:var(--accent);">${s.v}</span>
        </div>
        <div class="stat-bar-bg">
          <div class="stat-bar-fill" id="bar-${i}" style="width:0%"></div>
        </div>
      `;
      statsDiv.appendChild(item);
      setTimeout(() => {
        document.getElementById(`bar-${i}`).style.width = `${Math.min(s.v, 100)}%`;
      }, 100 + i*100);
    });
    
    document.getElementById('playerModal').classList.add('active');
    document.body.style.overflow = 'hidden';
    
    // Focus trap
    const modal = document.getElementById('playerModal');
    const focusable = modal.querySelectorAll('button, [href], input');
    if (focusable.length) focusable[0].focus();
  };

  const closeModal = (id) => {
    document.getElementById(id).classList.remove('active');
    document.body.style.overflow = '';
    if (state.lastFocused) state.lastFocused.focus();
  };

  const setupEventListeners = () => {
    document.getElementById('playerSearch')?.addEventListener('input', (e) => {
      state.searchQuery = e.target.value.toLowerCase();
      setTimeout(renderRoster, 100);
    });
    
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        state.filter = e.target.getAttribute('data-role');
        renderRoster();
      });
    });
    
    window.addEventListener('scroll', () => {
      document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 50);
    }, { passive: true });
  };

  const setupDownloadButton = () => {
    const btn = document.getElementById('download-card');
    if (!btn) return;
    
    btn.addEventListener('click', async () => {
      btn.style.opacity = '0.5';
      showToast('Создаём карточку...');
      
      try {
        const card = document.getElementById('stats-card');
        const canvas = await html2canvas(card, {
          scale: 2,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#121212',
          ignoreElements: el => el.classList.contains('modal-header-fixed')
        });
        
        try {
          canvas.toDataURL();
        } catch(e) {
          showToast('CORS ошибка: нельзя скачать');
          return;
        }
        
        const name = document.getElementById('m-name').textContent.replace(/[^a-zA-Zа-яА-Я0-9]/g, '_');
        const link = document.createElement('a');
        link.download = `BOX1V1_${name}.png`;
        link.href = canvas.toDataURL();
        link.click();
        showToast('Сохранено!');
        
      } catch (e) {
        showToast('Ошибка скачивания');
      } finally {
        btn.style.opacity = '';
      }
    });
  };

  const render = () => {
    renderRoster();
    renderStats();
  };

  return {
    init,
    switchTab: (id) => {
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.getElementById(`btn-${id}`)?.classList.add('active');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    },
    toggleMenu: () => {
      document.getElementById('mobile-drawer').classList.toggle('open');
      document.getElementById('drawer-overlay').classList.toggle('open');
      document.getElementById('burger').classList.toggle('open');
    },
    handleMobileNav: (id, isModal) => {
      App.toggleMenu();
      setTimeout(() => isModal ? document.getElementById(id).classList.add('active') : App.switchTab(id), 300);
    },
    openModal: (id) => {
      document.getElementById(id).classList.add('active');
      document.body.style.overflow = 'hidden';
    },
    closeModal,
    copyPlayerID: async () => {
      const name = document.getElementById('m-name').textContent;
      try {
        await navigator.clipboard.writeText(name);
        showToast('ID скопирован');
      } catch {
        showToast('Ошибка копирования');
      }
    },
    sharePlayer: async () => {
      const name = document.getElementById('m-name').textContent;
      const url = window.location.href;
      if (navigator.share) {
        try {
          await navigator.share({ title: `BOX1V1 | ${name}`, url });
        } catch {}
      } else {
        try {
          await navigator.clipboard.writeText(url);
          showToast('Ссылка скопирована');
        } catch {}
      }
    }
  };
})();

document.addEventListener('DOMContentLoaded', App.init);
</script>
</body>
</html>

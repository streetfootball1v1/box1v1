<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover"/>
<meta name="theme-color" content="#0a0a0a">
<title>BOX1V1 | –£–õ–ò–ß–ù–´–ô –§–£–¢–ë–û–õ 1 –ù–ê 1</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root {
  --bg: #fafafa;
  --bg-elevated: #ffffff;
  --text: #0a0a0a;
  --text-secondary: #525252;
  --accent: #22c55e;
  --accent-glow: rgba(34, 197, 94, 0.4);
  --border: rgba(0,0,0,0.06);
  --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
  --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
  --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

html { 
  scroll-behavior: smooth; 
  background: var(--bg);
  font-family: 'Inter', sans-serif;
  -webkit-font-smoothing: antialiased;
}

/* ANIMATED BACKGROUND MESH */
body {
  background: var(--bg);
  color: var(--text);
  overflow-x: hidden;
  position: relative;
}

body::before {
  content: '';
  position: fixed;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: 
    radial-gradient(circle at 20% 50%, rgba(34,197,94,0.08) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(34,197,94,0.05) 0%, transparent 50%),
    radial-gradient(circle at 40% 20%, rgba(0,0,0,0.02) 0%, transparent 40%);
  animation: meshMove 20s ease-in-out infinite;
  pointer-events: none;
  z-index: -1;
}

@keyframes meshMove {
  0%, 100% { transform: translate(0, 0) scale(1); }
  33% { transform: translate(2%, 2%) scale(1.1); }
  66% { transform: translate(-2%, 1%) scale(0.95); }
}

/* PRELOADER */
#preloader {
  position: fixed;
  inset: 0;
  background: var(--bg);
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: opacity 0.8s var(--ease-out), visibility 0.8s;
}

#preloader.loaded {
  opacity: 0;
  visibility: hidden;
}

.preloader-content {
  text-align: center;
  animation: preloaderPulse 2s ease-in-out infinite;
}

.preloader-logo {
  font-size: clamp(3rem, 10vw, 5rem);
  font-weight: 900;
  font-style: italic;
  letter-spacing: -0.05em;
  background: linear-gradient(135deg, var(--text) 0%, var(--accent) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: logoReveal 1.2s var(--ease-out) forwards;
  clip-path: inset(0 100% 0 0);
}

@keyframes logoReveal {
  to { clip-path: inset(0 0 0 0); }
}

@keyframes preloaderPulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.05); opacity: 0.8; }
}

/* GLITCH LOGO ON HOVER */
.logo {
  font-size: 1.75rem;
  font-weight: 900;
  font-style: italic;
  letter-spacing: -0.03em;
  cursor: pointer;
  text-decoration: none;
  color: var(--text);
  position: relative;
  display: inline-block;
  transition: transform 0.3s var(--ease-spring);
}

.logo:hover {
  transform: scale(1.05);
}

.logo-accent { color: var(--accent); }

.logo:hover {
  animation: glitch 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both infinite;
  color: var(--accent);
}

@keyframes glitch {
  0% { transform: translate(0); }
  20% { transform: translate(-2px, 2px); }
  40% { transform: translate(-2px, -2px); }
  60% { transform: translate(2px, 2px); }
  80% { transform: translate(2px, -2px); }
  100% { transform: translate(0); }
}

/* NAVIGATION GLASS */
nav {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 80px;
  background: rgba(250, 250, 250, 0.8);
  backdrop-filter: blur(20px) saturate(180%);
  border-bottom: 1px solid var(--border);
  z-index: 1000;
  transform: translateY(-100%);
  animation: slideDown 0.8s var(--ease-out) 0.5s forwards;
  transition: all 0.3s;
}

nav.scrolled {
  box-shadow: 0 10px 40px -10px rgba(0,0,0,0.1);
  height: 70px;
}

@keyframes slideDown {
  to { transform: translateY(0); }
}

.nav-inner {
  max-width: 1400px;
  margin: 0 auto;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 24px;
}

.nav-links {
  display: flex;
  gap: 8px;
  opacity: 0;
  animation: fadeIn 0.6s var(--ease-out) 0.8s forwards;
}

.nav-links a {
  font-size: 13px;
  font-weight: 700;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  text-decoration: none;
  color: var(--text-secondary);
  padding: 12px 24px;
  border-radius: 100px;
  position: relative;
  overflow: hidden;
  transition: all 0.4s var(--ease-out);
}

.nav-links a::before {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  width: 0;
  height: 100%;
  background: var(--text);
  border-radius: 100px;
  transition: all 0.4s var(--ease-out);
  transform: translateX(-50%);
  z-index: -1;
}

.nav-links a:hover {
  color: white;
  transform: translateY(-2px);
}

.nav-links a:hover::before {
  width: 100%;
}

.nav-links a.active {
  color: white;
  background: var(--text);
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
}

/* BURGER ANIMATION */
.burger {
  display: none;
  cursor: pointer;
  width: 48px;
  height: 48px;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 6px;
  border-radius: 16px;
  background: var(--bg);
  border: 1px solid var(--border);
  transition: all 0.3s var(--ease-spring);
}

.burger:hover {
  transform: scale(1.1);
  border-color: var(--accent);
}

.burger span {
  width: 20px;
  height: 2px;
  background: var(--text);
  border-radius: 2px;
  transition: all 0.4s var(--ease-spring);
  transform-origin: center;
}

.burger.open span:nth-child(1) { 
  transform: translateY(8px) rotate(45deg); 
  background: var(--accent);
}
.burger.open span:nth-child(2) { 
  opacity: 0; 
  transform: scaleX(0);
}
.burger.open span:nth-child(3) { 
  transform: translateY(-8px) rotate(-45deg);
  background: var(--accent);
}

/* DRAWER */
.drawer-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(10px);
  z-index: 1999;
  opacity: 0;
  visibility: hidden;
  transition: all 0.5s var(--ease-out);
}

.drawer-overlay.open {
  opacity: 1;
  visibility: visible;
}

.mobile-drawer {
  position: fixed;
  top: 0;
  right: -100%;
  width: min(86%, 400px);
  height: 100dvh;
  background: var(--bg-elevated);
  z-index: 2000;
  padding: 100px 32px 32px;
  display: flex;
  flex-direction: column;
  gap: 16px;
  transition: right 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  box-shadow: -20px 0 60px rgba(0,0,0,0.2);
}

.mobile-drawer.open { right: 0; }

.mobile-drawer a {
  font-size: 2rem;
  font-weight: 900;
  font-style: italic;
  text-decoration: none;
  color: var(--text);
  text-transform: uppercase;
  letter-spacing: -0.02em;
  padding: 16px 0;
  border-bottom: 1px solid var(--border);
  transform: translateX(50px);
  opacity: 0;
  transition: all 0.4s var(--ease-out);
}

.mobile-drawer.open a {
  transform: translateX(0);
  opacity: 1;
}

.mobile-drawer.open a:nth-child(1) { transition-delay: 0.1s; }
.mobile-drawer.open a:nth-child(2) { transition-delay: 0.2s; }
.mobile-drawer.open a:nth-child(3) { transition-delay: 0.3s; }

.mobile-drawer a:hover {
  color: var(--accent);
  padding-left: 20px;
}

/* MAIN */
.main-content {
  max-width: 1300px;
  margin: 0 auto;
  padding: 120px 24px 100px;
  min-height: 100vh;
}

section {
  display: none;
  opacity: 0;
  transform: translateY(40px);
  transition: all 0.8s var(--ease-out);
}

section.active {
  display: block;
  opacity: 1;
  transform: translateY(0);
}

/* INTRO ANIMATIONS */
.intro-block {
  padding: 60px 0 100px;
  text-align: center;
  max-width: 900px;
  margin: 0 auto;
  perspective: 1000px;
}

.intro-block span {
  display: inline-block;
  font-size: 12px;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--accent);
  margin-bottom: 24px;
  padding: 12px 24px;
  border: 2px solid var(--accent);
  border-radius: 100px;
  position: relative;
  overflow: hidden;
  animation: borderGlow 3s ease-in-out infinite;
}

@keyframes borderGlow {
  0%, 100% { box-shadow: 0 0 0 0 rgba(34,197,94,0.4); }
  50% { box-shadow: 0 0 20px 5px rgba(34,197,94,0.2); }
}

.intro-block h1 {
  font-size: clamp(4rem, 15vw, 10rem);
  font-weight: 900;
  font-style: italic;
  letter-spacing: -0.05em;
  line-height: 0.9;
  margin-bottom: 24px;
  background: linear-gradient(135deg, var(--text) 0%, #333 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: titleReveal 1s var(--ease-out) 0.3s backwards;
  transform-style: preserve-3d;
}

@keyframes titleReveal {
  from {
    opacity: 0;
    transform: translateY(100px) rotateX(-45deg);
    filter: blur(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0) rotateX(0);
    filter: blur(0);
  }
}

.intro-block p {
  font-size: clamp(1.25rem, 2.5vw, 1.75rem);
  color: var(--text-secondary);
  max-width: 500px;
  margin: 0 auto 40px;
  animation: fadeInUp 0.8s var(--ease-out) 0.5s backwards;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.btn-group {
  display: flex;
  gap: 16px;
  justify-content: center;
  flex-wrap: wrap;
  animation: fadeInUp 0.8s var(--ease-out) 0.7s backwards;
}

/* MAGNETIC BUTTONS */
.btn {
  padding: 20px 36px;
  border-radius: 100px;
  font-weight: 700;
  text-transform: uppercase;
  font-size: 13px;
  letter-spacing: 0.05em;
  cursor: pointer;
  transition: all 0.4s var(--ease-spring);
  border: none;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  position: relative;
  overflow: hidden;
  isolation: isolate;
}

.btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at var(--x, 50%) var(--y, 50%), rgba(255,255,255,0.3) 0%, transparent 60%);
  opacity: 0;
  transition: opacity 0.3s;
  z-index: -1;
}

.btn:hover::before {
  opacity: 1;
}

.btn-primary {
  background: var(--text);
  color: #fff;
  box-shadow: 0 10px 30px -10px rgba(0,0,0,0.3);
}

.btn-primary:hover {
  transform: translateY(-4px) scale(1.02);
  box-shadow: 0 20px 40px -10px rgba(0,0,0,0.4), 0 0 0 2px rgba(34,197,94,0.3);
}

.btn-outline {
  background: transparent;
  border: 2px solid var(--text);
  color: var(--text);
  position: relative;
}

.btn-outline::after {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--text);
  transform: scaleX(0);
  transform-origin: right;
  transition: transform 0.4s var(--ease-out);
  z-index: -1;
  border-radius: 100px;
}

.btn-outline:hover {
  color: white;
  transform: translateY(-4px);
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.btn-outline:hover::after {
  transform: scaleX(1);
  transform-origin: left;
}

/* STATUS CONTEXT */
.status-context {
  margin-top: 60px;
  padding: 32px 48px;
  background: var(--bg-elevated);
  border-radius: 24px;
  border: 1px solid var(--border);
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  box-shadow: 
    0 4px 20px rgba(0,0,0,0.05),
    0 0 0 1px rgba(34,197,94,0.1);
  position: relative;
  overflow: hidden;
  animation: float 6s ease-in-out infinite;
  transition: all 0.4s var(--ease-out);
}

.status-context:hover {
  transform: translateY(-5px);
  box-shadow: 
    0 20px 40px rgba(0,0,0,0.1),
    0 0 0 2px rgba(34,197,94,0.3);
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.status-label {
  font-size: 12px;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  color: var(--accent);
}

.status-text {
  font-size: clamp(1.25rem, 3vw, 1.75rem);
  font-weight: 800;
}

.beta-badge {
  display: inline-block;
  background: var(--accent);
  color: white;
  font-size: 10px;
  font-weight: 900;
  padding: 4px 12px;
  border-radius: 100px;
  margin-left: 8px;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.8; transform: scale(1.05); }
}

/* BENTO GRID WITH 3D */
.bento-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 24px;
  margin-top: 60px;
  perspective: 2000px;
}

.card {
  background: var(--bg-elevated);
  border-radius: 24px;
  border: 1px solid var(--border);
  padding: 40px;
  position: relative;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
  transform-style: preserve-3d;
  transform: translateZ(0);
}

.card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, transparent 0%, rgba(34,197,94,0.03) 100%);
  opacity: 0;
  transition: opacity 0.3s;
}

.card:hover {
  transform: translateY(-8px) translateZ(20px) rotateX(5deg);
  box-shadow: 
    0 30px 60px -20px rgba(0,0,0,0.15),
    0 0 0 1px rgba(34,197,94,0.2);
  border-color: rgba(34,197,94,0.3);
}

.card:hover::before {
  opacity: 1;
}

.card h2, .card h3 {
  font-weight: 900;
  font-style: italic;
  text-transform: uppercase;
  letter-spacing: -0.02em;
  transition: transform 0.3s var(--ease-out);
}

.card:hover h2, .card:hover h3 {
  transform: translateX(10px);
}

/* PLAYER CARDS - 3D TILT */
.player-card {
  min-height: 480px;
  background: #000;
  color: #fff;
  border: none;
  padding: 0;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 0.1s;
}

.player-card:hover {
  transform: perspective(1000px) rotateY(5deg) rotateX(5deg) translateZ(20px);
}

.player-img {
  position: absolute;
  inset: 0;
  background-size: cover;
  background-position: center top;
  filter: grayscale(0.3);
  opacity: 0.9;
  transition: all 0.5s var(--ease-out);
}

.player-card:hover .player-img {
  filter: grayscale(0);
  transform: scale(1.05);
  opacity: 1;
}

.player-card::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(to top, #000 0%, rgba(0,0,0,0.3) 50%, transparent 100%);
  z-index: 1;
}

.player-info {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 40px 32px;
  z-index: 2;
  transform: translateY(20px);
  transition: transform 0.4s var(--ease-out);
}

.player-card:hover .player-info {
  transform: translateY(0);
}

.player-info span {
  font-size: 12px;
  font-weight: 800;
  text-transform: uppercase;
  color: var(--accent);
  letter-spacing: 0.15em;
  display: block;
  margin-bottom: 8px;
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.3s 0.1s;
}

.player-card:hover .player-info span {
  opacity: 1;
  transform: translateY(0);
}

.player-info h3 {
  font-size: clamp(2rem, 4vw, 2.5rem);
  margin: 0;
  transform: translateY(0);
}

.ovr-badge {
  position: absolute;
  top: 24px;
  right: 24px;
  background: var(--accent);
  color: #000;
  padding: 8px 16px;
  border-radius: 12px;
  font-weight: 900;
  font-size: 14px;
  z-index: 3;
  box-shadow: 0 10px 30px rgba(34,197,94,0.4);
  transform: scale(0) rotate(-10deg);
  animation: badgePop 0.5s var(--ease-spring) 0.5s forwards;
  transition: transform 0.3s var(--ease-spring);
}

@keyframes badgePop {
  to { transform: scale(1) rotate(0); }
}

.player-card:hover .ovr-badge {
  transform: scale(1.1) rotate(5deg);
}

/* TABLE */
.table-wrapper {
  background: var(--bg-elevated);
  border-radius: 24px;
  border: 1px solid var(--border);
  overflow: hidden;
  box-shadow: 0 10px 40px -20px rgba(0,0,0,0.1);
}

th {
  font-size: 11px;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--text-secondary);
  padding: 24px;
  text-align: left;
  border-bottom: 1px solid var(--border);
}

td {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border);
  transition: all 0.3s;
}

tbody tr {
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
}

tbody tr::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  height: 0;
  width: 3px;
  background: var(--accent);
  transition: all 0.3s var(--ease-out);
  transform: translateY(-50%);
}

tbody tr:hover {
  background: rgba(34,197,94,0.03);
  transform: translateX(10px);
}

tbody tr:hover::before {
  height: 60%;
}

.player-avatar-sm {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid transparent;
  transition: all 0.3s;
}

tbody tr:hover .player-avatar-sm {
  border-color: var(--accent);
  transform: scale(1.1);
  box-shadow: 0 0 20px rgba(34,197,94,0.3);
}

/* MODAL ANIMATIONS */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(255,255,255,0.8);
  backdrop-filter: blur(20px) saturate(180%);
  z-index: 3000;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
  opacity: 0;
  visibility: hidden;
  transition: all 0.5s var(--ease-out);
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background: var(--bg-elevated);
  width: 100%;
  max-width: 520px;
  border-radius: 32px;
  padding: 48px;
  position: relative;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 40px 80px -20px rgba(0,0,0,0.2);
  transform: perspective(1000px) rotateX(-30deg) translateY(100px) scale(0.8);
  opacity: 0;
  transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
}

.modal-overlay.active .modal-content {
  transform: perspective(1000px) rotateX(0) translateY(0) scale(1);
  opacity: 1;
}

.modal-close, .download-circle {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border: none;
  background: rgba(0,0,0,0.05);
  transition: all 0.4s var(--ease-spring);
  position: relative;
  overflow: hidden;
}

.modal-close:hover, .download-circle:hover {
  background: var(--text);
  color: white;
  transform: rotate(90deg) scale(1.1);
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.modal-close:active, .download-circle:active {
  transform: rotate(90deg) scale(0.95);
}

#m-img-container {
  width: 100%;
  aspect-ratio: 1;
  border-radius: 24px;
  overflow: hidden;
  margin: 60px 0 32px;
  position: relative;
  transform: translateZ(0);
  transition: transform 0.3s;
}

#m-img-container:hover {
  transform: scale(1.02);
}

#m-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.5s var(--ease-out);
}

#m-img-container:hover #m-img {
  transform: scale(1.05);
}

/* STAT BARS ANIMATION */
.stat-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), #16a34a);
  border-radius: 100px;
  width: 0%;
  transition: width 1.5s cubic-bezier(0.16, 1, 0.3, 1);
  box-shadow: 0 0 20px rgba(34,197,94,0.3);
  position: relative;
  overflow: hidden;
}

.stat-bar-fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0% { transform: translateX(0); }
  100% { transform: translateX(200%); }
}

/* TOAST */
#toast-container {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10001;
  display: flex;
  flex-direction: column;
  gap: 10px;
  pointer-events: none;
}

.toast {
  background: var(--text);
  color: white;
  padding: 16px 32px;
  border-radius: 100px;
  font-weight: 600;
  box-shadow: 0 20px 40px rgba(0,0,0,0.2);
  animation: toastSlide 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  border: 1px solid rgba(255,255,255,0.1);
}

@keyframes toastSlide {
  from {
    opacity: 0;
    transform: translateY(20px) scale(0.9);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* CONTROLS */
.controls-row {
  margin-bottom: 40px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 20px;
}

.search-input {
  padding: 16px 28px;
  border-radius: 100px;
  border: 2px solid var(--border);
  background: var(--bg-elevated);
  width: 100%;
  max-width: 400px;
  font-size: 15px;
  font-weight: 500;
  transition: all 0.3s var(--ease-out);
  position: relative;
}

.search-input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 4px rgba(34,197,94,0.1), 0 10px 30px rgba(0,0,0,0.1);
  transform: translateY(-2px);
}

.filter-btn {
  padding: 12px 24px;
  border-radius: 100px;
  border: 2px solid var(--border);
  background: var(--bg-elevated);
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s var(--ease-spring);
  position: relative;
  overflow: hidden;
}

.filter-btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--text);
  transform: scaleX(0);
  transform-origin: left;
  transition: transform 0.3s var(--ease-out);
  z-index: -1;
}

.filter-btn:hover, .filter-btn.active {
  color: white;
  border-color: var(--text);
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

.filter-btn:hover::before, .filter-btn.active::before {
  transform: scaleX(1);
}

/* MOBILE */
@media (max-width: 1024px) {
  .bento-grid { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 768px) {
  .nav-links { display: none; }
  .burger { display: flex; }
  .main-content { padding: 100px 20px; }
  .bento-grid { grid-template-columns: 1fr; gap: 20px; }
  .player-card:hover { transform: translateY(-5px); }
  .modal-content { margin: 10px; width: calc(100% - 20px); max-height: 95vh; }
}

/* SCROLL REVEAL */
.reveal {
  opacity: 0;
  transform: translateY(30px);
  transition: all 0.8s var(--ease-out);
}

.reveal.active {
  opacity: 1;
  transform: translateY(0);
}

/* CURSOR TRAIL EFFECT (optional via JS) */
.cursor-trail {
  position: fixed;
  width: 20px;
  height: 20px;
  background: radial-gradient(circle, rgba(34,197,94,0.3) 0%, transparent 70%);
  border-radius: 50%;
  pointer-events: none;
  z-index: 9999;
  transition: transform 0.1s;
}
</style>
</head>
<body>

<div id="preloader">
  <div class="preloader-content">
    <div class="preloader-logo">BOX<span style="color: var(--accent);">1</span>V1</div>
  </div>
</div>

<div id="toast-container"></div>

<nav id="navbar">
  <div class="nav-inner">
    <a href="#home" class="logo" onclick="App.switchTab('home'); return false;">
      BOX<span class="logo-accent">1</span>V1
    </a>
    <div class="nav-links">
      <a href="#home" onclick="App.switchTab('home'); return false;" id="btn-home" class="active">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="#roster" onclick="App.switchTab('roster'); return false;" id="btn-roster">–£—á–∞—Å—Ç–Ω–∏–∫–∏</a>
      <a href="#stats" onclick="App.switchTab('stats'); return false;" id="btn-stats">–†–µ–π—Ç–∏–Ω–≥</a>
    </div>
    <button class="burger" id="burger" onclick="App.toggleMenu()">
      <span></span><span></span><span></span>
    </button>
  </div>
</nav>

<div class="drawer-overlay" id="drawer-overlay" onclick="App.toggleMenu()"></div>
<div class="mobile-drawer" id="mobile-drawer">
  <div class="mobile-drawer-header">
    <a href="#home" class="logo" style="font-size: 2rem;">
      BOX<span class="logo-accent">1</span>V1
    </a>
  </div>
  <a href="#home" onclick="App.handleMobileNav('home'); return false;">–ì–ª–∞–≤–Ω–∞—è</a>
  <a href="#roster" onclick="App.handleMobileNav('roster'); return false;">–£—á–∞—Å—Ç–Ω–∏–∫–∏</a>
  <a href="#stats" onclick="App.handleMobileNav('stats'); return false;">–†–µ–π—Ç–∏–Ω–≥</a>
  <div class="btn-group" style="margin-top: auto;">
    <button class="btn btn-primary" onclick="App.handleMobileNav('applyModal', true)" style="width:100%">–°—Ç–∞—Ç—å —á–∞—Å—Ç—å—é</button>
  </div>
</div>

<main class="main-content">
  <section id="home" class="active">
    <div class="intro-block">
      <span data-reveal>The Next Gen Football</span>
      <h1>BOX1V1.</h1>
      <p data-reveal>–†–µ—à–∞–µ—Ç –Ω–µ –∫–æ–º–∞–Ω–¥–∞.<br>–†–µ—à–∞–µ—à—å —Ç—ã.</p>
      <div class="btn-group" data-reveal>
        <button class="btn btn-primary magnetic" onclick="App.switchTab('roster')">–£—á–∞—Å—Ç–Ω–∏–∫–∏</button>
        <button class="btn btn-outline magnetic" onclick="App.openModal('applyModal')">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
      </div>
      
      <div class="status-context" data-reveal style="animation-delay: 0.8s;">
        <span class="status-label">–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞</span>
        <div class="status-text">
          üî• –ù–∞–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ—Ç–∫—Ä—ã—Ç
          <span class="beta-badge">Beta</span>
        </div>
        <p style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 8px;">–ü–µ—Ä–≤—ã–π —Å–µ–∑–æ–Ω —Å—Ç–∞—Ä—Ç—É–µ—Ç –ø–æ—Å–ª–µ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –≥—Ä—É–ø–ø</p>
      </div>
    </div>

    <div class="bento-grid" data-reveal>
      <div class="card tilt-card" style="grid-column: span 2;" onclick="App.openModal('rulesModal')" tabindex="0">
        <span style="font-size:12px; font-weight:800; color:var(--accent); text-transform:uppercase; letter-spacing:0.15em;">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</span>
        <h2 style="font-size: clamp(2.5rem, 5vw, 4rem); margin-top: 10px;">–†–ï–ì–õ–ê–ú–ï–ù–¢</h2>
        <p style="margin-top: 10px; color: var(--text-secondary);">–°–≤–æ–¥ –ø—Ä–∞–≤–∏–ª –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –º–∞—Ç—á–µ–π.</p>
        <div style="margin-top:auto; padding-top:30px; font-weight:800; font-size:12px; text-transform:uppercase; color:var(--text-secondary); display: flex; align-items: center; gap: 8px;">
          –ò–∑—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ <span style="transition: transform 0.3s; display: inline-block;">‚Üí</span>
        </div>
      </div>
      
      <div class="card tilt-card" onclick="window.open('https://t.me/streetbox1v1', '_blank')" tabindex="0">
        <h3 style="font-size: 1.5rem; font-weight: 900; font-style: italic;">TELEGRAM</h3>
        <p style="margin-top: 10px; color: var(--text-secondary);">–°–≤–µ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.</p>
      </div>
      
      <div class="card tilt-card" onclick="window.open('https://instagram.com/box.1v1', '_blank')" tabindex="0">
        <h3 style="font-size: 1.5rem; font-weight: 900; font-style: italic;">INSTAGRAM</h3>
        <p style="margin-top: 10px; color: var(--text-secondary);">–ì–ª–∞–≤–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –≤ –º–µ–¥–∏–∞ —Ñ–æ—Ä–º–∞—Ç–µ.</p>
      </div>
    </div>
  </section>

  <section id="roster">
    <div style="margin-bottom: 60px;" data-reveal>
      <h1 style="font-size: clamp(3rem, 10vw, 8rem); font-weight: 900; font-style: italic; line-height:0.9; letter-spacing: -0.05em;">
        –£–ß–ê–°–¢–ù–ò–ö–ò<span class="beta-badge" style="font-size: 0.12em; vertical-align: super; margin-left: 10px;">–ü—Ä–µ–¥–≤.</span>
      </h1>
      <p style="font-size: 1.25rem; margin-top:16px; color: var(--text-secondary);">–î–µ–π—Å—Ç–≤—É—é—â–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ BOX1V1</p>
    </div>
    
    <div class="controls-row" data-reveal>
      <input type="search" class="search-input magnetic" id="playerSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏..." autocomplete="off">
      <div class="filter-bar">
        <button class="filter-btn active" data-role="–í—Å–µ">–í—Å–µ</button>
        <button class="filter-btn" data-role="–ò–≥—Ä–æ–∫">–ü–æ–ª–µ–≤—ã–µ</button>
        <button class="filter-btn" data-role="–í—Ä–∞—Ç–∞—Ä—å">–í—Ä–∞—Ç–∞—Ä–∏</button>
      </div>
    </div>
    
    <div class="bento-grid" id="roster-grid"></div>
  </section>

  <section id="stats">
    <h1 style="font-size: clamp(3rem, 10vw, 8rem); font-weight: 900; font-style: italic; line-height:0.9; margin-bottom:40px; letter-spacing: -0.05em;" data-reveal>
      –†–ï–ô–¢–ò–ù–ì<span class="beta-badge" style="font-size: 0.12em; vertical-align: super; margin-left: 10px;">–ü—Ä–µ–¥–≤.</span>
    </h1>
    <div class="table-wrapper" data-reveal>
      <table>
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">–ò–≥—Ä–æ–∫</th>
            <th scope="col" style="text-align:right;">OVR</th>
          </tr>
        </thead>
        <tbody id="stats-body"></tbody>
      </table>
    </div>
  </section>
</main>

<!-- MODALS -->
<div class="modal-overlay" id="playerModal" onclick="if(event.target === this) App.closeModal('playerModal')">
  <div class="modal-content" onclick="event.stopPropagation()" style="transform-style: preserve-3d;">
    <div style="position: absolute; top: 20px; right: 20px; display: flex; gap: 12px; z-index: 10;">
      <button id="download-card" style="width: 44px; height: 44px; border-radius: 50%; border: none; background: rgba(0,0,0,0.05); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s;" 
        onmouseover="this.style.background='var(--text)'; this.style.color='white'; this.style.transform='scale(1.1)'" 
        onmouseout="this.style.background='rgba(0,0,0,0.05)'; this.style.color=''; this.style.transform=''"
        aria-label="–°–∫–∞—á–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
      </button>
      <button onclick="App.closeModal('playerModal')" style="width: 44px; height: 44px; border-radius: 50%; border: none; background: rgba(0,0,0,0.05); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s;"
        onmouseover="this.style.background='var(--text)'; this.style.color='white'; this.style.transform='rotate(90deg) scale(1.1)'" 
        onmouseout="this.style.background='rgba(0,0,0,0.05)'; this.style.color=''; this.style.transform=''"
        aria-label="–ó–∞–∫—Ä—ã—Ç—å">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <div id="m-img-container" style="margin-top: 60px; margin-bottom: 32px;">
      <img id="m-img" src="" alt="–§–æ—Ç–æ –∏–≥—Ä–æ–∫–∞" style="width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 24px;">
    </div>
    
    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 32px;">
      <div>
        <span id="m-role" style="display: inline-block; font-size: 12px; font-weight: 800; text-transform: uppercase; color: var(--accent); background: rgba(34,197,94,0.1); padding: 8px 16px; border-radius: 100px; margin-bottom: 12px;">ROLE</span>
        <h2 id="m-name" style="font-size: clamp(1.75rem, 5vw, 2.5rem); font-weight: 900; font-style: italic; line-height: 1.1;">NAME</h2>
        <div id="m-badges" style="display: flex; gap: 8px; margin-top: 16px;"></div>
      </div>
      <div id="m-ovr" style="font-size: clamp(2.5rem, 6vw, 3.5rem); font-weight: 900; font-style: italic; color: var(--accent);">99</div>
    </div>
    
    <div id="m-stats" style="margin-bottom: 32px;"></div>
    
    <div style="display: flex; gap: 12px;">
      <button class="btn btn-primary" style="flex: 1;" onclick="App.copyPlayerID()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID</button>
      <button class="btn btn-outline" style="flex: 1;" onclick="App.sharePlayer()">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="applyModal" onclick="if(event.target === this) App.closeModal('applyModal')">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div style="position: absolute; top: 20px; right: 20px;">
      <button onclick="App.closeModal('applyModal')" style="width: 44px; height: 44px; border-radius: 50%; border: none; background: rgba(0,0,0,0.05); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s;"
        onmouseover="this.style.background='var(--text)'; this.style.color='white'; this.style.transform='rotate(90deg)'" 
        onmouseout="this.style.background='rgba(0,0,0,0.05)'; this.style.color=''; this.style.transform=''">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <h2 style="font-size: clamp(1.75rem, 5vw, 2.5rem); font-weight: 900; font-style: italic; margin: 60px 0 16px 0;">–í–°–¢–£–ü–ò–¢–¨ –í BOX1V1</h2>
    <p style="margin-bottom: 32px; color: var(--text-secondary); line-height: 1.6;">–ß—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞—è–≤–∫—É, –æ—Å—Ç–∞–≤—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ–¥ –ª—é–±—ã–º –ø–æ—Å—Ç–æ–º —Å —Ö–µ—à—Ç–µ–≥–æ–º <strong style="color: var(--text);">#BOX–£–ß–ê–°–¢–í–û–í–ê–¢–¨</strong>.</p>
    <button class="btn btn-primary" style="width: 100%;" onclick="window.open('https://t.me/streetbox1v1', '_blank')">–û—Ç–∫—Ä—ã—Ç—å Telegram</button>
  </div>
</div>

<div class="modal-overlay" id="rulesModal" onclick="if(event.target === this) App.closeModal('rulesModal')">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div style="position: absolute; top: 20px; right: 20px;">
      <button onclick="App.closeModal('rulesModal')" style="width: 44px; height: 44px; border-radius: 50%; border: none; background: rgba(0,0,0,0.05); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s;"
        onmouseover="this.style.background='var(--text)'; this.style.color='white'; this.style.transform='rotate(90deg)'" 
        onmouseout="this.style.background='rgba(0,0,0,0.05)'; this.style.color=''; this.style.transform=''">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <h2 style="font-size: clamp(1.75rem, 5vw, 2.5rem); font-weight: 900; font-style: italic; margin: 60px 0 32px 0;">–†–ï–ì–õ–ê–ú–ï–ù–¢</h2>
    <div style="display: flex; flex-direction: column; gap: 24px;">
      <article style="padding-bottom: 24px; border-bottom: 1px solid var(--border); transition: all 0.3s;" onmouseover="this.style.paddingLeft='20px'; this.style.borderLeft='3px solid var(--accent)';" onmouseout="this.style.paddingLeft='0'; this.style.borderLeft='none';">
        <h3 style="font-size: 12px; font-weight: 800; text-transform: uppercase; color: var(--accent); margin-bottom: 8px; letter-spacing: 0.1em;">01. –§–æ—Ä–º–∞—Ç</h3>
        <p style="color: var(--text-secondary); line-height: 1.6; margin: 0;">–ú–∞—Ç—á–∏ 1 –Ω–∞ 1 —Å —É—á–∞—Å—Ç–∏–µ–º –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–≥–æ –≤—Ä–∞—Ç–∞—Ä—è.</p>
      </article>
      <article style="padding-bottom: 24px; border-bottom: 1px solid var(--border); transition: all 0.3s;" onmouseover="this.style.paddingLeft='20px'; this.style.borderLeft='3px solid var(--accent)';" onmouseout="this.style.paddingLeft='0'; this.style.borderLeft='none';">
        <h3 style="font-size: 12px; font-weight: 800; text-transform: uppercase; color: var(--accent); margin-bottom: 8px; letter-spacing: 0.1em;">02. –¢–∞–π–º–∏–Ω–≥</h3>
        <p style="color: var(--text-secondary); line-height: 1.6; margin: 0;">–õ–∏–º–∏—Ç –Ω–∞ –∞—Ç–∞–∫—É ‚Äî 20 —Å–µ–∫—É–Ω–¥.</p>
      </article>
      <article style="transition: all 0.3s;" onmouseover="this.style.paddingLeft='20px'; this.style.borderLeft='3px solid var(--accent)';" onmouseout="this.style.paddingLeft='0'; this.style.borderLeft='none';">
        <h3 style="font-size: 12px; font-weight: 800; text-transform: uppercase; color: var(--accent); margin-bottom: 8px; letter-spacing: 0.1em;">03. –†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
        <p style="color: var(--text-secondary); line-height: 1.6; margin: 0;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã –¥–æ –¥–≤—É—Ö –≥–æ–ª–æ–≤, –±–µ–∑ –Ω–∏—á—å–∏.</p>
      </article>
    </div>
  </div>
</div>

<script>
const App = (function() {
  'use strict';
  
  const state = {
    players: [],
    filter: '–í—Å–µ',
    searchQuery: '',
    lastFocused: null
  };

  const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vREjbeB6jNrU01kw1npVtFTvqGdP134ERjmyROoOYeYXbzjgL0ZCNK6KwF0VTk3c1yxZEZEUsJjy2Ur/pub?output=csv';

  const createEl = (tag, classes = '', attrs = {}, text = '') => {
    const el = document.createElement(tag);
    if (classes) el.className = classes;
    Object.entries(attrs).forEach(([k, v]) => el.setAttribute(k, v));
    if (text) el.textContent = text;
    return el;
  };

  const showToast = (message, duration = 3000) => {
    const container = document.getElementById('toast-container');
    const toast = createEl('div', 'toast', {}, message);
    container.appendChild(toast);
    setTimeout(() => {
      toast.style.opacity = '0';
      setTimeout(() => toast.remove(), 500);
    }, duration);
  };

  const parseCSV = (text) => {
    const lines = text.split('\n').filter(l => l.trim());
    if (lines.length < 2) return [];
    
    const players = [];
    for (let i = 1; i < lines.length; i++) {
      const line = lines[i];
      const values = [];
      let current = '';
      let inQuotes = false;
      
      for (let j = 0; j < line.length; j++) {
        const char = line[j];
        const nextChar = line[j + 1];
        
        if (char === '"') {
          if (inQuotes && nextChar === '"') {
            current += '"';
            j++;
          } else {
            inQuotes = !inQuotes;
          }
        } else if (char === ',' && !inQuotes) {
          values.push(current.trim());
          current = '';
        } else {
          current += char;
        }
      }
      values.push(current.trim());
      
      const player = {
        name: values[0] || '',
        ovr: parseInt(values[1]) || 0,
        role: values[2] || '–ò–≥—Ä–æ–∫',
        drib: parseInt(values[3]) || 0,
        speed: parseInt(values[4]) || 0,
        shot: parseInt(values[5]) || 0,
        phys: parseInt(values[6]) || 0,
        photo: values[7] || '',
        status: values[8] || '',
        badges: values[9] ? values[9].split('|').map(b => b.trim()).filter(Boolean) : []
      };
      
      if (player.name && player.ovr) players.push(player);
    }
    return players;
  };

  const init = async () => {
    try {
      const response = await fetch(CSV_URL, { headers: { 'Accept': 'text/csv' } });
      if (!response.ok) throw new Error('Network error');
      const text = await response.text();
      state.players = parseCSV(text);
      
      render();
      setupEventListeners();
      setupDownloadButton();
      setupScrollReveal();
      setup3DTilt();
      
      setTimeout(() => document.getElementById('preloader').classList.add('loaded'), 500);
    } catch (error) {
      console.error(error);
      showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
      document.getElementById('preloader').classList.add('loaded');
    }
  };

  // Magnetic buttons effect
  const setupMagneticButtons = () => {
    document.querySelectorAll('.magnetic').forEach(btn => {
      btn.addEventListener('mousemove', (e) => {
        const rect = btn.getBoundingClientRect();
        const x = e.clientX - rect.left - rect.width / 2;
        const y = e.clientY - rect.top - rect.height / 2;
        
        btn.style.transform = `translate(${x * 0.2}px, ${y * 0.2}px)`;
        btn.style.setProperty('--x', `${(e.clientX - rect.left) / rect.width * 100}%`);
        btn.style.setProperty('--y', `${(e.clientY - rect.top) / rect.height * 100}%`);
      });
      
      btn.addEventListener('mouseleave', () => {
        btn.style.transform = 'translate(0, 0)';
      });
    });
  };

  // 3D Tilt effect for cards
  const setup3DTilt = () => {
    document.querySelectorAll('.tilt-card, .player-card').forEach(card => {
      card.addEventListener('mousemove', (e) => {
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        
        const rotateX = (y - centerY) / 20;
        const rotateY = (centerX - x) / 20;
        
        card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateZ(10px)`;
      });
      
      card.addEventListener('mouseleave', () => {
        card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) translateZ(0)';
      });
    });
  };

  // Scroll reveal animation
  const setupScrollReveal = () => {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('active');
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('[data-reveal]').forEach(el => {
      el.classList.add('reveal');
      observer.observe(el);
    });
  };

  const renderRoster = () => {
    const grid = document.getElementById('roster-grid');
    if (!grid) return;
    
    const filtered = state.players.filter(p => {
      const matchesSearch = p.name.toLowerCase().includes(state.searchQuery);
      const matchesRole = state.filter === '–í—Å–µ' || p.role === state.filter;
      return matchesSearch && matchesRole;
    });
    
    grid.innerHTML = '';
    
    if (filtered.length === 0) {
      grid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 60px; color: var(--text-secondary);">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>`;
      return;
    }
    
    const fragment = document.createDocumentFragment();
    
    filtered.forEach((p, index) => {
      const card = createEl('div', 'card player-card tilt-card', {
        tabindex: '0',
        style: `animation: fadeIn 0.5s ${index * 0.05}s backwards;`
      });
      
      const imgDiv = createEl('div', 'player-img');
      if (p.photo) {
        const img = new Image();
        img.onload = () => { imgDiv.style.backgroundImage = `url('${p.photo.replace(/'/g, "\\'")}')`; };
        img.src = p.photo;
      }
      
      const info = createEl('div', 'player-info');
      const role = createEl('span', '', {}, p.role);
      const name = createEl('h3', '', {}, p.name);
      
      info.appendChild(role);
      info.appendChild(name);
      
      if (p.badges.length) {
        const badges = createEl('div', 'player-badges', {}, p.badges[0]);
        info.appendChild(badges);
      }
      
      const ovr = createEl('span', 'ovr-badge', {}, p.ovr);
      
      card.appendChild(imgDiv);
      card.appendChild(info);
      card.appendChild(ovr);
      
      if (p.status) {
        const status = createEl('div', '', {
          style: 'position:absolute; top:20px; left:20px; background:rgba(0,0,0,0.8); color:var(--accent); padding:6px 16px; border-radius:100px; font-size:11px; font-weight:800; letter-spacing:1px; z-index:3; backdrop-filter:blur(10px);'
        }, p.status);
        card.appendChild(status);
      }
      
      card.addEventListener('click', () => openPlayerModal(p));
      card.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openPlayerModal(p);
        }
      });
      
      fragment.appendChild(card);
    });
    
    grid.appendChild(fragment);
    setup3DTilt(); // Re-attach tilt to new cards
  };

  const renderStats = () => {
    const tbody = document.getElementById('stats-body');
    if (!tbody) return;
    
    const sorted = [...state.players].sort((a, b) => b.ovr - a.ovr);
    tbody.innerHTML = '';
    
    const fragment = document.createDocumentFragment();
    
    sorted.forEach((p, i) => {
      const tr = createEl('tr', '', { tabindex: '0', style: `animation:fadeIn 0.3s ${i*0.03}s backwards` });
      
      tr.addEventListener('click', () => openPlayerModal(p));
      tr.addEventListener('keydown', (e) => { if(e.key==='Enter') openPlayerModal(p); });
      
      const tdPos = createEl('td', '', { style: 'font-weight:800; color:var(--text-secondary); font-variant-numeric:tabular-nums;' }, (i+1).toString().padStart(2,'0'));
      
      const tdPlayer = createEl('td');
      const row = createEl('div', 'player-row');
      
      const img = createEl('img', 'player-avatar-sm');
      img.onerror = function() {
        this.style.display='none';
        const fallback = createEl('div', '', {
          style: 'width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,var(--accent),#16a34a);display:flex;align-items:center;justify-content:center;color:white;font-weight:900;'
        }, p.name.charAt(0));
        row.insertBefore(fallback, row.firstChild);
      };
      if (p.photo) img.src = p.photo;
      
      const info = createEl('div', 'player-info-sm');
      info.appendChild(createEl('div', 'player-name-sm', {}, p.name));
      info.appendChild(createEl('div', 'player-role-sm', {}, p.role));
      
      row.appendChild(img);
      row.appendChild(info);
      tdPlayer.appendChild(row);
      
      const tdOvr = createEl('td', '', { style: 'text-align:right;' });
      const badge = createEl('span', 'ovr-badge', { style: 'margin:0; position:static; display:inline-flex;' }, p.ovr);
      tdOvr.appendChild(badge);
      
      tr.appendChild(tdPos);
      tr.appendChild(tdPlayer);
      tr.appendChild(tdOvr);
      fragment.appendChild(tr);
    });
    
    tbody.appendChild(fragment);
  };

  const openPlayerModal = (player) => {
    state.lastFocused = document.activeElement;
    
    document.getElementById('m-name').textContent = player.name;
    document.getElementById('m-role').textContent = player.role;
    document.getElementById('m-ovr').textContent = player.ovr;
    
    const img = document.getElementById('m-img');
    img.src = player.photo || '';
    img.onerror = () => { img.style.display='none'; };
    img.onload = () => { img.style.display='block'; };
    
    const badges = document.getElementById('m-badges');
    badges.innerHTML = '';
    player.badges.forEach(b => {
      badges.appendChild(createEl('span', '', { 
        style: 'background:var(--text); color:white; padding:6px 14px; border-radius:100px; font-size:11px; font-weight:800; text-transform:uppercase; letter-spacing:0.5px;' 
      }, b));
    });
    
    const statsDiv = document.getElementById('m-stats');
    const isGK = player.role === '–í—Ä–∞—Ç–∞—Ä—å';
    const stats = [
      { k: isGK?'REF':'DRI', v: player.drib, l: isGK?'–†–µ–∞–∫—Ü–∏—è':'–î—Ä–∏–±–ª–∏–Ω–≥' },
      { k: isGK?'DIV':'SPD', v: player.speed, l: isGK?'–ü—Ä—ã–∂–æ–∫':'–°–∫–æ—Ä–æ—Å—Ç—å' },
      { k: isGK?'HAN':'SHT', v: player.shot, l: isGK?'–†—É–∫–∏':'–£–¥–∞—Ä' },
      { k: isGK?'POS':'PHY', v: player.phys, l: isGK?'–ü–æ–∑–∏—Ü–∏—è':'–§–∏–∑–∏–∫–∞' }
    ];
    
    statsDiv.innerHTML = '';
    stats.forEach((s, i) => {
      const item = createEl('div', '', { style: 'margin-bottom:20px;' });
      item.innerHTML = `
        <div style="display:flex; justify-content:space-between; margin-bottom:8px; font-size:13px; font-weight:700;">
          <span style="color:var(--text-secondary); text-transform:uppercase; letter-spacing:1px;">${s.k} <span style="opacity:0.6; font-weight:500;">(${s.l})</span></span>
          <span style="color:var(--text);">${s.v}</span>
        </div>
        <div style="height:8px; background:rgba(0,0,0,0.05); border-radius:100px; overflow:hidden;">
          <div class="stat-bar-fill" id="bar-${i}" style="width:0%"></div>
        </div>
      `;
      statsDiv.appendChild(item);
      setTimeout(() => document.getElementById(`bar-${i}`).style.width = `${Math.min(s.v, 100)}%`, 100+i*100);
    });
    
    document.getElementById('playerModal').classList.add('active');
    document.body.style.overflow = 'hidden';
  };

  const closeModal = (id) => {
    document.getElementById(id).classList.remove('active');
    document.body.style.overflow = '';
    if (state.lastFocused) state.lastFocused.focus();
  };

  const setupDownloadButton = () => {
    const btn = document.getElementById('download-card');
    if (!btn) return;
    
    btn.addEventListener('click', async () => {
      btn.style.opacity = '0.5';
      showToast('–°–æ–∑–¥–∞—ë–º –∫–∞—Ä—Ç–æ—á–∫—É...');
      
      try {
        const card = document.getElementById('stats-card') || document.querySelector('.modal-content');
        const canvas = await html2canvas(card, {
          scale: 2,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#ffffff'
        });
        
        try {
          canvas.toDataURL();
        } catch(e) {
          showToast('CORS –æ—à–∏–±–∫–∞');
          return;
        }
        
        const name = document.getElementById('m-name').textContent.replace(/[^a-zA-Z–∞-—è–ê-–Ø0-9]/g, '_');
        const link = document.createElement('a');
        link.download = `BOX1V1_${name}.png`;
        link.href = canvas.toDataURL();
        link.click();
        showToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
      } catch (e) {
        showToast('–û—à–∏–±–∫–∞');
      } finally {
        btn.style.opacity = '';
      }
    });
  };

  const setupEventListeners = () => {
    document.getElementById('playerSearch')?.addEventListener('input', (e) => {
      state.searchQuery = e.target.value.toLowerCase();
      setTimeout(renderRoster, 100);
    });
    
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        state.filter = e.target.getAttribute('data-role');
        renderRoster();
      });
    });
    
    window.addEventListener('scroll', () => {
      document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 50);
    }, { passive: true });
    
    setupMagneticButtons();
  };

  const render = () => {
    renderRoster();
    renderStats();
  };

  return {
    init,
    switchTab: (id) => {
      document.querySelectorAll('section').forEach(s => {
        s.classList.remove('active');
        s.style.opacity = '0';
        s.style.transform = 'translateY(30px)';
      });
      document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
      
      const target = document.getElementById(id);
      target.classList.add('active');
      
      // Animate in
      setTimeout(() => {
        target.style.opacity = '1';
        target.style.transform = 'translateY(0)';
      }, 50);
      
      document.getElementById(`btn-${id}`)?.classList.add('active');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    },
    toggleMenu: () => {
      document.getElementById('mobile-drawer').classList.toggle('open');
      document.getElementById('drawer-overlay').classList.toggle('open');
      document.getElementById('burger').classList.toggle('open');
    },
    handleMobileNav: (id, isModal) => {
      App.toggleMenu();
      setTimeout(() => {
        if (isModal) {
          document.getElementById(id).classList.add('active');
          document.body.style.overflow = 'hidden';
        } else {
          App.switchTab(id);
        }
      }, 300);
    },
    openModal: (id) => {
      document.getElementById(id).classList.add('active');
      document.body.style.overflow = 'hidden';
    },
    closeModal,
    copyPlayerID: async () => {
      try {
        await navigator.clipboard.writeText(document.getElementById('m-name').textContent);
        showToast('ID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω');
      } catch { showToast('–û—à–∏–±–∫–∞'); }
    },
    sharePlayer: async () => {
      const url = window.location.href;
      if (navigator.share) {
        try { await navigator.share({ url }); } catch {}
      } else {
        try { await navigator.clipboard.writeText(url); showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞'); } catch {}
      }
    }
  };
})();

document.addEventListener('DOMContentLoaded', App.init);
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover"/>
<meta name="theme-color" content="#0a0a0a" id="theme-meta">
<title>BOX1V1 | –£–õ–ò–ß–ù–´–ô –§–£–¢–ë–û–õ 1 –ù–ê 1</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root {
  --bg: #fafafa;
  --bg-elevated: rgba(255, 255, 255, 0.8);
  --bg-card: #ffffff;
  --text: #0a0a0a;
  --text-secondary: #374151;
  --text-tertiary: #6b7280;
  --accent: #16a34a;
  --accent-gk: #f59e0b;
  --border: rgba(0,0,0,0.08);
  --border-strong: rgba(0,0,0,0.15);
  --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  --nav-h: 72px;
  --radius: 24px;
  --safe-top: env(safe-area-inset-top);
  --safe-bottom: env(safe-area-inset-bottom);
  --ease-out: cubic-bezier(0.2, 0, 0, 1);
}

[data-theme="dark"] {
  --bg: #0a0a0a;
  --bg-elevated: rgba(255, 255, 255, 0.05);
  --bg-card: #1a1a1a;
  --text: #fafafa;
  --text-secondary: #9ca3af;
  --text-tertiary: #6b7280;
  --border: rgba(255,255,255,0.1);
  --border-strong: rgba(255,255,255,0.2);
}

@media (max-width: 420px) { :root { --nav-h: 64px; } }

*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

html { scroll-behavior: smooth; background: var(--bg); color: var(--text); font-family: var(--font-sans); -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility; transition: background 0.3s, color 0.3s; }

body { background: var(--bg); color: var(--text); line-height: 1.6; overflow-x: hidden; min-height: 100vh; min-height: 100dvh; }

h1, h2, h3 { font-weight: 900; font-style: italic; letter-spacing: -0.03em; line-height: 1.1; text-transform: uppercase; color: var(--text); }

.skip-link { position: absolute; top: -40px; left: 0; background: var(--text); color: var(--bg); padding: 8px; text-decoration: none; z-index: 10000; transition: top 0.3s; }
.skip-link:focus { top: 0; }

/* Preloader */
#preloader { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.6s, visibility 0.6s; }
#preloader.loaded { opacity: 0; visibility: hidden; pointer-events: none; }
.preloader-logo { font-size: clamp(2rem, 8vw, 3rem); font-weight: 900; font-style: italic; color: var(--text); }

/* Toast */
#toast-container { position: fixed; bottom: max(24px, calc(var(--safe-bottom) + 8px)); left: 50%; transform: translateX(-50%); z-index: 10001; display: flex; flex-direction: column; gap: 10px; pointer-events: none; width: calc(100% - 40px); max-width: 400px; }
.toast { background: rgba(0,0,0,0.9); color: #fff; padding: 16px 24px; border-radius: 100px; font-size: 14px; font-weight: 600; animation: toastIn 0.4s forwards; pointer-events: auto; text-align: center; }
@keyframes toastIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

/* Nav */
nav { position: fixed; top: 0; left: 0; width: 100%; height: calc(var(--nav-h) + var(--safe-top)); padding-top: var(--safe-top); background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); z-index: 1000; border-bottom: 1px solid var(--border); transition: box-shadow 0.3s; }
[data-theme="dark"] nav { background: rgba(10,10,10,0.95); }
nav.scrolled { box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
.nav-inner { max-width: 1300px; margin: 0 auto; height: var(--nav-h); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }

.logo { font-size: 1.5rem; font-weight: 900; font-style: italic; letter-spacing: -0.03em; color: var(--text); text-decoration: none; }
.logo-accent { color: var(--accent); }

.nav-links { display: flex; gap: 8px; align-items: center; }
.nav-links a { font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-secondary); padding: 10px 20px; border-radius: 100px; text-decoration: none; transition: all 0.2s; min-height: 44px; display: inline-flex; align-items: center; }
.nav-links a:hover { color: var(--text); background: var(--bg-elevated); }
.nav-links a.active { background: var(--text); color: var(--bg); }

.theme-toggle { width: 44px; height: 44px; border-radius: 50%; border: 1px solid var(--border); background: var(--bg-elevated); cursor: pointer; margin-left: 8px; font-size: 18px; }

.burger { display: none; cursor: pointer; width: 44px; height: 44px; flex-direction: column; justify-content: center; align-items: center; gap: 5px; border-radius: 12px; background: var(--bg-elevated); border: none; }
.burger span { width: 20px; height: 2px; background: var(--text); border-radius: 2px; transition: all 0.3s; }
.burger.open span:nth-child(1) { transform: translateY(7px) rotate(45deg); }
.burger.open span:nth-child(2) { opacity: 0; }
.burger.open span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

.mobile-drawer { position: fixed; left: 0; right: 0; bottom: -100%; background: var(--bg-card); z-index: 2000; padding: 20px 24px calc(24px + var(--safe-bottom)); border-radius: 24px 24px 0 0; transition: bottom 0.4s; box-shadow: 0 -10px 40px rgba(0,0,0,0.15); }
.mobile-drawer.open { bottom: 0; }
.mobile-drawer a { display: block; font-size: 1.25rem; font-weight: 700; color: var(--text); padding: 16px 0; border-bottom: 1px solid var(--border); text-align: center; text-decoration: none; }
.drawer-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 1999; opacity: 0; visibility: hidden; transition: all 0.3s; }
.drawer-overlay.open { opacity: 1; visibility: visible; }

/* Main */
.main-content { max-width: 1300px; margin: 0 auto; padding: calc(var(--nav-h) + var(--safe-top) + 40px) 20px calc(40px + var(--safe-bottom)); min-height: 100vh; }

section { display: none; opacity: 0; animation: fadeIn 0.6s forwards; }
section.active { display: block; }
@keyframes fadeIn { to { opacity: 1; } }

/* Intro */
.intro-block { padding: 40px 0 60px; text-align: center; max-width: 900px; margin: 0 auto; }
.intro-block span { display: block; font-size: 12px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.2em; color: var(--accent); margin-bottom: 20px; }
.intro-block h1 { font-size: clamp(3rem, 10vw, 6rem); margin-bottom: 20px; }
.intro-block p { font-size: clamp(1.125rem, 2.5vw, 1.5rem); color: var(--text-secondary); max-width: 500px; margin: 0 auto 32px; line-height: 1.4; }

.btn-group { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-top: 32px; }
.btn { padding: 16px 28px; border-radius: 100px; font-weight: 700; text-transform: uppercase; font-size: 13px; letter-spacing: 0.03em; cursor: pointer; transition: all 0.25s; border: none; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; gap: 8px; min-height: 52px; min-width: 140px; background: var(--text); color: var(--bg); }
.btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
.btn-outline { background: transparent; border: 1.5px solid var(--border-strong); color: var(--text); }
.btn-outline:hover { background: var(--bg-elevated); }

/* Timer */
.timer-context { margin-top: 48px; padding: 24px 32px; background: var(--bg-elevated); border-radius: 20px; display: inline-flex; align-items: center; gap: 24px; border: 1px solid var(--border); flex-wrap: wrap; justify-content: center; }
.timer-label { font-size: 12px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.1em; }
.countdown { display: flex; gap: 16px; }
.countdown > div { text-align: center; min-width: 48px; }
.countdown-value { font-size: clamp(1.75rem, 4vw, 2.5rem); font-weight: 900; line-height: 1; font-variant-numeric: tabular-nums; color: var(--text); }
.countdown-label { font-size: 10px; font-weight: 700; color: var(--text-tertiary); text-transform: uppercase; margin-top: 4px; }

/* Grid */
.bento-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-top: 40px; }
.card { background: var(--bg-elevated); border-radius: var(--radius); border: 1px solid var(--border); padding: 28px; position: relative; overflow: hidden; transition: all 0.3s; cursor: pointer; display: flex; flex-direction: column; gap: 12px; }
.card:hover { transform: translateY(-4px); border-color: var(--border-strong); box-shadow: 0 12px 24px rgba(0,0,0,0.08); }
.card h2 { font-size: clamp(1.5rem, 3vw, 2rem); }
.card h3 { font-size: 1.25rem; }
.card p { color: var(--text-secondary); font-size: 0.9rem; line-height: 1.5; }
.card.span-2 { grid-column: span 2; }

/* Player Cards */
.player-card { min-height: 400px; background: linear-gradient(180deg, #3a3a3a 0%, #1a1a1a 100%); color: #fff; border: none; padding: 0; position: relative; }
.player-card .content { position: relative; z-index: 2; margin-top: auto; padding: 24px; display: flex; flex-direction: column; gap: 6px; }
.player-card h3 { font-size: clamp(1.5rem, 3vw, 2rem); line-height: 1.2; word-break: break-word; color: #fff; }
.player-img { position: absolute; inset: 0; background-size: cover; background-position: center top; opacity: 0.8; transition: opacity 0.3s, transform 0.5s; }
.player-card:hover .player-img { opacity: 1; transform: scale(1.05); }
.player-card::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 70%; background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.5) 50%, transparent 100%); z-index: 1; }
.player-role { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--accent); }
.player-role.gk { color: var(--accent-gk); }
.ovr-badge { display: inline-flex; align-items: center; padding: 6px 14px; background: var(--accent); color: #fff; border-radius: 100px; font-weight: 800; font-size: 13px; margin-top: 12px; width: fit-content; position: relative; z-index: 3; }
.ovr-badge.gk { background: var(--accent-gk); }
.status-badge { position: absolute; top: 16px; right: 16px; background: var(--accent); color: #fff; font-size: 10px; font-weight: 700; padding: 4px 10px; border-radius: 12px; z-index: 3; }
.status-badge.gk { background: var(--accent-gk); }
.compare-checkbox { position: absolute; top: 16px; left: 16px; z-index: 10; width: 28px; height: 28px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.5); background: rgba(0,0,0,0.3); cursor: pointer; display: flex; align-items: center; justify-content: center; color: transparent; font-size: 14px; transition: all 0.2s; }
.compare-checkbox:hover { border-color: #fff; background: rgba(0,0,0,0.5); }
.compare-checkbox.checked { background: var(--accent); border-color: var(--accent); color: #fff; }

/* Controls */
.controls-row { margin-bottom: 32px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; background: var(--bg-elevated); padding: 16px; border-radius: 20px; border: 1px solid var(--border); }
.search-input { padding: 12px 20px; border-radius: 100px; border: 1px solid var(--border); background: var(--bg-card); width: 100%; max-width: 320px; font-family: inherit; font-size: 14px; color: var(--text); outline: none; }
.search-input:focus { border-color: var(--accent); }
.filter-bar { display: flex; gap: 8px; flex-wrap: wrap; }
.filter-btn { padding: 10px 18px; border-radius: 100px; border: 1px solid var(--border); background: var(--bg-card); font-size: 12px; font-weight: 600; cursor: pointer; text-transform: uppercase; color: var(--text-secondary); min-height: 40px; transition: all 0.2s; }
.filter-btn:hover { border-color: var(--border-strong); color: var(--text); }
.filter-btn.active { background: var(--text); color: var(--bg); border-color: var(--text); }

/* Tables */
.table-wrapper { background: var(--bg-elevated); border-radius: var(--radius); border: 1px solid var(--border); overflow: hidden; overflow-x: auto; }
table { width: 100%; border-collapse: collapse; min-width: 400px; }
th { text-align: left; padding: 20px 24px; font-size: 11px; font-weight: 700; text-transform: uppercase; color: var(--text-tertiary); letter-spacing: 0.05em; border-bottom: 1px solid var(--border); white-space: nowrap; }
td { padding: 16px 24px; border-bottom: 1px solid var(--border); color: var(--text); }
tr:last-child td { border-bottom: none; }
tbody tr { cursor: pointer; transition: background 0.2s; }
tbody tr:hover { background: var(--bg-card); }
.player-row { display: flex; align-items: center; gap: 12px; }
.player-avatar-sm { width: 40px; height: 40px; border-radius: 12px; object-fit: cover; background: var(--border); }
.player-name-sm { font-weight: 700; text-transform: uppercase; font-style: italic; font-size: 0.95rem; color: var(--text); }
.player-role-sm { font-size: 11px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; }

/* Mobile Stats (Cards instead of table) */
.mobile-stats { display: none; gap: 12px; flex-direction: column; }
.mobile-stat-card { background: var(--bg-elevated); border: 1px solid var(--border); border-radius: 16px; padding: 16px; display: flex; align-items: center; gap: 16px; cursor: pointer; }
.mobile-stat-card .rank { font-size: 24px; font-weight: 900; font-style: italic; color: var(--text-tertiary); min-width: 40px; text-align: center; }
.mobile-stat-card .avatar { width: 48px; height: 48px; border-radius: 12px; object-fit: cover; background: var(--border); }
.mobile-stat-card .info { flex: 1; }
.mobile-stat-card .name { font-weight: 700; text-transform: uppercase; font-style: italic; font-size: 16px; color: var(--text); }
.mobile-stat-card .role { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }
.mobile-stat-card .ovr { font-size: 24px; font-weight: 900; font-style: italic; color: var(--accent); }

/* Compare Bar */
.compare-bar { position: fixed; bottom: -100px; left: 0; right: 0; background: var(--bg-card); border-top: 1px solid var(--border); padding: 16px 24px calc(16px + var(--safe-bottom)); display: flex; justify-content: space-between; align-items: center; z-index: 998; transition: bottom 0.3s; box-shadow: 0 -4px 20px rgba(0,0,0,0.1); }
.compare-bar.visible { bottom: 0; }
.compare-count { font-weight: 700; font-size: 14px; color: var(--text); }

/* Modals */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 3000; display: flex; justify-content: center; align-items: center; padding: 20px; opacity: 0; visibility: hidden; transition: all 0.3s; }
.modal-overlay.active { opacity: 1; visibility: visible; }
.modal-content { background: var(--bg-card); width: 100%; max-width: 480px; border-radius: 24px; padding: 32px; position: relative; max-height: 90vh; overflow-y: auto; border: 1px solid var(--border); color: var(--text); }
.modal-overlay.wide .modal-content { max-width: 900px; }
.modal-close { position: absolute; top: 16px; right: 16px; width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--border); background: var(--bg-card); cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text); z-index: 10; }
.modal-close:hover { background: var(--bg-elevated); }

#m-img-container { width: 100%; aspect-ratio: 1; max-height: 300px; border-radius: 16px; overflow: hidden; background: var(--bg-elevated); margin-bottom: 24px; position: relative; }
#m-img { width: 100%; height: 100%; object-fit: cover; }
.modal-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; gap: 16px; }
.modal-title { flex: 1; }
#m-role { display: inline-block; font-size: 11px; font-weight: 700; text-transform: uppercase; color: var(--accent); background: rgba(22,163,74,0.1); padding: 6px 12px; border-radius: 20px; margin-bottom: 8px; }
#m-role.gk { color: var(--accent-gk); background: rgba(245,158,11,0.1); }
#m-name { font-size: clamp(1.5rem, 5vw, 2rem); line-height: 1.2; color: var(--text); }
#m-ovr { font-size: 3rem; font-weight: 900; font-style: italic; color: var(--text); line-height: 1; }
#m-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 24px 0; }
.stat-item { position: relative; }
.stat-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 12px; font-weight: 700; text-transform: uppercase; color: var(--text-secondary); }
.stat-bar-bg { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
.stat-bar-fill { height: 100%; background: var(--text); border-radius: 4px; width: 0; transition: width 1s var(--ease-out); }
.stat-bar-fill.accent { background: var(--accent); }
.stat-bar-fill.gk { background: var(--accent-gk); }

/* Compare Modal Grid */
.compare-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 32px; margin-bottom: 32px; }
.compare-player { text-align: center; }
.compare-player img { width: 100%; max-width: 200px; aspect-ratio: 1; object-fit: cover; border-radius: 16px; margin-bottom: 16px; background: var(--bg-elevated); }
.compare-player h3 { margin-bottom: 4px; color: var(--text); }
.compare-player .role { font-size: 12px; text-transform: uppercase; color: var(--text-secondary); }

/* Form */
.form-group { margin-bottom: 20px; }
.form-label { display: block; font-size: 12px; font-weight: 700; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 8px; letter-spacing: 0.05em; }
.form-input, .form-select { width: 100%; padding: 14px 18px; border-radius: 12px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text); font-family: inherit; font-size: 15px; outline: none; }
.form-input:focus, .form-select:focus { border-color: var(--accent); }

/* Screenshot */
#screenshot-container { position: fixed; top: -9999px; left: -9999px; width: 480px; opacity: 0; pointer-events: none; }

/* Responsive */
@media (max-width: 1024px) { 
  .bento-grid { grid-template-columns: repeat(3, 1fr); } 
}
@media (max-width: 768px) { 
  .bento-grid { grid-template-columns: repeat(2, 1fr); } 
  .card.span-2 { grid-column: span 2; }
  .nav-links { display: none; }
  .burger { display: flex; }
}
@media (max-width: 640px) { 
  .bento-grid { grid-template-columns: 1fr; } 
  .card.span-2 { grid-column: 1; }
  .controls-row { flex-direction: column; align-items: stretch; }
  .search-input { max-width: 100%; }
  .filter-bar { overflow-x: auto; flex-wrap: nowrap; padding-bottom: 4px; }
  
  /* Hide table, show mobile cards */
  .table-wrapper { display: none; }
  .mobile-stats { display: flex; }
  
  #m-stats { grid-template-columns: 1fr; }
  .compare-grid { grid-template-columns: 1fr; gap: 24px; }
  .modal-content { padding: 24px; max-height: 100vh; border-radius: 0; }
}
@media (max-width: 480px) {
  .intro-block h1 { font-size: 2.5rem; }
  .timer-context { flex-direction: column; width: 100%; }
  .countdown { gap: 12px; }
  .btn { width: 100%; }
  .btn-group { flex-direction: column; }
}

/* Scrollbar */
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border-strong); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: var(--text-tertiary); }
</style>
</head>
<body>
<a href="#main" class="skip-link">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É</a>

<div id="preloader">
  <div class="preloader-logo">BOX<span class="logo-accent">1</span>V1</div>
</div>

<div id="toast-container"></div>

<nav id="navbar">
  <div class="nav-inner">
    <a href="#" class="logo" onclick="switchTab('home'); return false;">BOX<span class="logo-accent">1</span>V1</a>
    <div class="nav-links">
      <a href="#" onclick="switchTab('home'); return false;" id="btn-home" class="active">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="#" onclick="switchTab('roster'); return false;" id="btn-roster">–£—á–∞—Å—Ç–Ω–∏–∫–∏</a>
      <a href="#" onclick="switchTab('stats'); return false;" id="btn-stats">–†–µ–π—Ç–∏–Ω–≥</a>
      <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
    </div>
    <button class="burger" id="burger" onclick="toggleMenu()">
      <span></span><span></span><span></span>
    </button>
  </div>
</nav>

<div class="drawer-overlay" id="drawer-overlay" onclick="toggleMenu()"></div>
<div class="mobile-drawer" id="mobile-drawer">
  <a href="#" onclick="switchTab('home'); toggleMenu(); return false;">–ì–ª–∞–≤–Ω–∞—è</a>
  <a href="#" onclick="switchTab('roster'); toggleMenu(); return false;">–£—á–∞—Å—Ç–Ω–∏–∫–∏</a>
  <a href="#" onclick="switchTab('stats'); toggleMenu(); return false;">–†–µ–π—Ç–∏–Ω–≥</a>
  <div style="padding: 16px; border-top: 1px solid var(--border); margin-top: 8px; text-align: center;">
    <button class="theme-toggle" onclick="toggleTheme()" style="width: 100%; margin: 0;">–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É</button>
  </div>
  <div style="padding: 0 16px; margin-top: 16px;">
    <button class="btn" onclick="openModal('applyModal'); toggleMenu();" style="width: 100%;">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
  </div>
</div>

<main id="main" class="main-content">
  <!-- HOME -->
  <section id="home" class="active">
    <div class="intro-block">
      <span>The Next Gen Football</span>
      <h1>BOX1V1.</h1>
      <p>–†–µ—à–∞–µ—Ç –Ω–µ –∫–æ–º–∞–Ω–¥–∞.<br>–†–µ—à–∞–µ—à—å —Ç—ã.</p>
      <div class="btn-group">
        <button class="btn" onclick="switchTab('roster')">–£—á–∞—Å—Ç–Ω–∏–∫–∏</button>
        <button class="btn btn-outline" onclick="openModal('applyModal')">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
      </div>
      <div class="timer-context">
        <span class="timer-label">–î–æ —Å—Ç–∞—Ä—Ç–∞ —Å–µ–∑–æ–Ω–∞:</span>
        <div class="countdown">
          <div><div class="countdown-value" id="days">00</div><div class="countdown-label">–¥–Ω</div></div>
          <div><div class="countdown-value" id="hours">00</div><div class="countdown-label">—á—Å</div></div>
          <div><div class="countdown-value" id="mins">00</div><div class="countdown-label">–º–∏–Ω</div></div>
          <div><div class="countdown-value" id="secs">00</div><div class="countdown-label">—Å–µ–∫</div></div>
        </div>
      </div>
    </div>
    
    <div class="bento-grid">
      <div class="card span-2" onclick="openModal('rulesModal')">
        <span style="font-size:11px; font-weight:700; color:var(--accent); text-transform:uppercase;">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</span>
        <h2>–†–ï–ì–õ–ê–ú–ï–ù–¢.</h2>
        <p>–°–≤–æ–¥ –ø—Ä–∞–≤–∏–ª –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –º–∞—Ç—á–µ–π.</p>
        <div style="margin-top:auto; padding-top:20px; font-weight:700; font-size:12px; text-transform:uppercase; color:var(--text-secondary);">–ò–∑—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ ‚Üí</div>
      </div>
      <div class="card" onclick="window.open('https://t.me/streetbox1v1', '_blank')">
        <h3>TELEGRAM</h3>
        <p>–°–≤–µ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.</p>
      </div>
      <div class="card" onclick="window.open('https://instagram.com/box.1v1', '_blank')">
        <h3>INSTAGRAM</h3>
        <p>–ì–ª–∞–≤–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –≤ –º–µ–¥–∏–∞ —Ñ–æ—Ä–º–∞—Ç–µ.</p>
      </div>
    </div>
  </section>

  <!-- ROSTER -->
  <section id="roster">
    <div style="margin-bottom: 32px;">
      <h1 style="font-size: clamp(2rem, 8vw, 4rem);">–£–ß–ê–°–¢–ù–ò–ö–ò.</h1>
      <p style="font-size: 1.125rem; margin-top:8px; color: var(--text-secondary);">–í—ã–±–µ—Ä–∏—Ç–µ –¥–≤–æ–∏—Ö –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.</p>
    </div>
    
    <div class="controls-row">
      <input type="search" class="search-input" id="playerSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏..." oninput="handleSearch()">
      <div class="filter-bar">
        <button class="filter-btn active" onclick="setFilter('–í—Å–µ', this)">–í—Å–µ</button>
        <button class="filter-btn" onclick="setFilter('–ò–≥—Ä–æ–∫', this)">–ü–æ–ª–µ–≤—ã–µ</button>
        <button class="filter-btn" onclick="setFilter('–í—Ä–∞—Ç–∞—Ä—å', this)">–í—Ä–∞—Ç–∞—Ä–∏</button>
      </div>
    </div>
    
    <div class="bento-grid" id="roster-grid">
      <!-- Content loaded by JS -->
    </div>
  </section>

  <!-- STATS -->
  <section id="stats">
    <h1 style="font-size: clamp(2rem, 8vw, 4rem); margin-bottom:32px;">–†–ï–ô–¢–ò–ù–ì.</h1>
    
    <!-- Desktop Table -->
    <div class="table-wrapper" id="table-view">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>–ò–≥—Ä–æ–∫</th>
            <th style="text-align:right;">OVR</th>
          </tr>
        </thead>
        <tbody id="stats-body"></tbody>
      </table>
    </div>
    
    <!-- Mobile Cards -->
    <div class="mobile-stats" id="mobile-stats"></div>
  </section>
</main>

<!-- Compare Bar -->
<div class="compare-bar" id="compare-bar">
  <span class="compare-count">–í—ã–±—Ä–∞–Ω–æ: <span id="compare-count">0</span>/2</span>
  <div>
    <button class="btn btn-outline" onclick="clearCompare()" style="padding: 10px 20px; min-height: 40px; margin-right: 8px;">–°–±—Ä–æ—Å–∏—Ç—å</button>
    <button class="btn" onclick="openCompareModal()" id="compare-btn" disabled style="padding: 10px 24px; min-height: 40px;">–°—Ä–∞–≤–Ω–∏—Ç—å</button>
  </div>
</div>

<!-- Player Modal -->
<div class="modal-overlay" id="playerModal" onclick="if(event.target === this) closeModal('playerModal')">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal('playerModal')">‚úï</button>
    <button class="modal-close" style="right: 64px;" onclick="downloadCard()">‚¨á</button>
    
    <div id="m-img-container">
      <img id="m-img" src="" alt="" onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\'display:flex;align-items:center;justify-content:center;height:100%;font-size:80px;font-weight:900;background:var(--bg-elevated);color:var(--text-tertiary);\' id=\'m-initial\'></div>'">
    </div>
    
    <div class="modal-header">
      <div class="modal-title">
        <div id="m-role">ROLE</div>
        <h2 id="m-name">Name</h2>
      </div>
      <div id="m-ovr">99</div>
    </div>
    
    <div id="m-stats"></div>
    
    <div style="display:flex; gap:12px; margin-top:24px;">
      <button class="btn btn-outline" style="flex:1;" onclick="sharePlayer()">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
      <button class="btn" style="flex:1;" onclick="closeModal('playerModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>
</div>

<!-- Compare Modal -->
<div class="modal-overlay wide" id="compareModal" onclick="if(event.target === this) closeModal('compareModal')">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal('compareModal')">‚úï</button>
    <h2 style="text-align: center; margin-bottom: 24px; font-size: 1.5rem;">–°–†–ê–í–ù–ï–ù–ò–ï –ò–ì–†–û–ö–û–í</h2>
    <div class="compare-grid" id="compare-content"></div>
  </div>
</div>

<!-- Apply Modal -->
<div class="modal-overlay" id="applyModal" onclick="if(event.target === this) closeModal('applyModal')">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal('applyModal')">‚úï</button>
    <h2 style="margin-bottom: 24px;">–í–°–¢–£–ü–ò–¢–¨ –í BOX1V1</h2>
    <form onsubmit="handleApply(event)">
      <div class="form-group">
        <label class="form-label">–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è</label>
        <input type="text" class="form-input" id="apply-name" required placeholder="–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤">
      </div>
      <div class="form-group">
        <label class="form-label">–ü–æ–∑–∏—Ü–∏—è</label>
        <select class="form-select" id="apply-role" required>
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
          <option value="–ò–≥—Ä–æ–∫">–ü–æ–ª–µ–≤–æ–π –∏–≥—Ä–æ–∫</option>
          <option value="–í—Ä–∞—Ç–∞—Ä—å">–í—Ä–∞—Ç–∞—Ä—å</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Telegram –∏–ª–∏ –¢–µ–ª–µ—Ñ–æ–Ω</label>
        <input type="text" class="form-input" id="apply-contact" required placeholder="@username">
      </div>
      <button type="submit" class="btn" style="width:100%;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
    </form>
  </div>
</div>

<!-- Rules Modal -->
<div class="modal-overlay" id="rulesModal" onclick="if(event.target === this) closeModal('rulesModal')">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal('rulesModal')">‚úï</button>
    <h2 style="margin-bottom: 24px;">–†–ï–ì–õ–ê–ú–ï–ù–¢</h2>
    <div style="display:flex; flex-direction:column; gap:20px;">
      <div style="padding-bottom:20px; border-bottom:1px solid var(--border);">
        <h3 style="font-size:11px; color:var(--accent); margin-bottom:6px;">01. –§–û–†–ú–ê–¢</h3>
        <p style="color:var(--text-secondary);">–ú–∞—Ç—á–∏ 1 –Ω–∞ 1 —Å —É—á–∞—Å—Ç–∏–µ–º –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–≥–æ –≤—Ä–∞—Ç–∞—Ä—è.</p>
      </div>
      <div style="padding-bottom:20px; border-bottom:1px solid var(--border);">
        <h3 style="font-size:11px; color:var(--accent); margin-bottom:6px;">02. –¢–ê–ô–ú–ò–ù–ì</h3>
        <p style="color:var(--text-secondary);">–õ–∏–º–∏—Ç –Ω–∞ –∞—Ç–∞–∫—É ‚Äî 20 —Å–µ–∫—É–Ω–¥.</p>
      </div>
      <div>
        <h3 style="font-size:11px; color:var(--accent); margin-bottom:6px;">03. –†–ï–ó–£–õ–¨–¢–ê–¢</h3>
        <p style="color:var(--text-secondary);">–î–æ –¥–≤—É—Ö –≥–æ–ª–æ–≤, –±–µ–∑ –Ω–∏—á—å–∏.</p>
      </div>
    </div>
  </div>
</div>

<div id="screenshot-container"></div>

<script>
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vREjbeB6jNrU01kw1npVtFTvqGdP134ERjmyROoOYeYXbzjgL0ZCNK6KwF0VTk3c1yxZEZEUsJjy2Ur/pub?output=csv';
const TARGET_DATE = new Date("March 1, 2026 00:00:00").getTime();

let allPlayers = [];
let filteredPlayers = [];
let currentFilter = '–í—Å–µ';
let compareList = [];
let searchTimeout;

// Init
document.addEventListener('DOMContentLoaded', () => {
  initTheme();
  loadData();
  startTimer();
  
  window.addEventListener('hashchange', handleHash);
  handleHash();
  
  setTimeout(() => document.getElementById('preloader').classList.add('loaded'), 800);
});

// Theme
function initTheme() {
  const saved = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', saved);
  updateThemeIcon(saved);
}

function toggleTheme() {
  const current = document.documentElement.getAttribute('data-theme');
  const next = current === 'light' ? 'dark' : 'light';
  document.documentElement.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
  updateThemeIcon(next);
  document.getElementById('theme-meta').setAttribute('content', next === 'dark' ? '#0a0a0a' : '#fafafa');
}

function updateThemeIcon(theme) {
  const icon = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
  document.querySelector('.theme-toggle').textContent = icon;
}

// Data Loading
async function loadData() {
  try {
    const cached = localStorage.getItem('players');
    const lastFetch = localStorage.getItem('lastFetch');
    const isStale = !lastFetch || (Date.now() - parseInt(lastFetch) > 3600000);
    
    if (cached && (!navigator.onLine || !isStale)) {
      allPlayers = JSON.parse(cached);
      renderAll();
      return;
    }
    
    const response = await fetch(CSV_URL);
    const text = await response.text();
    allPlayers = parseCSV(text);
    
    localStorage.setItem('players', JSON.stringify(allPlayers));
    localStorage.setItem('lastFetch', Date.now());
    
    renderAll();
  } catch (e) {
    console.error(e);
    showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
    const cached = localStorage.getItem('players');
    if (cached) {
      allPlayers = JSON.parse(cached);
      renderAll();
    }
  }
}

function parseCSV(text) {
  const lines = text.trim().split('\n');
  if (lines.length < 2) return [];
  
  const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
  const getIdx = name => headers.findIndex(h => h.includes(name));
  
  const idx = {
    name: getIdx('name'),
    ovr: getIdx('ovr'),
    role: getIdx('role'),
    drib: getIdx('drib'),
    speed: getIdx('speed'),
    shot: getIdx('shot'),
    phys: getIdx('phys'),
    photo: getIdx('photo'),
    status: getIdx('status')
  };
  
  const players = [];
  for (let i = 1; i < lines.length; i++) {
    const cells = parseLine(lines[i]);
    if (cells[idx.name]) {
      players.push({
        name: cells[idx.name],
        ovr: parseInt(cells[idx.ovr]) || 0,
        role: cells[idx.role] || '–ò–≥—Ä–æ–∫',
        drib: parseInt(cells[idx.drib]) || 0,
        speed: parseInt(cells[idx.speed]) || 0,
        shot: parseInt(cells[idx.shot]) || 0,
        phys: parseInt(cells[idx.phys]) || 0,
        photo: cells[idx.photo] || '',
        status: cells[idx.status] || ''
      });
    }
  }
  return players;
}

function parseLine(line) {
  const cells = [];
  let cell = '', inQuotes = false;
  for (let i = 0; i < line.length; i++) {
    const char = line[i], next = line[i+1];
    if (char === '"') {
      if (inQuotes && next === '"') { cell += '"'; i++; }
      else { inQuotes = !inQuotes; }
    } else if (char === ',' && !inQuotes) {
      cells.push(cell.trim()); cell = '';
    } else { cell += char; }
  }
  cells.push(cell.trim());
  return cells;
}

// Rendering
function renderAll() {
  renderRoster();
  renderStats();
}

function renderRoster() {
  const grid = document.getElementById('roster-grid');
  const search = document.getElementById('playerSearch').value.toLowerCase();
  
  filteredPlayers = allPlayers.filter(p => {
    const matchesSearch = p.name.toLowerCase().includes(search);
    const matchesRole = currentFilter === '–í—Å–µ' || p.role === currentFilter;
    return matchesSearch && matchesRole;
  });
  
  if (filteredPlayers.length === 0) {
    grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:60px;color:var(--text-secondary);">–ò–≥—Ä–æ–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
    return;
  }
  
  grid.innerHTML = filteredPlayers.map((p, i) => {
    const isGK = p.role === '–í—Ä–∞—Ç–∞—Ä—å';
    const isSelected = compareList.includes(p.name);
    const id = 'player-' + i;
    
    return `
      <div class="card player-card" onclick="handleCardClick(event, '${escape(p.name)}')" style="animation:fadeIn 0.4s ${i*0.05}s both;">
        <div class="compare-checkbox ${isSelected ? 'checked' : ''}" onclick="event.stopPropagation(); toggleCompare('${escape(p.name)}')">
          ${isSelected ? '‚úì' : ''}
        </div>
        
        <div class="player-img" id="${id}-img" style="background-image:url('${p.photo}'); opacity: ${p.photo ? 0.9 : 0.3};">
          ${!p.photo ? `<div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:100px;font-weight:900;color:rgba(255,255,255,0.1);">${p.name.charAt(0)}</div>` : ''}
        </div>
        
        ${p.status ? `<div class="status-badge ${isGK ? 'gk' : ''}">${p.status}</div>` : ''}
        
        <div class="content">
          <div class="player-role ${isGK ? 'gk' : ''}">${p.role}</div>
          <h3>${p.name}</h3>
          <div class="ovr-badge ${isGK ? 'gk' : ''}">OVR ${p.ovr}</div>
        </div>
      </div>
    `;
  }).join('');
  
  // Load images
  filteredPlayers.forEach((p, i) => {
    if (!p.photo) return;
    const img = document.getElementById(`player-${i}-img`);
    const test = new Image();
    test.onload = () => img.style.opacity = '0.9';
    test.onerror = () => {
      img.style.opacity = '0.3';
      img.innerHTML = `<div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:100px;font-weight:900;color:rgba(255,255,255,0.1);">${p.name.charAt(0)}</div>`;
    };
    test.src = p.photo;
  });
}

function renderStats() {
  const sorted = [...allPlayers].sort((a, b) => b.ovr - a.ovr);
  
  // Desktop table
  document.getElementById('stats-body').innerHTML = sorted.map((p, i) => `
    <tr onclick="openPlayerModal('${escape(p.name)}')">
      <td style="font-weight:800;color:var(--text-tertiary);">${(i+1).toString().padStart(2,'0')}</td>
      <td>
        <div class="player-row">
          <img src="${p.photo || 'data:image/svg+xml,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'40\'><rect fill=\'%23ddd\' width=\'40\' height=\'40\'/><text x=\'50%\' y=\'50%\' text-anchor=\'middle\' dy=\'.3em\' fill=\'%23999\'>${p.name.charAt(0)}</text></svg>'}" 
               class="player-avatar-sm" onerror="this.src='data:image/svg+xml,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'40\'><rect fill=\'%23ddd\' width=\'40\' height=\'40\'/><text x=\'50%\' y=\'50%\' text-anchor=\'middle\' dy=\'.3em\' fill=\'%23999\'>${p.name.charAt(0)}</text></svg>'">
          <div>
            <div class="player-name-sm">${p.name}</div>
            <div class="player-role-sm">${p.role}</div>
          </div>
        </div>
      </td>
      <td style="text-align:right;"><span class="ovr-badge" style="${p.role==='–í—Ä–∞—Ç–∞—Ä—å'?'background:var(--accent-gk)':''}">${p.ovr}</span></td>
    </tr>
  `).join('');
  
  // Mobile cards
  document.getElementById('mobile-stats').innerHTML = sorted.map((p, i) => `
    <div class="mobile-stat-card" onclick="openPlayerModal('${escape(p.name)}')">
      <div class="rank">${(i+1).toString().padStart(2,'0')}</div>
      <img src="${p.photo || 'data:image/svg+xml,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'48\' height=\'48\'><rect fill=\'%23ddd\' width=\'48\' height=\'48\'/><text x=\'50%\' y=\'50%\' text-anchor=\'middle\' dy=\'.3em\' fill=\'%23999\'>${p.name.charAt(0)}</text></svg>'}" 
           class="avatar" onerror="this.src='data:image/svg+xml,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'48\' height=\'48\'><rect fill=\'%23ddd\' width=\'48\' height=\'48\'/><text x=\'50%\' y=\'50%\' text-anchor=\'middle\' dy=\'.3em\' fill=\'%23999\'>${p.name.charAt(0)}</text></svg>'">
      <div class="info">
        <div class="name">${p.name}</div>
        <div class="role">${p.role}</div>
      </div>
      <div class="ovr" style="${p.role==='–í—Ä–∞—Ç–∞—Ä—å'?'color:var(--accent-gk)':''}">${p.ovr}</div>
    </div>
  `).join('');
}

// Interactions
function handleCardClick(e, name) {
  if (e.target.closest('.compare-checkbox')) return;
  openPlayerModal(name);
}

function handleSearch() {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(renderRoster, 300);
}

function setFilter(role, btn) {
  currentFilter = role;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderRoster();
}

function toggleCompare(name) {
  const idx = compareList.indexOf(name);
  if (idx > -1) {
    compareList.splice(idx, 1);
  } else {
    if (compareList.length >= 2) {
      showToast('–ú–æ–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ 2 –∏–≥—Ä–æ–∫–∞');
      return;
    }
    compareList.push(name);
  }
  updateCompareBar();
  renderRoster();
}

function updateCompareBar() {
  const bar = document.getElementById('compare-bar');
  document.getElementById('compare-count').textContent = compareList.length;
  document.getElementById('compare-btn').disabled = compareList.length !== 2;
  
  if (compareList.length > 0) bar.classList.add('visible');
  else bar.classList.remove('visible');
}

function clearCompare() {
  compareList = [];
  updateCompareBar();
  renderRoster();
}

function openPlayerModal(name) {
  const p = allPlayers.find(x => x.name === name);
  if (!p) return;
  
  document.getElementById('m-name').textContent = p.name;
  document.getElementById('m-role').textContent = p.role;
  document.getElementById('m-role').className = p.role === '–í—Ä–∞—Ç–∞—Ä—å' ? 'gk' : '';
  document.getElementById('m-ovr').textContent = p.ovr;
  
  const img = document.getElementById('m-img');
  const container = document.getElementById('m-img-container');
  
  if (p.photo) {
    img.src = p.photo;
    img.style.display = 'block';
    const initial = container.querySelector('#m-initial');
    if (initial) initial.style.display = 'none';
  } else {
    img.style.display = 'none';
    container.innerHTML = `<div style="display:flex;align-items:center;justify-content:center;height:100%;font-size:80px;font-weight:900;background:var(--bg-elevated);color:var(--text-tertiary);">${p.name.charAt(0)}</div>`;
  }
  
  const isGK = p.role === '–í—Ä–∞—Ç–∞—Ä—å';
  const stats = [
    {k: isGK?'REF':'DRI', v: p.drib},
    {k: isGK?'DIV':'SPD', v: p.speed},
    {k: isGK?'HAN':'SHT', v: p.shot},
    {k: isGK?'POS':'PHY', v: p.phys}
  ];
  
  document.getElementById('m-stats').innerHTML = stats.map(s => `
    <div class="stat-item">
      <div class="stat-header">
        <span>${s.k}</span>
        <span>${s.v}</span>
      </div>
      <div class="stat-bar-bg">
        <div class="stat-bar-fill ${isGK?'gk':(s.v>=90?'accent':'')}" style="width:0%" data-w="${s.v}%"></div>
      </div>
    </div>
  `).join('');
  
  openModal('playerModal');
  
  // Animate bars
  setTimeout(() => {
    document.querySelectorAll('.stat-bar-fill').forEach(bar => {
      bar.style.width = bar.getAttribute('data-w');
    });
  }, 100);
  
  // Update URL
  const tab = document.querySelector('section.active').id;
  history.replaceState(null, null, `#${tab}?player=${encodeURIComponent(name)}`);
}

function openCompareModal() {
  if (compareList.length !== 2) return;
  const p1 = allPlayers.find(p => p.name === compareList[0]);
  const p2 = allPlayers.find(p => p.name === compareList[1]);
  
  document.getElementById('compare-content').innerHTML = `
    <div class="compare-player">
      <img src="${p1.photo || ''}" onerror="this.style.display='none'; this.parentElement.innerHTML+='<div style=\'width:200px;height:200px;background:var(--bg-elevated);border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:60px;font-weight:900;color:var(--text-tertiary);margin:0 auto 16px;\'>${p1.name.charAt(0)}</div>'">
      <h3>${p1.name}</h3>
      <div class="role">${p1.role} ‚Ä¢ OVR ${p1.ovr}</div>
      <div style="margin-top:16px;text-align:left;">
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;font-size:12px;text-transform:uppercase;">
          <span>${p1.role==='–í—Ä–∞—Ç–∞—Ä—å'?'REF':'DRI'}</span>
          <span>${p1.drib} vs ${p2.drib}</span>
        </div>
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;font-size:12px;text-transform:uppercase;">
          <span>${p1.role==='–í—Ä–∞—Ç–∞—Ä—å'?'DIV':'SPD'}</span>
          <span>${p1.speed} vs ${p2.speed}</span>
        </div>
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;font-size:12px;text-transform:uppercase;">
          <span>${p1.role==='–í—Ä–∞—Ç–∞—Ä—å'?'HAN':'SHT'}</span>
          <span>${p1.shot} vs ${p2.shot}</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:12px;text-transform:uppercase;">
          <span>${p1.role==='–í—Ä–∞—Ç–∞—Ä—å'?'POS':'PHY'}</span>
          <span>${p1.phys} vs ${p2.phys}</span>
        </div>
      </div>
    </div>
    <div class="compare-player">
      <img src="${p2.photo || ''}" onerror="this.style.display='none'; this.parentElement.innerHTML+='<div style=\'width:200px;height:200px;background:var(--bg-elevated);border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:60px;font-weight:900;color:var(--text-tertiary);margin:0 auto 16px;\'>${p2.name.charAt(0)}</div>'">
      <h3>${p2.name}</h3>
      <div class="role">${p2.role} ‚Ä¢ OVR ${p2.ovr}</div>
    </div>
  `;
  
  openModal('compareModal');
}

function openModal(id) {
  document.getElementById(id).classList.add('active');
  document.body.style.overflow = 'hidden';
  if (navigator.vibrate) navigator.vibrate(10);
}

function closeModal(id) {
  document.getElementById(id).classList.remove('active');
  document.body.style.overflow = '';
}

function handleApply(e) {
  e.preventDefault();
  const name = document.getElementById('apply-name').value;
  const role = document.getElementById('apply-role').value;
  const contact = document.getElementById('apply-contact').value;
  const text = `–ó–∞—è–≤–∫–∞ BOX1V1:%0A%0A–ò–º—è: ${name}%0A–ü–æ–∑–∏—Ü–∏—è: ${role}%0A–ö–æ–Ω—Ç–∞–∫—Ç: ${contact}`;
  window.open(`https://t.me/streetbox1v1?start=apply&text=${text}`, '_blank');
  closeModal('applyModal');
  showToast('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');
  e.target.reset();
}

function sharePlayer() {
  const name = document.getElementById('m-name').textContent;
  const url = window.location.href;
  if (navigator.share) {
    navigator.share({title: `BOX1V1 | ${name}`, text: `–ö–∞—Ä—Ç–æ—á–∫–∞ –∏–≥—Ä–æ–∫–∞ ${name}`, url: url});
  } else {
    navigator.clipboard.writeText(url);
    showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞');
  }
}

async function downloadCard() {
  const btn = event.target;
  btn.disabled = true;
  showToast('–°–æ–∑–¥–∞—ë–º –∫–∞—Ä—Ç–æ—á–∫—É...');
  
  try {
    const container = document.getElementById('screenshot-container');
    const original = document.querySelector('#playerModal .modal-content');
    const clone = original.cloneNode(true);
    clone.querySelectorAll('button').forEach(b => b.remove());
    clone.style.cssText = 'position:static;max-height:none;overflow:visible;width:480px;padding:32px;border-radius:24px;background:white;color:#0a0a0a;';
    container.innerHTML = '';
    container.appendChild(clone);
    
    const canvas = await html2canvas(clone, {scale: 2, backgroundColor: '#fff', width: 480});
    const link = document.createElement('a');
    link.download = `BOX1V1_${document.getElementById('m-name').textContent}.png`;
    link.href = canvas.toDataURL();
    link.click();
    showToast('–ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
  } catch (e) {
    console.error(e);
    showToast('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è');
  } finally {
    btn.disabled = false;
  }
}

// Utils
function startTimer() {
  function update() {
    const diff = TARGET_DATE - Date.now();
    if (diff <= 0) {
      document.getElementById('days').textContent = '00';
      document.getElementById('hours').textContent = '00';
      document.getElementById('mins').textContent = '00';
      document.getElementById('secs').textContent = '00';
      return;
    }
    document.getElementById('days').textContent = Math.floor(diff / 86400000).toString().padStart(2,'0');
    document.getElementById('hours').textContent = Math.floor((diff % 86400000) / 3600000).toString().padStart(2,'0');
    document.getElementById('mins').textContent = Math.floor((diff % 3600000) / 60000).toString().padStart(2,'0');
    document.getElementById('secs').textContent = Math.floor((diff % 60000) / 1000).toString().padStart(2,'0');
  }
  update();
  setInterval(update, 1000);
}

function switchTab(id) {
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
  document.getElementById(`btn-${id}`)?.classList.add('active');
  window.scrollTo({top: 0, behavior: 'smooth'});
  history.pushState(null, null, `#${id}`);
}

function toggleMenu() {
  document.getElementById('mobile-drawer').classList.toggle('open');
  document.getElementById('drawer-overlay').classList.toggle('open');
  document.getElementById('burger').classList.toggle('open');
}

function handleHash() {
  const hash = window.location.hash.replace('#', '').split('?')[0];
  if (['home', 'roster', 'stats'].includes(hash)) {
    switchTab(hash);
  }
  
  const params = new URLSearchParams(window.location.search);
  const player = params.get('player');
  if (player) {
    setTimeout(() => openPlayerModal(decodeURIComponent(player)), 500);
  }
}

function showToast(msg) {
  const t = document.createElement('div');
  t.className = 'toast';
  t.textContent = msg;
  document.getElementById('toast-container').appendChild(t);
  setTimeout(() => {
    t.style.opacity = '0';
    setTimeout(() => t.remove(), 500);
  }, 3000);
}

function escape(str) {
  return str.replace(/'/g, "\\'").replace(/"/g, '\\"');
}

// Scroll handler for nav
window.addEventListener('scroll', () => {
  document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 50);
});
</script>
</body>
</html>

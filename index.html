<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>BOX1V1 | ЦИФРОВАЯ ЭКОСИСТЕМА</title>
<meta name="description" content="BOX1V1 — закрытая экосистема для футболистов 1 на 1. Техника, медиа и скаутинг.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://box1v1.ru/">
<meta property="og:title" content="BOX1V1 | ЦИФРОВАЯ ЭКОСИСТЕМА">
<meta property="og:description" content="Стань частью элитарного сообщества футболистов 1x1. Рейтинги, карточки и статистика.">
<meta property="og:image" content="https://box1v1.ru/preview-og.jpg">

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
<style>
:root {
--bg: #ffffff;
--bg-alt: #f8f8f8;
--card: #ffffff;
--text: #0a0a0a;
--text-dim: #6b7280;
--border: rgba(0,0,0,0.06);
--accent: #22c55e;
--accent-dark: #16a34a;
--ls-tight: -0.04em;
--ls-normal: -0.01em;
--lh-tight: 1.1;
--lh-base: 1.6;
--radius: 24px;
--radius-sm: 14px;
}
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html { scroll-behavior: smooth; background: var(--bg); -webkit-font-smoothing: antialiased; }
body { font-family: 'Inter', system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; line-height: var(--lh-base); letter-spacing: var(--ls-normal); }
h1, h2, h3 { font-weight: 900; font-style: italic; letter-spacing: var(--ls-tight); line-height: var(--lh-tight); text-transform: uppercase; }

/* UX */
.stat-item { position: relative; }
.stat-header { display: flex; align-items: center; gap: 6px; cursor: help; }
.info-icon { width: 14px; height: 14px; border-radius: 50%; border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 8px; color: var(--text-dim); font-style: normal; font-weight: 800; }
.stat-header:hover .info-icon { background: var(--text); color: #fff; border-color: var(--text); }
.stat-header::after { content: attr(data-tip); position: absolute; bottom: calc(100% + 10px); left: 0; background: #000; color: #fff; padding: 10px 14px; border-radius: 12px; font-size: 11px; font-weight: 500; width: 200px; opacity: 0; visibility: hidden; transform: translateY(10px); transition: 0.4s cubic-bezier(0.2, 0, 0, 1); z-index: 100; pointer-events: none; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
.stat-header:hover::after { opacity: 1; visibility: visible; transform: translateY(0); }

/* NAVIGATION */
nav { position: fixed; top: 0; left: 0; width: 100%; height: 72px; background: rgba(255,255,255,0.8); backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px); z-index: 1000; transition: 0.4s; border-bottom: 1px solid transparent; }
body.scrolled nav { border-bottom: 1px solid var(--border); background: rgba(255,255,255,0.95); height: 64px; }
.nav-inner { max-width: 1300px; margin: 0 auto; height: 100%; display: flex; align-items: center; justify-content: space-between; padding: 0 32px; }
.logo { font-size: 1.4rem; font-weight: 900; font-style: italic; cursor: pointer; }
.nav-links { display: flex; gap: 8px; }
.nav-links a { text-decoration: none; font-size: 12px; font-weight: 700; text-transform: uppercase; color: var(--text-dim); padding: 10px 20px; border-radius: var(--radius-sm); transition: 0.3s; }
.nav-links a.active { color: #fff; background: var(--text); }

/* BURGER */
.burger { display: none; width: 40px; height: 40px; border-radius: 12px; background: var(--bg-alt); border: none; flex-direction: column; align-items: center; justify-content: center; gap: 4px; cursor: pointer; }
.burger span { width: 20px; height: 2px; background: var(--text); border-radius: 2px; transition: 0.3s; }
.mobile-menu { position: fixed; inset: 0; background: #fff; z-index: 2000; padding: 100px 32px; display: none; flex-direction: column; gap: 16px; }
.mobile-menu.active { display: flex; }
.mobile-menu a { font-size: 2rem; font-weight: 900; font-style: italic; text-decoration: none; color: var(--text); text-transform: uppercase; }

/* HERO */
.hero { padding: 160px 32px 80px; text-align: center; max-width: 900px; margin: 0 auto; }
.hero h1 { font-size: clamp(3rem, 10vw, 6rem); margin-bottom: 24px; }
.hero p { font-size: 1.25rem; color: var(--text-dim); max-width: 600px; margin: 0 auto 40px; }

/* TIMER */
.timer-container { background: var(--bg-alt); padding: 40px; border-radius: var(--radius); margin-top: 60px; border: 1px solid var(--border); }
.timer-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-top: 24px; }
.timer-box { background: #fff; padding: 20px; border-radius: var(--radius-sm); }
.timer-val { font-size: 2.5rem; font-weight: 900; font-style: italic; display: block; }
.timer-label { font-size: 10px; font-weight: 700; color: var(--text-dim); text-transform: uppercase; }

/* CONTENT SECTIONS */
.main-content { max-width: 1300px; margin: 0 auto; padding: 0 32px 100px; }
section { display: none; opacity: 0; }
section.active { display: block; animation: fadeInUp 0.8s forwards; }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

/* CARDS */
.bento-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; margin-top: 40px; }
.card { background: var(--card); border-radius: var(--radius); border: 1px solid var(--border); padding: 32px; transition: 0.5s; cursor: pointer; }
.card:hover { transform: translateY(-8px); border-color: rgba(0,0,0,0.15); box-shadow: 0 20px 40px rgba(0,0,0,0.04); }

.player-card { height: 420px; background: #000; color: #fff; position: relative; overflow: hidden; border: none; }
.player-img { position: absolute; inset: 0; background-size: cover; background-position: center top; filter: grayscale(1); opacity: 0.5; transition: 1s cubic-bezier(0.2, 0, 0, 1); }
.player-card:hover .player-img { filter: grayscale(0); opacity: 0.7; transform: scale(1.05); }
.player-info { position: relative; z-index: 2; height: 100%; display: flex; flex-direction: column; justify-content: flex-end; }
.ovr-badge { display: inline-block; padding: 4px 12px; background: var(--accent); color: #000; border-radius: 10px; font-weight: 900; font-size: 11px; margin-top: 8px; width: fit-content; }

/* MODAL - ОБНОВЛЕННЫЕ РАЗМЕРЫ */
.modal-overlay { position: fixed; inset: 0; background: rgba(255,255,255,0.8); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); z-index: 3000; display: flex; justify-content: center; align-items: center; padding: 20px; opacity: 0; pointer-events: none; transition: 0.4s; }
.modal-overlay.active { opacity: 1; pointer-events: auto; }
.modal-content { 
    background: #fff; 
    width: 100%; 
    max-width: 500px; /* Уменьшено с 540 */
    border-radius: 32px; 
    padding: 32px; 
    position: relative; 
    box-shadow: 0 40px 80px rgba(0,0,0,0.1); 
    transform: translateY(20px); 
    transition: 0.5s;
    /* Убрали max-height и скролл */
}
.modal-overlay.active .modal-content { transform: translateY(0); }
.modal-close { position: absolute; top: 20px; right: 20px; width: 44px; height: 44px; background: var(--bg-alt); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 100; border: none; }

#m-img-container { 
    width: 100%; 
    height: 280px; /* Уменьшено с 320 */
    border-radius: 20px; 
    overflow: hidden; 
    background: #f0f0f0; 
    margin-bottom: 24px; 
}
#m-img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }

/* BUTTONS */
.btn { padding: 16px 24px; border-radius: 16px; font-weight: 800; text-transform: uppercase; font-size: 12px; cursor: pointer; transition: 0.3s; border: none; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
.btn-primary { background: var(--text); color: #fff; flex: 1; }
.btn-outline { background: transparent; border: 1.5px solid var(--border); color: var(--text); flex: 1; }

/* Кнопка скачивания (иконка) */
.btn-download-icon {
    width: 48px;
    height: 48px;
    background: #f0f0f0;
    border: 1px solid #ddd;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: 0.2s;
    flex-shrink: 0;
}
.btn-download-icon:hover { background: #e8e8e8; }

/* PRELOADER */
#preloader { position: fixed; inset: 0; background: #fff; z-index: 9999; display: flex; justify-content: center; align-items: center; transition: 0.8s cubic-bezier(0.85, 0, 0.15, 1); }
#preloader.loaded { opacity: 0; visibility: hidden; }

@media (max-width: 1024px) { .bento-grid { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 768px) {
    .nav-links { display: none; }
    .burger { display: flex; }
    .bento-grid { grid-template-columns: 1fr; gap: 16px; }
    .hero h1 { font-size: 3.5rem; }
    .timer-grid { grid-template-columns: repeat(2, 1fr); }
    .player-card { height: 380px; } /* Уменьшено с 420 */
    .modal-content { padding: 24px; }
    #m-img-container { height: 240px; }
}
</style>
</head>
<body>

<div id="preloader">
    <h2 style="font-size: 2.5rem;">BOX<span style="color:var(--accent)">1</span>V1</h2>
</div>

<nav id="navbar">
    <div class="nav-inner">
        <div class="logo" onclick="switchTab('home')">BOX<span style="color:var(--accent)">1</span>V1</div>
        <div class="nav-links">
            <a href="#home" onclick="switchTab('home')" class="active" id="btn-home">Главная</a>
            <a href="#roster" onclick="switchTab('roster')" id="btn-roster">Участники</a>
            <a href="#stats" onclick="switchTab('stats')" id="btn-stats">Рейтинг</a>
            <a href="#about" onclick="switchTab('about')" id="btn-about">О системе</a>
        </div>
        <button class="burger" onclick="toggleMobileMenu()">
            <span></span><span></span>
        </button>
    </div>
</nav>

<div class="mobile-menu" id="mobileMenu">
    <a href="#home" onclick="handleMobileNav('home')">Главная</a>
    <a href="#roster" onclick="handleMobileNav('roster')">Участники</a>
    <a href="#stats" onclick="handleMobileNav('stats')">Рейтинг</a>
    <a href="#about" onclick="handleMobileNav('about')">О системе</a>
</div>

<main class="main-content">
    <section id="home" class="active">
        <div class="hero">
            <h1>BOX1V1.</h1>
            <p>Первая закрытая экосистема для футболистов 1 на 1. Мы создаем новый стандарт индустрии: от техники до медиа-сопровождения.</p>
            <div style="display:flex; gap:12px; justify-content:center;">
                <button class="btn btn-primary" onclick="switchTab('roster')">Смотреть ростер</button>
                <button class="btn btn-outline" onclick="switchTab('about')">Узнать больше</button>
            </div>
            
            <div class="timer-container">
                <h3 id="timer-status">До открытия сезона 2.0</h3>
                <div class="timer-grid" id="timer">
                    <div class="timer-box"><span class="timer-val" id="days">00</span><span class="timer-label">Дней</span></div>
                    <div class="timer-box"><span class="timer-val" id="hours">00</span><span class="timer-label">Часов</span></div>
                    <div class="timer-box"><span class="timer-val" id="mins">00</span><span class="timer-label">Минут</span></div>
                    <div class="timer-box"><span class="timer-val" id="secs">00</span><span class="timer-label">Секунд</span></div>
                </div>
            </div>
        </div>
    </section>

    <section id="roster">
        <div style="padding: 120px 0 40px;">
            <h2>УЧАСТНИКИ СЕЗОНА.</h2>
            <div style="margin-top:24px; display:flex; gap:12px;">
                <input type="text" id="playerSearch" class="btn-outline" style="flex:1; max-width:400px; text-transform:none; font-weight:500;" placeholder="Поиск по имени или позиции..." oninput="renderRoster()">
            </div>
        </div>
        <div class="bento-grid" id="roster-grid"></div>
    </section>

    <section id="stats">
        <div style="padding: 120px 0 40px;">
            <h2>ТАБЛИЦА РЕЙТИНГА.</h2>
            <p style="margin-top:12px; color:var(--text-dim)">Рейтинг обновляется после каждого игрового дня.</p>
        </div>
        <div id="stats-body"></div>
    </section>

    <section id="about">
        <div style="padding: 120px 0 40px;">
            <h2>О ПРОЕКТЕ.</h2>
            <div class="card" style="margin-top:32px; line-height:1.8;">
                BOX1V1 — это не просто турнир. Это платформа для роста атлетов. Мы оцифровываем навыки каждого игрока, создаем уникальный контент и открываем двери в профессиональный медиа-футбол. 
            </div>
        </div>
    </section>
</main>

<div class="modal-overlay" id="playerModal" onclick="closeModal('playerModal')">
    <div class="modal-content" id="capture-area" onclick="event.stopPropagation()">
        <button class="modal-close" onclick="closeModal('playerModal')" data-html2canvas-ignore>✕</button>
        
        <div id="m-img-container">
            <img id="m-img" src="" alt="Player" crossorigin="anonymous">
        </div>

        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
            <div>
                <span id="m-role" style="font-size:10px; font-weight:800; text-transform:uppercase; color:var(--accent-dark); background:rgba(34,197,94,0.1); padding:4px 10px; border-radius:8px;">ROLE</span>
                <h2 id="m-name" style="font-size: 2.2rem; margin-top:8px; line-height:1;">NAME</h2>
                <div id="m-badges" style="display:flex; gap:6px; margin-top:12px;"></div>
            </div>
            <div id="m-ovr" style="font-size: 3rem; font-weight:900; font-style:italic; letter-spacing:-2px; line-height:0.8;">99</div>
        </div>

        <div id="m-stats" style="margin-top:24px; display:grid; grid-template-columns: 1fr 1fr; gap:20px;"></div>

        <div class="modal-actions" style="margin-top:32px; display:flex; gap:12px;" data-html2canvas-ignore>
            <button class="btn-download-icon" onclick="downloadCard()" title="Скачать карточку">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            </button>
            <button class="btn btn-primary" onclick="sharePlayer()">Поделиться</button>
        </div>
    </div>
</div>

<div id="toast-container" style="position:fixed; bottom:32px; left:50%; transform:translateX(-50%); z-index:10000; pointer-events:none;"></div>

<script>
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vREjbeB6jNrU01kw1npVtFTvqGdP134ERjmyROoOYeYXbzjgL0ZCNK6KwF0VTk3c1yxZEZEUsJjy2Ur/pub?output=csv';
const TARGET_DATE = new Date('2025-07-01T00:00:00').getTime();

let allPlayers = [];

const statDefs = {
    'DRI': 'Техника контроля мяча и дриблинг', 'SPD': 'Стартовая и дистанционная скорость',
    'SHT': 'Сила и точность удара', 'PHY': 'Физическая выносливость и борьба',
    'REF': 'Скорость реакции', 'DIV': 'Техника прыжка', 'HAN': 'Надежность игры руками', 'POS': 'Выбор позиции'
};

async function init() {
    try {
        const res = await fetch(CSV_URL);
        const text = await res.text();
        allPlayers = parseCSV(text);
        renderRoster();
        updateTimer();
        setInterval(updateTimer, 1000);
        document.getElementById('preloader').classList.add('loaded');
    } catch (e) {
        showToast("Ошибка подключения к системе");
    }
}

function parseCSV(text) {
    const rows = text.replace(/\r/g, '').split('\n').filter(row => row.trim());
    return rows.slice(1).map(row => {
        const columns = row.split(',').map(v => v.replace(/^"|"$/g, '').trim());
        return {
            name: columns[0], ovr: parseInt(columns[1]), role: columns[2],
            drib: columns[3], speed: columns[4], shot: columns[5], phys: columns[6],
            photo: columns[7], club: columns[8], badges: columns[9] ? columns[9].split('|') : []
        };
    }).filter(p => p.name);
}

function renderRoster() {
    const grid = document.getElementById('roster-grid');
    const query = document.getElementById('playerSearch').value.toLowerCase();
    const filtered = allPlayers.filter(p => p.name.toLowerCase().includes(query) || p.role.toLowerCase().includes(query));
    
    grid.innerHTML = filtered.map(p => `
        <div class="card player-card" onclick="openPlayerModal('${p.name}')">
            <div class="player-img" style="background-image: url('${p.photo}')"></div>
            <div class="player-info">
                <span style="font-size:10px; color:var(--accent); font-weight:800; text-transform:uppercase;">${p.role}</span>
                <h3 style="font-size:1.6rem; margin-top:4px;">${p.name}</h3>
                <div class="ovr-badge">OVR ${p.ovr}</div>
            </div>
        </div>
    `).join('');
}

function openPlayerModal(name) {
    const p = allPlayers.find(x => x.name === name);
    if(!p) return;

    document.getElementById('m-name').innerText = p.name;
    document.getElementById('m-role').innerText = p.role;
    document.getElementById('m-ovr').innerText = p.ovr;
    
    const img = document.getElementById('m-img');
    img.src = ""; // Сброс для CORS
    img.src = p.photo;

    document.getElementById('m-badges').innerHTML = p.badges.map(b => `<span style="font-size:9px; background:var(--text); color:#fff; padding:4px 10px; border-radius:8px; font-weight:800; text-transform:uppercase;">${b}</span>`).join('');

    const isGK = p.role === 'Вратарь';
    const stats = [
        { label: isGK ? 'REF' : 'DRI', value: p.drib },
        { label: isGK ? 'DIV' : 'SPD', value: p.speed },
        { label: isGK ? 'HAN' : 'SHT', value: p.shot },
        { label: isGK ? 'POS' : 'PHY', value: p.phys }
    ];

    document.getElementById('m-stats').innerHTML = stats.map(s => `
        <div class="stat-item">
            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                <div class="stat-header" data-tip="${statDefs[s.label]}">
                    <span style="font-size:11px; font-weight:900; letter-spacing:0.05em;">${s.label}</span>
                    <i class="info-icon">?</i>
                </div>
                <span style="font-size:11px; font-weight:900;">${s.value}</span>
            </div>
            <div style="height:4px; background:var(--bg-alt); border-radius:2px; overflow:hidden;">
                <div style="width: ${s.value}%; height:100%; background:var(--text); border-radius:2px;"></div>
            </div>
        </div>
    `).join('');

    document.getElementById('playerModal').classList.add('active');
}

function closeModal(id) {
    document.getElementById(id).classList.remove('active');
}

// ФУНКЦИЯ СКАЧИВАНИЯ КАРТОЧКИ
function downloadCard() {
    const area = document.getElementById('capture-area');
    const name = document.getElementById('m-name').innerText;
    showToast("Генерация изображения...");

    html2canvas(area, {
        useCORS: true,
        allowTaint: false,
        backgroundColor: "#ffffff",
        scale: 2,
        logging: false
    }).then(canvas => {
        const link = document.createElement('a');
        link.download = `BOX1V1_${name}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
        showToast("Карточка сохранена!");
    }).catch(err => {
        showToast("Ошибка при сохранении");
        console.error(err);
    });
}

function toggleMobileMenu() {
    document.getElementById('mobileMenu').classList.toggle('active');
}

function handleMobileNav(id) {
    toggleMobileMenu();
    setTimeout(() => switchTab(id), 400);
}

function switchTab(id) {
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
    if(document.getElementById('btn-' + id)) document.getElementById('btn-' + id).classList.add('active');
    window.scrollTo(0,0);
}

function updateTimer() {
    const diff = TARGET_DATE - Date.now();
    const timerEl = document.getElementById('timer');
    if(diff <= 0) {
        document.getElementById('timer-status').innerText = "Сезон открыт!";
        if(timerEl) timerEl.style.display = 'none';
        return;
    }
    document.getElementById('days').innerText = Math.floor(diff / 864e5).toString().padStart(2, '0');
    document.getElementById('hours').innerText = Math.floor((diff % 864e5) / 36e5).toString().padStart(2, '0');
    document.getElementById('mins').innerText = Math.floor((diff % 36e5) / 6e4).toString().padStart(2, '0');
    document.getElementById('secs').innerText = Math.floor((diff % 6e4) / 1000).toString().padStart(2, '0');
}

function sharePlayer() {
    const name = document.getElementById('m-name').innerText;
    if(navigator.share) {
        navigator.share({ title: 'BOX1V1', text: `Карточка игрока ${name}`, url: window.location.href });
    } else {
        navigator.clipboard.writeText(window.location.href);
        showToast("Ссылка скопирована");
    }
}

function showToast(msg) {
    const container = document.getElementById('toast-container');
    const t = document.createElement('div');
    t.style = "background:#000; color:#fff; padding:12px 24px; border-radius:12px; font-size:13px; font-weight:700; margin-top:8px; animation:tIn 0.3s forwards;";
    t.innerText = msg;
    container.appendChild(t);
    setTimeout(() => t.remove(), 3000);
}

window.onscroll = () => {
    document.body.classList.toggle('scrolled', window.scrollY > 20);
};

window.onload = init;
</script>

<style>
@keyframes tIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
</style>
</body>
</html>

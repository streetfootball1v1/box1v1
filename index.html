<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover"/>
<meta name="theme-color" content="#0a0a0a">
<title>BOX1V1 | –£–õ–ò–ß–ù–´–ô –§–£–¢–ë–û–õ 1 –ù–ê 1</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root {
  --bg: #fafafa;
  --bg-elevated: rgba(255, 255, 255, 0.72);
  --glass-border: rgba(255, 255, 255, 0.5);
  --glass-highlight: rgba(255, 255, 255, 0.9);
  --text: #0a0a0a;
  --text-secondary: #374151;
  --text-tertiary: #6b7280;
  --accent: #22c55e;
  --accent-glow: rgba(34, 197, 94, 0.3);
  --border: rgba(0,0,0,0.06);
  --border-strong: rgba(0,0,0,0.12);
  --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  --nav-h: 72px;
  --radius: 28px;
  --radius-sm: 16px;
  --safe-top: env(safe-area-inset-top);
  --safe-bottom: env(safe-area-inset-bottom);
  --safe-left: env(safe-area-inset-left);
  --safe-right: env(safe-area-inset-right);
  --ease-out: cubic-bezier(0.2, 0, 0, 1);
  --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
  --ease-elastic: cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

@media (max-width: 420px) { :root { --nav-h: 64px; } }

*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

@media (prefers-reduced-motion: reduce) {
  html { scroll-behavior: auto; }
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

html { scroll-behavior: smooth; background: var(--bg); -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility; }

body { 
  font-family: var(--font-sans); 
  background: linear-gradient(135deg, #fafafa 0%, #f0f0f0 100%); 
  color: var(--text); 
  line-height: 1.6; 
  overflow-x: hidden; 
  min-height: 100vh; 
  min-height: 100dvh; 
}

h1, h2, h3 { 
  font-weight: 900; 
  font-style: italic; 
  letter-spacing: -0.03em; 
  line-height: 1.05; 
  text-transform: uppercase; 
}
@media (max-width: 360px) {
  h1, h2, h3 { letter-spacing: -0.01em; }
}

/* LIQUID GLASS UTILITIES */
.liquid-glass {
  background: linear-gradient(135deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.1) 100%);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border: 1px solid var(--glass-border);
  box-shadow: 
    0 4px 24px -1px rgba(0,0,0,0.05),
    inset 0 1px 0 0 var(--glass-highlight),
    inset 0 -1px 0 0 rgba(255,255,255,0.2);
}

.liquid-glass-strong {
  background: linear-gradient(135deg, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.4) 100%);
  backdrop-filter: blur(40px) saturate(200%);
  -webkit-backdrop-filter: blur(40px) saturate(200%);
  border: 1px solid rgba(255,255,255,0.6);
  box-shadow: 
    0 8px 32px -2px rgba(0,0,0,0.08),
    inset 0 1px 0 0 rgba(255,255,255,0.9),
    inset 0 -1px 0 0 rgba(255,255,255,0.3);
}

.skip-link { position: absolute; top: -40px; left: 0; background: var(--text); color: white; padding: 8px; text-decoration: none; z-index: 10000; transition: top 0.3s; }
.skip-link:focus { top: 0; }

/* PRELOADER */
#preloader { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.6s var(--ease-out), visibility 0.6s; }
#preloader.loaded { opacity: 0; visibility: hidden; pointer-events: none; }
.preloader-content { text-align: center; padding: 20px; }
.preloader-logo { font-size: clamp(2rem, 8vw, 3rem); font-weight: 900; font-style: italic; letter-spacing: -0.05em; margin-bottom: 1.5rem; animation: pulse 2s infinite; }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
.loading-bar { width: 160px; height: 3px; background: rgba(0,0,0,0.05); border-radius: 3px; overflow: hidden; margin: 0 auto; position: relative; }
.loading-bar::after { content: ''; position: absolute; left: -50%; width: 50%; height: 100%; background: var(--text); animation: load 1.2s infinite ease-in-out; border-radius: 3px; }
@keyframes load { 0% { left: -50%; } 100% { left: 100%; } }

/* TOASTS */
#toast-container { position: fixed; bottom: max(24px, calc(var(--safe-bottom) + 8px)); left: 50%; transform: translateX(-50%); z-index: 10001; display: flex; flex-direction: column; gap: 10px; pointer-events: none; width: calc(100% - 40px); max-width: 400px; }
.toast { 
  background: rgba(0,0,0,0.85); 
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  color: #fff; 
  padding: 16px 24px; 
  border-radius: 100px; 
  font-size: 14px; 
  font-weight: 600; 
  box-shadow: 0 20px 40px rgba(0,0,0,0.2); 
  animation: toastIn 0.4s var(--ease-spring) forwards; 
  pointer-events: auto; 
  text-align: center; 
  border: 1px solid rgba(255,255,255,0.1);
}
@keyframes toastIn { from { opacity: 0; transform: translateY(20px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }

/* LIVE REGION */
.live-region { position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden; }

/* NAVIGATION - LIQUID GLASS */
nav { 
  position: fixed; 
  top: 0; 
  left: 0; 
  width: 100%; 
  height: calc(var(--nav-h) + var(--safe-top)); 
  padding-top: var(--safe-top); 
  z-index: 1000; 
  transition: all 0.3s; 
}
nav.scrolled { 
  background: rgba(255,255,255,0.8); 
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-bottom: 1px solid rgba(0,0,0,0.05);
}
@supports not (backdrop-filter: blur(20px)) {
  nav.scrolled { background: rgba(255,255,255,0.98); }
}
.nav-inner { max-width: 1300px; margin: 0 auto; height: var(--nav-h); display: flex; align-items: center; justify-content: space-between; padding: 0 max(20px, var(--safe-left)) 0 max(20px, var(--safe-right)); }

.logo { 
  font-size: 1.5rem; 
  font-weight: 900; 
  font-style: italic; 
  letter-spacing: -0.03em; 
  cursor: pointer; 
  transition: all 0.3s; 
  text-decoration: none; 
  color: var(--text); 
  padding: 8px 16px; 
  border-radius: 12px;
  display: flex; 
  align-items: center; 
  position: relative;
  overflow: hidden;
}
.logo:hover { 
  transform: scale(1.05);
  background: rgba(0,0,0,0.03);
}
.logo-accent { 
  color: var(--accent);
  text-shadow: 0 0 20px var(--accent-glow);
}

.nav-links { display: flex; gap: 8px; }
.nav-links a { 
  display: inline-flex; 
  align-items: center; 
  justify-content: center; 
  text-decoration: none; 
  font-size: 12px; 
  font-weight: 700; 
  letter-spacing: 0.05em; 
  text-transform: uppercase; 
  color: var(--text-secondary); 
  padding: 10px 20px; 
  border-radius: 100px; 
  transition: all 0.3s var(--ease-spring); 
  min-height: 44px; 
  border: 1px solid transparent; 
  position: relative; 
  overflow: hidden; 
}
.nav-links a:hover, .nav-links a:focus { 
  color: var(--text); 
  background: rgba(0,0,0,0.03); 
  transform: translateY(-2px); 
}
.nav-links a:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
.nav-links a.active { 
  background: var(--text); 
  color: #fff; 
  border-color: var(--text);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* BURGER */
.burger { 
  display: none; 
  cursor: pointer; 
  width: 48px; 
  height: 48px; 
  flex-direction: column; 
  justify-content: center; 
  align-items: center; 
  gap: 5px; 
  border-radius: 14px; 
  background: rgba(0,0,0,0.03); 
  border: none; 
  transition: all 0.3s var(--ease-spring); 
  position: relative; 
}
.burger:hover { 
  background: rgba(0,0,0,0.06); 
  transform: scale(1.05); 
}
.burger:active { transform: scale(0.95); }
.burger span { width: 22px; height: 2.5px; background: var(--text); border-radius: 2px; transition: all 0.3s var(--ease-spring); transform-origin: center; }
.burger.open span:nth-child(1) { transform: translateY(7.5px) rotate(45deg); }
.burger.open span:nth-child(2) { opacity: 0; transform: scaleX(0); }
.burger.open span:nth-child(3) { transform: translateY(-7.5px) rotate(-45deg); }

/* MOBILE DRAWER - LIQUID GLASS REDESIGN */
.drawer-overlay { 
  position: fixed; 
  inset: 0; 
  background: rgba(0,0,0,0.2); 
  backdrop-filter: blur(8px); 
  -webkit-backdrop-filter: blur(8px);
  z-index: 1999; 
  opacity: 0; 
  visibility: hidden; 
  transition: all 0.4s var(--ease-out); 
}
.drawer-overlay.open { opacity: 1; visibility: visible; }

.mobile-drawer { 
  position: fixed; 
  top: 0; 
  right: -100%; 
  width: min(85%, 360px); 
  height: 100%; 
  height: 100dvh; 
  background: linear-gradient(180deg, rgba(255,255,255,0.95) 0%, rgba(250,250,250,0.98) 100%);
  backdrop-filter: blur(40px) saturate(220%);
  -webkit-backdrop-filter: blur(40px) saturate(220%);
  z-index: 2000; 
  padding: calc(var(--safe-top) + 24px) 28px calc(var(--safe-bottom) + 24px);
  display: flex; 
  flex-direction: column; 
  gap: 8px; 
  transition: right 0.5s var(--ease-spring); 
  box-shadow: -10px 0 40px rgba(0,0,0,0.1), inset 1px 0 0 rgba(255,255,255,0.5);
  overflow-y: auto; 
  overscroll-behavior: contain;
  border-left: 1px solid rgba(255,255,255,0.6);
}
.mobile-drawer::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 200px;
  background: linear-gradient(180deg, rgba(34,197,94,0.08) 0%, transparent 100%);
  pointer-events: none;
}
.mobile-drawer-header { 
  margin-bottom: 40px; 
  padding-bottom: 24px; 
  border-bottom: 1px solid rgba(0,0,0,0.06);
  position: relative;
}
.mobile-drawer .logo { 
  font-size: 2rem; 
  justify-content: center;
  padding: 16px;
  background: rgba(0,0,0,0.02);
  border-radius: 20px;
  margin-bottom: 8px;
}
.mobile-drawer .logo-accent { 
  color: var(--accent);
  filter: drop-shadow(0 0 10px var(--accent-glow));
}
.drawer-subtitle {
  text-align: center;
  font-size: 11px;
  font-weight: 600;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.2em;
  margin-top: 8px;
}
.mobile-drawer.open { right: 0; }
.mobile-drawer a { 
  font-size: 1.5rem; 
  font-weight: 800; 
  text-decoration: none; 
  color: var(--text); 
  font-style: italic; 
  text-transform: uppercase; 
  letter-spacing: -0.02em; 
  padding: 20px 24px; 
  border-radius: 16px;
  transition: all 0.3s var(--ease-spring); 
  opacity: 0; 
  transform: translateX(30px);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: rgba(0,0,0,0.02);
  border: 1px solid transparent;
  margin-bottom: 8px;
}
.mobile-drawer a::after {
  content: '‚Üí';
  font-size: 1.2rem;
  opacity: 0;
  transform: translateX(-10px);
  transition: all 0.3s;
}
.mobile-drawer.open a { opacity: 1; transform: translateX(0); }
.mobile-drawer.open a:nth-child(2) { transition-delay: 0.1s; }
.mobile-drawer.open a:nth-child(3) { transition-delay: 0.15s; }
.mobile-drawer.open a:nth-child(4) { transition-delay: 0.2s; }
.mobile-drawer a:hover, .mobile-drawer a:focus { 
  background: rgba(34,197,94,0.1);
  border-color: rgba(34,197,94,0.2);
  color: var(--accent-dark);
  transform: translateX(8px);
  box-shadow: 0 4px 12px rgba(34,197,94,0.1);
}
.mobile-drawer a:hover::after {
  opacity: 1;
  transform: translateX(0);
}
.mobile-drawer a:focus-visible { 
  outline: 2px solid var(--accent); 
  outline-offset: 2px; 
}
.mobile-drawer .btn-group { 
  margin-top: auto; 
  padding-top: 32px; 
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.drawer-footer {
  margin-top: 24px;
  padding-top: 24px;
  border-top: 1px solid rgba(0,0,0,0.06);
  text-align: center;
  font-size: 12px;
  color: var(--text-tertiary);
  font-weight: 500;
}
.drawer-socials {
  display: flex;
  justify-content: center;
  gap: 16px;
  margin-top: 16px;
}
.drawer-social-btn {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  background: rgba(0,0,0,0.03);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  transition: all 0.3s;
  cursor: pointer;
  border: 1px solid transparent;
}
.drawer-social-btn:hover {
  background: var(--accent);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px var(--accent-glow);
}

/* MAIN */
.main-content { max-width: 1300px; margin: 0 auto; padding: calc(var(--nav-h) + var(--safe-top) + 20px) max(20px, var(--safe-left)) calc(100px + var(--safe-bottom)) max(20px, var(--safe-right)); min-height: 100vh; min-height: 100dvh; }

section { display: none; opacity: 0; animation: fadeIn 0.6s var(--ease-out) forwards; }
section.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

/* INTRO */
.intro-block { padding: 60px 0 100px; text-align: center; max-width: 900px; margin: 0 auto; }
.intro-block span { 
  display: block; 
  font-size: 12px; 
  font-weight: 800; 
  text-transform: uppercase; 
  letter-spacing: 0.2em; 
  color: var(--accent); 
  margin-bottom: 24px; 
  opacity: 0; 
  animation: fadeInUp 0.6s 0.2s forwards;
  text-shadow: 0 0 20px rgba(34,197,94,0.2);
}
.intro-block h1 { 
  font-size: clamp(3rem, 12vw, 9rem); 
  margin-bottom: 24px; 
  opacity: 0; 
  animation: fadeInUp 0.6s 0.3s forwards; 
  line-height: 0.95;
  background: linear-gradient(135deg, #000 0%, #333 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  filter: drop-shadow(0 10px 30px rgba(0,0,0,0.1));
}
.intro-block p { font-size: clamp(1.125rem, 2.5vw, 1.5rem); color: var(--text-secondary); max-width: 500px; margin: 0 auto 40px; opacity: 0; animation: fadeInUp 0.6s 0.4s forwards; }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

.btn-group { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; opacity: 0; animation: fadeInUp 0.6s 0.5s forwards; }

/* BUTTONS with Glass effect */
.btn { 
  padding: 18px 32px; 
  border-radius: 100px; 
  font-weight: 700; 
  text-transform: uppercase; 
  font-size: 13px; 
  letter-spacing: 0.03em; 
  cursor: pointer; 
  transition: all 0.3s var(--ease-spring); 
  border: none; 
  text-decoration: none; 
  display: inline-flex; 
  align-items: center; 
  justify-content: center; 
  gap: 10px; 
  position: relative; 
  overflow: hidden; 
  min-height: 56px; 
  min-width: 140px; 
  user-select: none; 
  -webkit-touch-callout: none; 
}
.btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, transparent 100%);
  opacity: 0;
  transition: opacity 0.3s;
}
.btn:hover::before {
  opacity: 1;
}
.btn-primary { 
  background: var(--text); 
  color: #fff; 
  box-shadow: 0 4px 20px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.2);
}
.btn-primary:hover, .btn-primary:focus { 
  transform: translateY(-3px) scale(1.02); 
  box-shadow: 0 12px 30px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.2); 
}
.btn-outline { 
  background: rgba(255,255,255,0.5); 
  backdrop-filter: blur(10px);
  border: 1.5px solid var(--border-strong); 
  color: var(--text); 
}
.btn-outline:hover, .btn-outline:focus { 
  background: rgba(255,255,255,0.9); 
  border-color: var(--text); 
  transform: translateY(-3px); 
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
}
.btn:focus-visible { outline: 2px solid var(--accent); outline-offset: 3px; }

@media (hover: none) and (pointer: coarse) {
  .btn:hover { transform: none !important; box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important; }
  .btn:active { transform: scale(0.96) !important; }
}

/* TIMER - Glassmorphism */
.timer-context { 
  margin-top: 60px; 
  padding: 24px 40px; 
  background: linear-gradient(135deg, rgba(255,255,255,0.6) 0%, rgba(255,255,255,0.3) 100%); 
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-radius: 32px; 
  display: inline-flex; 
  align-items: center; 
  gap: 32px; 
  border: 1px solid rgba(255,255,255,0.6);
  box-shadow: 
    0 8px 32px rgba(0,0,0,0.05),
    inset 0 1px 0 rgba(255,255,255,0.8);
  opacity: 0; 
  animation: fadeInUp 0.6s 0.6s forwards; 
  flex-wrap: wrap; 
  justify-content: center; 
}
.timer-label { 
  font-size: 12px; 
  font-weight: 800; 
  color: var(--text-secondary); 
  text-transform: uppercase; 
  letter-spacing: 0.15em; 
}
.countdown { display: flex; gap: 24px; }
.countdown > div { 
  text-align: center; 
  min-width: 60px;
  position: relative;
}
.countdown > div:not(:last-child)::after {
  content: ':';
  position: absolute;
  right: -16px;
  top: 50%;
  transform: translateY(-70%);
  font-size: 1.5rem;
  font-weight: 300;
  color: var(--text-tertiary);
  opacity: 0.5;
}
.countdown-value { 
  font-size: clamp(2rem, 5vw, 2.5rem); 
  font-weight: 900; 
  letter-spacing: -0.02em; 
  line-height: 1; 
  font-variant-numeric: tabular-nums; 
  font-feature-settings: "tnum";
  background: linear-gradient(135deg, #000 0%, #444 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.countdown-label { 
  font-size: 10px; 
  font-weight: 800; 
  color: var(--text-tertiary); 
  text-transform: uppercase; 
  letter-spacing: 0.15em; 
  margin-top: 6px; 
}

/* BENTO GRID */
.bento-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-top: 40px; }
.card { 
  background: var(--bg-elevated); 
  border-radius: var(--radius); 
  border: 1px solid var(--border); 
  padding: 32px; 
  position: relative; 
  overflow: hidden; 
  transition: all 0.4s var(--ease-out); 
  cursor: pointer; 
  display: flex; 
  flex-direction: column; 
  gap: 16px;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
}
@media (hover: hover) { 
  .card:hover { 
    transform: translateY(-6px) scale(1.02); 
    border-color: rgba(34,197,94,0.3);
    box-shadow: 0 20px 40px -12px rgba(0,0,0,0.15), 0 0 0 1px rgba(34,197,94,0.1); 
  } 
}
.card:active { transform: scale(0.98); }
.card:focus-visible { outline: 2px solid var(--accent); outline-offset: 4px; }
.card h2 { font-size: clamp(1.75rem, 3vw, 2.5rem); line-height: 1; }
.card h3 { font-size: 1.5rem; line-height: 1.2; }
.card p { color: var(--text-secondary); font-size: 0.95rem; line-height: 1.5; }

/* PLAYER CARDS - Fixed OVR visibility */
.player-card { 
  min-height: 420px; 
  background: linear-gradient(180deg, #1a1a1a 0%, #000 100%);
  color: #fff; 
  border: none; 
  padding: 28px; 
  isolation: isolate; 
  position: relative;
  border-radius: var(--radius);
  overflow: hidden;
}
.player-img { 
  position: absolute; 
  inset: 0; 
  background-size: cover; 
  background-position: center top; 
  filter: grayscale(1) brightness(0.7);
  opacity: 0.6; 
  transition: all 0.8s var(--ease-out); 
  z-index: 0; 
}
@media (hover: hover) { 
  .player-card:hover .player-img { 
    filter: grayscale(0) brightness(0.8); 
    opacity: 0.7; 
    transform: scale(1.05); 
  } 
}
.player-card::after { 
  content: ''; 
  position: absolute; 
  inset: 0; 
  background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.4) 50%, transparent 100%); 
  z-index: 1; 
}
.player-info { 
  position: relative; 
  z-index: 2; 
  margin-top: auto; 
  display: flex; 
  flex-direction: column; 
  gap: 8px; 
}
.player-info span { 
  font-size: 11px; 
  font-weight: 800; 
  text-transform: uppercase; 
  color: var(--accent); 
  letter-spacing: 0.15em; 
  text-shadow: 0 0 10px rgba(34,197,94,0.3);
}
.player-info h3 { 
  font-size: clamp(1.5rem, 3vw, 2rem); 
  overflow-wrap: anywhere;
  line-height: 1.1;
  margin-bottom: 4px;
}
.player-badges { 
  font-size: 11px; 
  color: rgba(255,255,255,0.6); 
  margin-top: 4px; 
  font-weight: 500;
}
.ovr-badge { 
  display: inline-flex; 
  align-items: center; 
  justify-content: center;
  padding: 8px 16px; 
  background: var(--accent); 
  color: #fff; 
  border-radius: 100px; 
  font-weight: 900; 
  font-size: 13px; 
  margin-top: 12px; 
  width: fit-content; 
  box-shadow: 0 4px 20px rgba(34,197,94,0.4), inset 0 1px 0 rgba(255,255,255,0.2);
  border: 1px solid rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
  position: relative;
  z-index: 3;
}

/* TABLE */
.table-wrapper { 
  background: var(--bg-elevated); 
  border-radius: var(--radius); 
  border: 1px solid var(--border); 
  overflow: hidden; 
  overflow-x: auto; 
  -webkit-overflow-scrolling: touch; 
  position: relative;
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 20px rgba(0,0,0,0.03);
}
table { width: 100%; border-collapse: collapse; min-width: 400px; }
th { 
  text-align: left; 
  padding: 24px; 
  font-size: 11px; 
  font-weight: 800; 
  text-transform: uppercase; 
  color: var(--text-tertiary); 
  letter-spacing: 0.1em; 
  border-bottom: 1px solid var(--border); 
  white-space: nowrap; 
}
td { padding: 20px 24px; border-bottom: 1px solid var(--border); transition: background 0.2s; vertical-align: middle; }
tr:last-child td { border-bottom: none; }
tbody tr { cursor: pointer; transition: all 0.2s; }
tbody tr:hover, tbody tr:focus-within { background: rgba(34,197,94,0.05); }
tbody tr:focus-visible { outline: 2px solid var(--accent); outline-offset: -2px; }

.player-row { display: flex; align-items: center; gap: 16px; }
.player-avatar-sm { 
  width: 48px; 
  height: 48px; 
  border-radius: 14px; 
  object-fit: cover; 
  background: var(--bg); 
  flex-shrink: 0;
  border: 2px solid rgba(255,255,255,0.5);
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.player-info-sm { display: flex; flex-direction: column; gap: 4px; min-width: 0; }
.player-name-sm { 
  font-weight: 800; 
  text-transform: uppercase; 
  font-style: italic; 
  letter-spacing: -0.02em; 
  white-space: nowrap; 
  overflow: hidden; 
  text-overflow: ellipsis; 
}
.player-role-sm { font-size: 11px; font-weight: 700; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.05em; }

/* MODAL - Liquid Glass */
.modal-overlay { 
  position: fixed; 
  inset: 0; 
  background: rgba(255,255,255,0.7); 
  backdrop-filter: blur(30px) saturate(180%); 
  -webkit-backdrop-filter: blur(30px) saturate(180%); 
  z-index: 3000; 
  display: flex; 
  justify-content: center; 
  align-items: center; 
  padding: 20px; 
  opacity: 0; 
  visibility: hidden; 
  transition: all 0.4s var(--ease-out); 
  overflow-y: auto; 
}
.modal-overlay.active { opacity: 1; visibility: visible; }
@supports not (backdrop-filter: blur(30px)) {
  .modal-overlay { background: rgba(255,255,255,0.98); }
}

.modal-content { 
  background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.8) 100%); 
  backdrop-filter: blur(40px) saturate(200%);
  -webkit-backdrop-filter: blur(40px) saturate(200%);
  width: 100%; 
  max-width: 520px; 
  border-radius: 32px; 
  padding: 40px; 
  position: relative; 
  max-height: min(90vh, 800px); 
  max-height: min(90dvh, 800px); 
  overflow-y: auto; 
  box-shadow: 
    0 40px 80px -20px rgba(0,0,0,0.15),
    0 0 0 1px rgba(255,255,255,0.5) inset,
    0 0 100px rgba(34,197,94,0.05) inset;
  transform: translateY(40px) scale(0.95); 
  transition: transform 0.5s var(--ease-spring); 
  border: 1px solid rgba(255,255,255,0.6);
}
@media (max-height: 700px) {
  .modal-content { max-height: 95vh; max-height: 95dvh; padding: 24px; }
}

.modal-header-fixed { 
  position: sticky; 
  top: -40px;
  right: 0; 
  left: 0;
  display: flex; 
  justify-content: space-between; 
  pointer-events: none; 
  z-index: 10;
  margin: -40px -40px 20px -40px;
  padding: 16px 20px;
  background: linear-gradient(to bottom, rgba(255,255,255,0.9), transparent);
  backdrop-filter: blur(10px);
  border-radius: 32px 32px 0 0;
}
.modal-header-fixed > button { pointer-events: auto; }

.modal-close, .download-circle { 
  width: 44px; 
  height: 44px; 
  border-radius: 50%; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  cursor: pointer; 
  border: none; 
  transition: all 0.3s var(--ease-spring); 
  background: rgba(0,0,0,0.05); 
  color: var(--text-secondary);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(0,0,0,0.05);
}
.modal-close { order: 2; }
.download-circle { order: 1; margin-right: auto; margin-left: 0; }
.modal-close:hover, .modal-close:focus { 
  background: rgba(0,0,0,0.1); 
  color: var(--text); 
  transform: rotate(90deg) scale(1.1); 
}
.download-circle:hover, .download-circle:focus { 
  background: var(--accent); 
  color: #fff; 
  transform: scale(1.1); 
  box-shadow: 0 4px 12px var(--accent-glow);
}
.modal-close:focus-visible, .download-circle:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; transform: none; }

.modal-overlay.active .modal-content { transform: translateY(0) scale(1); }

#m-img-container { 
  width: 100%; 
  aspect-ratio: 1 / 1; 
  max-height: 320px; 
  border-radius: 24px; 
  overflow: hidden; 
  background: linear-gradient(90deg, #f0f0f0 25%, #e8e8e8 50%, #f0f0f0 75%); 
  background-size: 200% 100%; 
  animation: shimmer 1.5s infinite; 
  margin-bottom: 32px;
  margin-top: 20px;
  position: relative;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  border: 1px solid rgba(255,255,255,0.5);
}
@keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
#m-img { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.4s; }
#m-img.loaded { opacity: 1; animation: none; }

.modal-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 16px; margin-bottom: 32px; }
.modal-title-group { flex: 1; min-width: 0; }
#m-role { 
  display: inline-block; 
  font-size: 11px; 
  font-weight: 800; 
  text-transform: uppercase; 
  color: var(--accent); 
  background: rgba(34,197,94,0.1); 
  padding: 8px 14px; 
  border-radius: 20px; 
  margin-bottom: 12px; 
  letter-spacing: 0.1em;
  border: 1px solid rgba(34,197,94,0.2);
}
#m-name { 
  font-size: clamp(1.75rem, 5vw, 2.5rem); 
  line-height: 1.1; 
  overflow-wrap: anywhere; 
}
#m-badges { display: flex; gap: 8px; margin-top: 16px; flex-wrap: wrap; }
.badge { 
  font-size: 10px; 
  font-weight: 800; 
  background: var(--text); 
  color: #fff; 
  padding: 6px 12px; 
  border-radius: 20px; 
  text-transform: uppercase; 
  letter-spacing: 0.05em; 
}
#m-ovr { 
  font-size: clamp(2.5rem, 6vw, 3.5rem); 
  font-weight: 900; 
  font-style: italic; 
  line-height: 1; 
  letter-spacing: -0.05em; 
  color: var(--text); 
  flex-shrink: 0;
  background: linear-gradient(135deg, var(--accent) 0%, #16a34a 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  filter: drop-shadow(0 0 10px var(--accent-glow));
}

#m-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; margin-bottom: 32px; }
.stat-item { position: relative; }
.stat-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; gap: 8px; }
.stat-label-group { display: flex; align-items: center; gap: 8px; cursor: help; position: relative; padding: 4px 0; }
.stat-label { 
  font-size: 13px; 
  font-weight: 800; 
  color: var(--text-secondary); 
  text-transform: uppercase; 
  letter-spacing: 0.05em; 
}
.stat-value { font-size: 13px; font-weight: 900; color: var(--text); }
.info-icon { 
  width: 18px; 
  height: 18px; 
  border-radius: 50%; 
  border: 1.5px solid var(--border-strong); 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  font-size: 10px; 
  color: var(--text-tertiary); 
  font-style: normal; 
  font-weight: 800; 
  flex-shrink: 0; 
  transition: all 0.2s; 
  background: rgba(255,255,255,0.5);
}
.stat-label-group:hover .info-icon, .stat-label-group:focus .info-icon { 
  background: var(--text); 
  color: #fff; 
  border-color: var(--text); 
}
.stat-label-group:focus-visible { outline: none; }
.stat-label-group:focus-visible .info-icon { outline: 2px solid var(--accent); outline-offset: 2px; }

.stat-label-group[data-tooltip]::before { 
  content: attr(data-tooltip); 
  position: absolute; 
  bottom: calc(100% + 10px); 
  left: 50%; 
  transform: translateX(-50%) translateY(8px); 
  background: rgba(0,0,0,0.9); 
  color: #fff; 
  padding: 10px 16px; 
  border-radius: 12px; 
  font-size: 12px; 
  font-weight: 500; 
  line-height: 1.4; 
  opacity: 0; 
  visibility: hidden; 
  transition: all 0.3s var(--ease-out); 
  z-index: 100; 
  pointer-events: none; 
  white-space: nowrap; 
  max-width: 260px; 
  text-align: center; 
  box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
}
.stat-label-group[data-tooltip]::after { 
  content: ''; 
  position: absolute; 
  bottom: calc(100% + 4px); 
  left: 50%; 
  transform: translateX(-50%) translateY(8px); 
  border: 6px solid transparent; 
  border-top-color: rgba(0,0,0,0.9); 
  opacity: 0; 
  visibility: hidden; 
  transition: all 0.3s var(--ease-out); 
}
.stat-label-group:hover[data-tooltip]::before, .stat-label-group:hover[data-tooltip]::after, 
.stat-label-group:focus[data-tooltip]::before, .stat-label-group:focus[data-tooltip]::after { 
  opacity: 1; 
  visibility: visible; 
  transform: translateX(-50%) translateY(0); 
}

@media (max-width: 768px) {
  .stat-label-group[data-tooltip]::before { 
    position: fixed; 
    left: 50% !important; 
    top: auto !important; 
    bottom: 150px !important; 
    transform: translateX(-50%) !important; 
    max-width: calc(100vw - 40px); 
    white-space: normal; 
    z-index: 10000; 
  }
  .stat-label-group[data-tooltip]::after { display: none; }
  .modal-header-fixed {
    top: -24px;
    margin: -24px -24px 20px -24px;
    padding: 12px 16px;
  }
}

.stat-bar-bg { 
  height: 8px; 
  background: rgba(0,0,0,0.05); 
  border-radius: 4px; 
  overflow: hidden; 
  position: relative;
  box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
}
.stat-bar-fill { 
  height: 100%; 
  background: linear-gradient(90deg, var(--text) 0%, #444 100%); 
  border-radius: 4px; 
  width: 0%; 
  transition: width 1.2s var(--ease-out) 0.3s; 
  position: relative; 
  overflow: hidden;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
.stat-bar-fill.accent {
  background: linear-gradient(90deg, var(--accent) 0%, #16a34a 100%);
  box-shadow: 0 0 10px var(--accent-glow);
}
.stat-bar-fill::after { 
  content: ''; 
  position: absolute; 
  inset: 0; 
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); 
  animation: shimmer-bar 2s infinite; 
}
@keyframes shimmer-bar { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }

/* CONTROLS */
.controls-row { 
  margin-bottom: 40px; 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  flex-wrap: wrap; 
  gap: 20px; 
  background: rgba(255,255,255,0.5);
  backdrop-filter: blur(10px);
  padding: 16px;
  border-radius: 20px;
  border: 1px solid var(--border);
}
.search-input { 
  padding: 16px 24px; 
  border-radius: 100px; 
  border: 1.5px solid var(--border); 
  background: rgba(255,255,255,0.8); 
  width: 100%; 
  max-width: 360px; 
  font-family: inherit; 
  font-size: 15px; 
  font-weight: 500; 
  transition: all 0.3s; 
  color: var(--text);
  backdrop-filter: blur(10px);
}
.search-input:hover { border-color: var(--border-strong); }
.search-input:focus { 
  outline: none; 
  border-color: var(--accent); 
  background: #fff; 
  box-shadow: 0 0 0 4px var(--accent-glow), 0 4px 12px rgba(0,0,0,0.08); 
}
.search-input::placeholder { color: var(--text-tertiary); }
.filter-bar { display: flex; gap: 8px; flex-wrap: wrap; position: relative; }
.filter-btn { 
  padding: 12px 20px; 
  border-radius: 100px; 
  border: 1px solid var(--border); 
  background: rgba(255,255,255,0.6); 
  font-size: 12px; 
  font-weight: 700; 
  cursor: pointer; 
  text-transform: uppercase; 
  letter-spacing: 0.03em; 
  white-space: nowrap; 
  transition: all 0.3s; 
  color: var(--text-secondary); 
  min-height: 44px;
  backdrop-filter: blur(10px);
}
.filter-btn:hover { 
  border-color: var(--border-strong); 
  color: var(--text); 
  transform: translateY(-2px);
  background: rgba(255,255,255,0.9);
}
.filter-btn.active { 
  background: var(--text); 
  color: #fff; 
  border-color: var(--text); 
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
.filter-btn:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }

/* Scroll hint */
@media (max-width: 640px) {
  .filter-bar { 
    overflow-x: auto; 
    padding-bottom: 8px; 
    flex-wrap: nowrap; 
    -webkit-overflow-scrolling: touch; 
    scrollbar-width: none; 
    -ms-overflow-style: none; 
    mask-image: linear-gradient(to right, black 85%, transparent 100%); 
    -webkit-mask-image: linear-gradient(to right, black 85%, transparent 100%); 
  }
  .filter-bar::-webkit-scrollbar { display: none; }
  .controls-row {
    padding: 12px;
  }
}

/* SCROLLBAR */
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border-strong); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: var(--text-tertiary); }

/* MOBILE */
@media (max-width: 1024px) { .bento-grid { grid-template-columns: repeat(2, 1fr); } }

@media (max-width: 768px) {
  .nav-links { display: none; }
  .burger { display: flex; }
  .main-content { padding-left: max(16px, var(--safe-left)); padding-right: max(16px, var(--safe-right)); }
  .intro-block { padding: 40px 0 60px; }
  .timer-context { 
    border-radius: 24px; 
    flex-direction: column; 
    gap: 20px; 
    width: 100%; 
    padding: 24px; 
  }
  .countdown { gap: 16px; width: 100%; justify-content: center; }
  .countdown > div { min-width: 50px; }
  .countdown > div:not(:last-child)::after { right: -12px; font-size: 1.2rem; }
  .countdown-value { font-size: 1.75rem; }
  .btn { padding: 16px 24px; min-height: 52px; width: 100%; max-width: 300px; }
  .btn-group { flex-direction: column; align-items: center; }
  .bento-grid { grid-template-columns: 1fr; gap: 16px; }
  .card { padding: 24px; border-radius: 20px; }
  .card.span-2 { grid-column: 1 / -1; }
  .player-card { min-height: 380px; }
  .ovr-badge {
    font-size: 12px;
    padding: 6px 12px;
  }
  .controls-row { flex-direction: column; align-items: stretch; }
  .search-input { max-width: 100%; }
  
  .modal-content { 
    padding: 20px; 
    border-radius: 24px; 
    margin: 10px; 
    width: calc(100% - 20px); 
    max-height: 95vh; 
    max-height: 95dvh;
  }
  .modal-header-fixed {
    top: -20px;
    margin: -20px -20px 16px -20px;
    padding: 10px 12px;
  }
  .modal-close, .download-circle { width: 40px; height: 40px; }
  .modal-close svg, .download-circle svg { width: 18px; height: 18px; }
  #m-img-container { aspect-ratio: 4 / 3; margin-top: 40px; border-radius: 16px; }
  #m-stats { grid-template-columns: 1fr; gap: 20px; }
  th, td { padding: 16px 12px; }
  .player-avatar-sm { width: 40px; height: 40px; }
}

@media (max-width: 360px) {
  .intro-block h1 { font-size: 2.5rem; }
  .countdown-value { font-size: 1.5rem; }
  .card h2 { font-size: 1.5rem; }
  .modal-close, .download-circle { width: 36px; height: 36px; }
  .mobile-drawer { width: 90%; padding: calc(var(--safe-top) + 20px) 20px calc(var(--safe-bottom) + 20px); }
  .mobile-drawer a { font-size: 1.25rem; padding: 16px 20px; }
}

/* –°–∫—Ä—ã—Ç—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ */
#screenshot-container { position: fixed; top: -9999px; left: -9999px; width: 520px; z-index: -1; pointer-events: none; opacity: 0; }
#screenshot-container .modal-content { 
  position: static; 
  max-height: none; 
  overflow: visible; 
  transform: none; 
  margin: 0; 
  box-shadow: none; 
  border: 1px solid #eee;
  background: white;
}
#screenshot-container .modal-header-fixed { display: none; }
#screenshot-container #m-img-container { margin-top: 0; }
#screenshot-container .stat-bar-fill { width: var(--width, 0%) !important; }
</style>
</head>
<body>
<a href="#main" class="skip-link">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É</a>

<div id="preloader" role="status" aria-label="–ó–∞–≥—Ä—É–∑–∫–∞">
  <div class="preloader-content">
    <div class="preloader-logo">BOX<span class="logo-accent">1</span>V1</div>
    <div class="loading-bar" aria-hidden="true"></div>
  </div>
</div>

<div id="toast-container" role="region" aria-live="polite" aria-atomic="true"></div>
<div id="search-live-region" class="live-region" role="status" aria-live="polite" aria-atomic="true"></div>

<nav id="navbar" role="navigation" aria-label="–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é">
  <div class="nav-inner">
    <a href="#home" class="logo" onclick="switchTab('home'); return false;" aria-label="BOX1V1 - –ù–∞ –≥–ª–∞–≤–Ω—É—é">
      BOX<span class="logo-accent">1</span>V1
    </a>
    <div class="nav-links">
      <a href="#home" onclick="switchTab('home'); return false;" id="btn-home" class="active" aria-current="page">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="#roster" onclick="switchTab('roster'); return false;" id="btn-roster">–£—á–∞—Å—Ç–Ω–∏–∫–∏</a>
      <a href="#stats" onclick="switchTab('stats'); return false;" id="btn-stats">–†–µ–π—Ç–∏–Ω–≥</a>
    </div>
    <button class="burger" id="burger" onclick="toggleMenu()" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é" aria-expanded="false" aria-controls="mobile-drawer">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </button>
  </div>
</nav>

<div class="drawer-overlay" id="drawer-overlay" onclick="toggleMenu()" aria-hidden="true"></div>
<nav class="mobile-drawer" id="mobile-drawer" role="dialog" aria-label="–ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é" aria-modal="true">
  <div class="mobile-drawer-header">
    <a href="#home" class="logo" onclick="handleMobileNav('home'); return false;">
      BOX<span class="logo-accent">1</span>V1
    </a>
    <div class="drawer-subtitle">–£–ª–∏—á–Ω—ã–π —Ñ—É—Ç–±–æ–ª 1 –Ω–∞ 1</div>
  </div>
  
  <a href="#home" onclick="handleMobileNav('home'); return false;">
    <span>–ì–ª–∞–≤–Ω–∞—è</span>
  </a>
  <a href="#roster" onclick="handleMobileNav('roster'); return false;">
    <span>–£—á–∞—Å—Ç–Ω–∏–∫–∏</span>
  </a>
  <a href="#stats" onclick="handleMobileNav('stats'); return false;">
    <span>–†–µ–π—Ç–∏–Ω–≥</span>
  </a>
  
  <div class="btn-group">
    <button class="btn btn-primary" onclick="handleMobileNav('applyModal', true)" style="width:100%">
      –°—Ç–∞—Ç—å —á–∞—Å—Ç—å—é
    </button>
    <button class="btn btn-outline" onclick="openTelegram()" style="width:100%">
      Telegram
    </button>
  </div>
  
  <div class="drawer-footer">
    <div>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ —Å–æ–æ–±—â–µ—Å—Ç–≤—É</div>
    <div class="drawer-socials">
      <button class="drawer-social-btn" onclick="window.open('https://instagram.com/box.1v1', '_blank')" aria-label="Instagram">
        üì∑
      </button>
      <button class="drawer-social-btn" onclick="openTelegram()" aria-label="Telegram">
        ‚úàÔ∏è
      </button>
    </div>
  </div>
</nav>

<main id="main" class="main-content">
  <section id="home" class="active" aria-label="–ì–ª–∞–≤–Ω–∞—è">
    <div class="intro-block">
      <span>The Next Gen Football</span>
      <h1>BOX1V1.</h1>
      <p>–†–µ—à–∞–µ—Ç –Ω–µ –∫–æ–º–∞–Ω–¥–∞.<br>–†–µ—à–∞–µ—à—å —Ç—ã.</p>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="switchTab('roster')">–£—á–∞—Å—Ç–Ω–∏–∫–∏</button>
        <button class="btn btn-outline" onclick="openApplyModal()">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
      </div>
      <div class="timer-context" id="timer-container">
        <span class="timer-label" id="timer-status">–î–æ —Å—Ç–∞—Ä—Ç–∞ —Å–µ–∑–æ–Ω–∞:</span>
        <div class="countdown" id="timer">
          <div><div class="countdown-value" id="days">00</div><div class="countdown-label">–¥–Ω</div></div>
          <div><div class="countdown-value" id="hours">00</div><div class="countdown-label">—á—Å</div></div>
          <div><div class="countdown-value" id="mins">00</div><div class="countdown-label">–º–∏–Ω</div></div>
          <div><div class="countdown-value" id="secs">00</div><div class="countdown-label">—Å–µ–∫</div></div>
        </div>
      </div>
    </div>
    <div class="bento-grid">
      <div class="card span-2" onclick="openModal('rulesModal')" tabindex="0" role="button" aria-label="–û—Ç–∫—Ä—ã—Ç—å —Ä–µ–≥–ª–∞–º–µ–Ω—Ç">
        <span style="font-size:11px; font-weight:800; color:var(--accent); text-transform:uppercase; letter-spacing:0.1em;">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</span>
        <h2>–†–ï–ì–õ–ê–ú–ï–ù–¢.</h2>
        <p>–°–≤–æ–¥ –ø—Ä–∞–≤–∏–ª –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –º–∞—Ç—á–µ–π.</p>
        <div style="margin-top:auto; padding-top:30px; font-weight:800; font-size:12px; text-transform:uppercase; color:var(--text-secondary);">–ò–∑—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ ‚Üí</div>
      </div>
      <div class="card" onclick="window.open('https://t.me/streetbox1v1', '_blank')" tabindex="0" role="link" aria-label="–û—Ç–∫—Ä—ã—Ç—å Telegram">
        <h3>TELEGRAM</h3>
        <p>–°–≤–µ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.</p>
      </div>
      <div class="card" onclick="window.open('https://instagram.com/box.1v1', '_blank')" tabindex="0" role="link" aria-label="–û—Ç–∫—Ä—ã—Ç—å Instagram">
        <h3>INSTAGRAM</h3>
        <p>–ì–ª–∞–≤–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –≤ –º–µ–¥–∏–∞ —Ñ–æ—Ä–º–∞—Ç–µ.</p>
      </div>
    </div>
  </section>

  <section id="roster" aria-label="–£—á–∞—Å—Ç–Ω–∏–∫–∏">
    <div style="margin-bottom: 40px;">
      <h1 style="font-size: clamp(3rem, 10vw, 8rem); line-height:0.95;">–£–ß–ê–°–¢–ù–ò–ö–ò.</h1>
      <p style="font-size: 1.25rem; margin-top:16px; color: var(--text-secondary);">–î–µ–π—Å—Ç–≤—É—é—â–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ BOX1V1.</p>
    </div>
    <div class="controls-row">
      <input type="search" class="search-input" id="playerSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏..." oninput="debouncedRender()" aria-label="–ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–∞" autocomplete="off">
      <div class="filter-bar" role="group" aria-label="–§–∏–ª—å—Ç—Ä –ø–æ —Ä–æ–ª–∏">
        <button class="filter-btn active" onclick="setRoleFilter('–í—Å–µ', this)" aria-pressed="true">–í—Å–µ</button>
        <button class="filter-btn" onclick="setRoleFilter('–ò–≥—Ä–æ–∫', this)" aria-pressed="false">–ü–æ–ª–µ–≤—ã–µ</button>
        <button class="filter-btn" onclick="setRoleFilter('–í—Ä–∞—Ç–∞—Ä—å', this)" aria-pressed="false">–í—Ä–∞—Ç–∞—Ä–∏</button>
      </div>
    </div>
    <div class="bento-grid" id="roster-grid" role="region" aria-live="polite" aria-label="–°–µ—Ç–∫–∞ –∏–≥—Ä–æ–∫–æ–≤"></div>
  </section>

  <section id="stats" aria-label="–†–µ–π—Ç–∏–Ω–≥">
    <h1 style="font-size: clamp(3rem, 10vw, 8rem); margin-bottom:40px; line-height:0.95;">–†–ï–ô–¢–ò–ù–ì.</h1>
    <div class="table-wrapper" role="region" aria-label="–¢–∞–±–ª–∏—Ü–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞" tabindex="0">
      <table role="table" aria-label="–†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤">
        <thead>
          <tr>
            <th scope="col" aria-label="–ü–æ–∑–∏—Ü–∏—è">#</th>
            <th scope="col">–ò–≥—Ä–æ–∫</th>
            <th scope="col" style="text-align:right;">OVR</th>
          </tr>
        </thead>
        <tbody id="stats-body"></tbody>
      </table>
    </div>
  </section>
</main>

<!-- Player Modal -->
<div class="modal-overlay" id="playerModal" role="dialog" aria-modal="true" aria-labelledby="m-name" onclick="if(event.target === this) closeModal('playerModal')">
  <div class="modal-content" id="stats-card" onclick="event.stopPropagation()" role="document">
    <div class="modal-header-fixed">
      <button id="download-card" class="download-circle" aria-label="–°–∫–∞—á–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –∏–≥—Ä–æ–∫–∞">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
      </button>
      <button class="modal-close" onclick="closeModal('playerModal')" aria-label="–ó–∞–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –∏–≥—Ä–æ–∫–∞">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <div id="m-img-container">
      <img id="m-img" src="" alt="–§–æ—Ç–æ –∏–≥—Ä–æ–∫–∞" crossorigin="anonymous" onload="this.classList.add('loaded')">
    </div>
    
    <div class="modal-header">
      <div class="modal-title-group">
        <span id="m-role">ROLE</span>
        <h2 id="m-name">NAME</h2>
        <div id="m-badges" role="list" aria-label="–ë–µ–π–¥–∂–∏ –∏–≥—Ä–æ–∫–∞"></div>
      </div>
      <div id="m-ovr" aria-label="–û–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥">99</div>
    </div>
    
    <div id="m-stats" role="region" aria-label="–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏–≥—Ä–æ–∫–∞"></div>
    
    <div style="display:flex; gap:12px; flex-wrap:wrap;">
      <button class="btn btn-primary" style="flex:1; min-width:140px;" onclick="copyPlayerID()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID</button>
      <button class="btn btn-outline" style="flex:1; min-width:140px;" onclick="sharePlayer()">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
    </div>
  </div>
</div>

<!-- Apply Modal -->
<div class="modal-overlay" id="applyModal" role="dialog" aria-modal="true" aria-labelledby="apply-title" onclick="if(event.target === this) closeModal('applyModal')">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header-fixed">
      <button class="modal-close" onclick="closeModal('applyModal')" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <h2 id="apply-title" style="font-size:1.75rem; margin:60px 0 16px; line-height:1.2;">–í–°–¢–£–ü–ò–¢–¨ –í BOX1V1</h2>
    <p style="margin-bottom:32px; color:var(--text-secondary); line-height:1.6;">–ß—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞—è–≤–∫—É, –æ—Å—Ç–∞–≤—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ–¥ –ª—é–±—ã–º –ø–æ—Å—Ç–æ–º —Å —Ö–µ—à—Ç–µ–≥–æ–º <strong style="color:var(--text);">#BOX–£–ß–ê–°–¢–í–û–í–ê–¢–¨</strong>.</p>
    <button class="btn btn-primary" style="width:100%;" onclick="openTelegram()">–û—Ç–∫—Ä—ã—Ç—å Telegram</button>
  </div>
</div>

<!-- Rules Modal -->
<div class="modal-overlay" id="rulesModal" role="dialog" aria-modal="true" aria-labelledby="rules-title" onclick="if(event.target === this) closeModal('rulesModal')">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header-fixed">
      <button class="modal-close" onclick="closeModal('rulesModal')" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <h2 id="rules-title" style="font-size:1.75rem; margin:60px 0 32px; line-height:1.2;">–†–ï–ì–õ–ê–ú–ï–ù–¢</h2>
    <div style="display:flex; flex-direction:column; gap:24px;">
      <article style="padding-bottom:24px; border-bottom:1px solid var(--border);">
        <h3 style="font-size:12px; font-weight:800; text-transform:uppercase; color:var(--accent); margin-bottom:8px; letter-spacing:0.1em;">01. –§–æ—Ä–º–∞—Ç</h3>
        <p style="color:var(--text-secondary); line-height:1.6; margin:0;">–ú–∞—Ç—á–∏ 1 –Ω–∞ 1 —Å —É—á–∞—Å—Ç–∏–µ–º –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–≥–æ –≤—Ä–∞—Ç–∞—Ä—è.</p>
      </article>
      <article style="padding-bottom:24px; border-bottom:1px solid var(--border);">
        <h3 style="font-size:12px; font-weight:800; text-transform:uppercase; color:var(--accent); margin-bottom:8px; letter-spacing:0.1em;">02. –¢–∞–π–º–∏–Ω–≥</h3>
        <p style="color:var(--text-secondary); line-height:1.6; margin:0;">–õ–∏–º–∏—Ç –Ω–∞ –∞—Ç–∞–∫—É ‚Äî 20 —Å–µ–∫—É–Ω–¥.</p>
      </article>
      <article>
        <h3 style="font-size:12px; font-weight:800; text-transform:uppercase; color:var(--accent); margin-bottom:8px; letter-spacing:0.1em;">03. –†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
        <p style="color:var(--text-secondary); line-height:1.6; margin:0;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã –¥–æ –¥–≤—É—Ö –≥–æ–ª–æ–≤, –±–µ–∑ –Ω–∏—á—å–∏.</p>
      </article>
    </div>
  </div>
</div>

<!-- –°–∫—Ä—ã—Ç—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ -->
<div id="screenshot-container" aria-hidden="true"></div>

<script>
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vREjbeB6jNrU01kw1npVtFTvqGdP134ERjmyROoOYeYXbzjgL0ZCNK6KwF0VTk3c1yxZEZEUsJjy2Ur/pub?output=csv';
const TARGET_DATE = new Date("March 1, 2026 00:00:00").getTime();

let allPlayers = [];
let currentRoleFilter = '–í—Å–µ';
let renderTimeout;
let lastFocusedElement = null;
let statAnimationTimers = [];
let focusTrapHandler = null;
let escapeHandler = null;

const statDefs = {
  'DRI': '–¢–µ—Ö–Ω–∏–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –º—è—á–∞ –∏ –≤–µ–¥–µ–Ω–∏—è –¥—Ä–∏–±–ª–∏–Ω–≥–∞',
  'SPD': '–°—Ç–∞—Ä—Ç–æ–≤—ã–π —Ä—ã–≤–æ–∫ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è',
  'SHT': '–ú–æ—â–Ω–æ—Å—Ç—å –∏ —Ç–æ—á–Ω–æ—Å—Ç—å –∑–∞–≤–µ—Ä—à–∞—é—â–µ–≥–æ —É–¥–∞—Ä–∞',
  'PHY': '–§–∏–∑–∏—á–µ—Å–∫–∞—è –º–æ—â—å, –±–æ—Ä—å–±–∞ –∏ –∞—Ç–ª–µ—Ç–∏–∑–º',
  'REF': '–ú–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —É–¥–∞—Ä—ã –≤ —É–ø–æ—Ä',
  'DIV': '–î–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä—ã–∂–∫–∞ –∏ –æ—Ö–≤–∞—Ç —Å—Ç–≤–æ—Ä–∞ –≤–æ—Ä–æ—Ç',
  'HAN': '–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Ñ–∏–∫—Å–∞—Ü–∏–∏ –∏ –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –º—è—á–∞',
  'POS': '–ì—Ä–∞–º–æ—Ç–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ–∑–∏—Ü–∏–∏ –≤ —Å—Ç–≤–æ—Ä–µ –≤–æ—Ä–æ—Ç'
};

const $ = (selector) => document.querySelector(selector);
const $$ = (selector) => document.querySelectorAll(selector);

function showToast(message, duration = 3000) {
  const container = $('#toast-container');
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.textContent = message;
  toast.setAttribute('role', 'status');
  container.appendChild(toast);
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateY(20px)';
    setTimeout(() => toast.remove(), 500);
  }, duration);
}

function announceToScreenReader(message) {
  const region = $('#search-live-region');
  region.textContent = message;
  setTimeout(() => { region.textContent = ''; }, 1000);
}

function parseCSV(text) {
  const lines = text.replace(/\r/g, '').split('\n').filter(r => r.trim());
  if (lines.length < 2) return [];
  
  const result = [];
  for (let i = 1; i < lines.length; i++) {
    const row = lines[i];
    const cells = [];
    let cell = '';
    let inQuotes = false;
    
    for (let j = 0; j < row.length; j++) {
      const char = row[j];
      const nextChar = row[j + 1];
      
      if (char === '"') {
        if (inQuotes && nextChar === '"') {
          cell += '"';
          j++;
        } else {
          inQuotes = !inQuotes;
        }
      } else if (char === ',' && !inQuotes) {
        cells.push(cell.trim());
        cell = '';
      } else {
        cell += char;
      }
    }
    cells.push(cell.trim());
    
    if (cells[0]) {
      result.push({
        name: cells[0] || '',
        ovr: parseInt(cells[1]) || 0,
        role: cells[2] || '–ò–≥—Ä–æ–∫',
        drib: parseInt(cells[3]) || 0,
        speed: parseInt(cells[4]) || 0,
        shot: parseInt(cells[5]) || 0,
        phys: parseInt(cells[6]) || 0,
        photo: cells[7] || 'https://via.placeholder.com/400x600?text=No+Photo',
        status: cells[8] || '',
        badges: cells[9] ? cells[9].split('|').map(b => b.trim()).filter(Boolean) : []
      });
    }
  }
  return result;
}

async function init() {
  try {
    const response = await fetch(CSV_URL);
    if (!response.ok) throw new Error('Network error');
    const text = await response.text();
    allPlayers = parseCSV(text);
    
    if (allPlayers.length === 0) {
      showToast('–†–æ—Å—Ç–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—É—Å—Ç');
    } else {
      renderRoster();
      renderStats();
    }
    
    handleHashAndDeepLink();
    updateTimer();
    setInterval(updateTimer, 1000);
    setupDownloadButton();
    setupScrollDetection();
    
    setTimeout(() => $('#preloader').classList.add('loaded'), 500);
  } catch (error) {
    console.error('Init error:', error);
    showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
    $('#preloader').classList.add('loaded');
  }
}

function handleHashAndDeepLink() {
  const hash = window.location.hash;
  if (!hash) return;
  const [hashPart, queryPart] = hash.split('?');
  const cleanHash = hashPart.replace('#', '');
  if (['home', 'roster', 'stats'].includes(cleanHash)) {
    switchTab(cleanHash, false);
  }
  if (queryPart) {
    const params = new URLSearchParams(queryPart);
    const playerName = params.get('player');
    if (playerName) {
      const name = playerName.replace(/-/g, ' ');
      const player = allPlayers.find(p => p.name.toLowerCase() === name.toLowerCase());
      if (player) setTimeout(() => openPlayerModal(player.name), 300);
    }
  }
}

function switchTab(id, updateHash = true) {
  const target = $(`#${id}`);
  if (!target) return;
  $$('section').forEach(s => {
    s.classList.remove('active');
    s.setAttribute('aria-hidden', 'true');
  });
  $$('.nav-links a').forEach(a => {
    a.classList.remove('active');
    a.removeAttribute('aria-current');
  });
  target.classList.add('active');
  target.removeAttribute('aria-hidden');
  const btn = $(`#btn-${id}`);
  if (btn) {
    btn.classList.add('active');
    btn.setAttribute('aria-current', 'page');
  }
  if (updateHash) {
    const currentHash = window.location.hash;
    const [path] = currentHash.split('?');
    const query = currentHash.includes('?') ? '?' + currentHash.split('?')[1] : '';
    window.history.pushState(null, null, `#${id}${query}`);
  }
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function renderRoster() {
  const grid = $('#roster-grid');
  const search = $('#playerSearch').value.toLowerCase().trim();
  const filtered = allPlayers.filter(p => {
    const matchesSearch = p.name.toLowerCase().includes(search);
    const matchesRole = currentRoleFilter === '–í—Å–µ' || p.role === currentRoleFilter;
    return matchesSearch && matchesRole;
  });
  
  announceToScreenReader(`–ù–∞–π–¥–µ–Ω–æ –∏–≥—Ä–æ–∫–æ–≤: ${filtered.length}`);
  
  if (filtered.length === 0) {
    grid.innerHTML = `<div style="grid-column: 1/-1; padding: 60px 20px; text-align: center; color: var(--text-secondary);"><p style="font-size: 1.125rem;">–ê—Ç–ª–µ—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p><p style="font-size: 0.875rem; margin-top: 8px;">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p></div>`;
    return;
  }
  
  grid.innerHTML = filtered.map((p, i) => `
    <div class="card player-card" tabindex="0" role="button" aria-label="–ö–∞—Ä—Ç–æ—á–∫–∞ –∏–≥—Ä–æ–∫–∞ ${p.name}, —Ä–µ–π—Ç–∏–Ω–≥ ${p.ovr}"
         style="animation: fadeIn 0.5s ${i * 0.05}s forwards; opacity: 0;"
         onclick="openPlayerModal('${p.name.replace(/'/g, "\\'")}')"
         onkeydown="handlePlayerCardKeydown(event, '${p.name.replace(/'/g, "\\'")}')">
      <div class="player-img" style="background-image: url('${p.photo}')" aria-hidden="true"></div>
      ${p.status ? `<div style="position:absolute; top:20px; right:20px; z-index:3; background:var(--accent); color:#fff; font-size:10px; font-weight:800; padding:6px 12px; border-radius:20px; text-transform:uppercase; letter-spacing:0.05em; box-shadow:0 4px 12px rgba(0,0,0,0.2);">${p.status}</div>` : ''}
      <div class="player-info">
        <span>${p.role}</span>
        <h3>${p.name}</h3>
        ${p.badges.length > 0 ? `<div class="player-badges">${p.badges[0]}</div>` : ''}
        <span class="ovr-badge">OVR ${p.ovr}</span>
      </div>
    </div>
  `).join('');
}

function handlePlayerCardKeydown(event, name) {
  if (event.key === 'Enter' || event.key === ' ') {
    event.preventDefault();
    openPlayerModal(name);
  }
}

function renderStats() {
  const sorted = [...allPlayers].sort((a, b) => b.ovr - a.ovr);
  $('#stats-body').innerHTML = sorted.map((p, i) => `
    <tr onclick="openPlayerModal('${p.name.replace(/'/g, "\\'")}')" tabindex="0" role="button" aria-label="${i + 1} –º–µ—Å—Ç–æ, ${p.name}, ${p.role}, —Ä–µ–π—Ç–∏–Ω–≥ ${p.ovr}"
        onkeydown="if(event.key === 'Enter') openPlayerModal('${p.name.replace(/'/g, "\\'")}')"
        style="animation: fadeIn 0.3s ${i * 0.03}s forwards; opacity: 0;">
      <td style="font-weight:800; color:var(--text-tertiary); font-variant-numeric: tabular-nums;">${(i + 1).toString().padStart(2, '0')}</td>
      <td>
        <div class="player-row">
          <img src="${p.photo}" alt="" class="player-avatar-sm" loading="lazy" onerror="this.src='https://via.placeholder.com/100?text=?'" crossorigin="anonymous">
          <div class="player-info-sm">
            <div class="player-name-sm">${p.name}</div>
            <div class="player-role-sm">${p.role}</div>
          </div>
        </div>
      </td>
      <td style="text-align:right;"><span class="ovr-badge" style="margin:0;">${p.ovr}</span></td>
    </tr>
  `).join('');
}

function openPlayerModal(name) {
  statAnimationTimers.forEach(clearTimeout);
  statAnimationTimers = [];
  
  const p = allPlayers.find(x => x.name.toLowerCase() === name.toLowerCase());
  if (!p) { showToast('–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω'); return; }
  
  lastFocusedElement = document.activeElement;
  $('#m-name').textContent = p.name;
  $('#m-role').textContent = p.role;
  $('#m-ovr').textContent = p.ovr;
  
  const imgEl = $('#m-img');
  imgEl.classList.remove('loaded');
  imgEl.setAttribute('data-original', p.photo);
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–∫—Å–∏ –¥–ª—è CORS
  const proxiedUrl = p.photo.startsWith('http') && !p.photo.includes('localhost') 
    ? `https://images.weserv.nl/?url=${encodeURIComponent(p.photo)}&default=${encodeURIComponent(p.photo)}`
    : p.photo;
  imgEl.src = proxiedUrl;
  
  $('#m-badges').innerHTML = p.badges.map(b => `<span class="badge" role="listitem">${b}</span>`).join('');
  
  const isGK = p.role === '–í—Ä–∞—Ç–∞—Ä—å';
  const stats = [
    { key: isGK ? 'REF' : 'DRI', value: p.drib },
    { key: isGK ? 'DIV' : 'SPD', value: p.speed },
    { key: isGK ? 'HAN' : 'SHT', value: p.shot },
    { key: isGK ? 'POS' : 'PHY', value: p.phys }
  ];
  
  $('#m-stats').innerHTML = stats.map(s => `
    <div class="stat-item">
      <div class="stat-header">
        <div class="stat-label-group" data-tooltip="${statDefs[s.key]}" tabindex="0" role="tooltip" aria-label="${statDefs[s.key]}">
          <span class="stat-label">${s.key}</span>
          <i class="info-icon" aria-hidden="true">?</i>
        </div>
        <span class="stat-value">${s.value}</span>
      </div>
      <div class="stat-bar-bg" aria-hidden="true">
        <div class="stat-bar-fill ${s.value >= 90 ? 'accent' : ''}" id="bar-${s.key}" style="width: 0%" data-width="${s.value}%"></div>
      </div>
    </div>
  `).join('');
  
  openModal('playerModal');
  
  stats.forEach((s, index) => {
    const timer = setTimeout(() => {
      const bar = $(`#bar-${s.key}`);
      if (bar) bar.style.width = bar.getAttribute('data-width');
    }, 100 + (index * 50));
    statAnimationTimers.push(timer);
  });
  
  const currentTab = $('section.active')?.id || 'home';
  const slug = p.name.replace(/\s+/g, '-').toLowerCase();
  window.history.replaceState(null, null, `#${currentTab}?player=${slug}`);
}

function openModal(id) {
  const modal = $(`#${id}`);
  if (!modal) return;
  
  cleanupModalHandlers(modal);
  
  modal.classList.add('active');
  document.body.style.overflow = 'hidden';
  
  const content = modal.querySelector('.modal-content');
  if (content) {
    focusTrapHandler = createFocusTrap(content);
    document.addEventListener('keydown', focusTrapHandler);
  }
  
  escapeHandler = (e) => {
    if (e.key === 'Escape' && modal.classList.contains('active')) {
      closeModal(id);
    }
  };
  document.addEventListener('keydown', escapeHandler);
  modal._escapeHandler = escapeHandler;
  modal._focusTrapHandler = focusTrapHandler;
  
  setTimeout(() => {
    const focusable = modal.querySelector('button, [href], input, [tabindex]:not([tabindex="-1"])');
    if (focusable) focusable.focus();
  }, 100);
}

function cleanupModalHandlers(modal) {
  if (modal._escapeHandler) {
    document.removeEventListener('keydown', modal._escapeHandler);
    modal._escapeHandler = null;
  }
  if (modal._focusTrapHandler) {
    document.removeEventListener('keydown', modal._focusTrapHandler);
    modal._focusTrapHandler = null;
  }
}

function createFocusTrap(element) {
  const focusableElements = element.querySelectorAll('button, [href], input, select, [tabindex]:not([tabindex="-1"])');
  const firstFocusable = focusableElements[0];
  const lastFocusable = focusableElements[focusableElements.length - 1];
  
  return function(e) {
    if (e.key !== 'Tab') return;
    
    if (e.shiftKey) {
      if (document.activeElement === firstFocusable) {
        lastFocusable.focus();
        e.preventDefault();
      }
    } else {
      if (document.activeElement === lastFocusable) {
        firstFocusable.focus();
        e.preventDefault();
      }
    }
  };
}

function closeModal(id) {
  const modal = $(`#${id}`);
  if (!modal) return;
  
  statAnimationTimers.forEach(clearTimeout);
  statAnimationTimers = [];
  
  cleanupModalHandlers(modal);
  
  modal.classList.remove('active');
  document.body.style.overflow = '';
  
  if (lastFocusedElement) { 
    lastFocusedElement.focus(); 
    lastFocusedElement = null; 
  }
  
  if (id === 'playerModal') {
    const currentTab = $('section.active')?.id || 'home';
    window.history.replaceState(null, null, `#${currentTab}`);
  }
}

function setRoleFilter(role, btn) {
  currentRoleFilter = role;
  $$('.filter-btn').forEach(b => { 
    b.classList.remove('active'); 
    b.setAttribute('aria-pressed', 'false'); 
  });
  btn.classList.add('active');
  btn.setAttribute('aria-pressed', 'true');
  renderRoster();
}

function debouncedRender() {
  clearTimeout(renderTimeout);
  renderTimeout = setTimeout(renderRoster, 150);
}

function toggleMenu() {
  const drawer = $('#mobile-drawer');
  const overlay = $('#drawer-overlay');
  const burger = $('#burger');
  const isOpen = drawer.classList.toggle('open');
  overlay.classList.toggle('open');
  burger.classList.toggle('open');
  burger.setAttribute('aria-expanded', isOpen);
  if (isOpen) {
    document.body.style.overflow = 'hidden';
    setTimeout(() => drawer.querySelector('a')?.focus(), 100);
  } else {
    document.body.style.overflow = '';
    if (lastFocusedElement) lastFocusedElement.focus();
  }
}

function handleMobileNav(id, isModal = false) {
  toggleMenu();
  setTimeout(() => isModal ? openModal(id) : switchTab(id), 300);
}

function openApplyModal() {
  const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
  if (isMobile) {
    window.location.href = 'tg://resolve?domain=streetbox1v1';
    setTimeout(() => {
      openModal('applyModal');
    }, 1000);
  } else {
    openModal('applyModal');
  }
}

function openTelegram() {
  window.open('https://t.me/streetbox1v1', '_blank');
}

async function copyPlayerID() {
  const name = $('#m-name').textContent;
  try {
    await navigator.clipboard.writeText(name);
    showToast('ID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω');
  } catch { 
    showToast('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å'); 
  }
}

async function sharePlayer() {
  const name = $('#m-name').textContent;
  const url = window.location.href;
  
  const shareData = { 
    title: `BOX1V1 | ${name}`, 
    text: `–ö–∞—Ä—Ç–æ—á–∫–∞ –∞—Ç–ª–µ—Ç–∞ ${name} –≤ —Å–∏—Å—Ç–µ–º–µ BOX1V1`, 
    url: url 
  };
  
  if (navigator.share) {
    try {
      await navigator.share(shareData);
    } catch (err) { 
      if (err.name !== 'AbortError' && err.name !== 'NotAllowedError') {
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ');
      } else if (err.name === 'NotAllowedError') {
        fallbackShare(url);
      }
    }
  } else {
    fallbackShare(url);
  }
}

function fallbackShare(url) {
  try {
    navigator.clipboard.writeText(url);
    showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞');
  } catch { 
    showToast('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É'); 
  }
}

// –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫
function setupDownloadButton() {
  const btn = $('#download-card');
  if (!btn || btn.dataset.initialized) return;
  btn.dataset.initialized = 'true';
  
  btn.addEventListener('click', async (e) => {
    e.preventDefault();
    e.stopPropagation();
    
    btn.style.opacity = '0.5';
    btn.disabled = true;
    btn.style.transform = 'scale(0.95)';
    showToast('–°–æ–∑–¥–∞—ë–º –∫–∞—Ä—Ç–æ—á–∫—É...', 3000);
    
    try {
      // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      const img = $('#m-img');
      if (!img.complete || !img.classList.contains('loaded')) {
        await new Promise((resolve) => {
          const checkLoaded = () => {
            if (img.complete && img.classList.contains('loaded')) {
              resolve();
            } else {
              setTimeout(checkLoaded, 100);
            }
          };
          checkLoaded();
          setTimeout(resolve, 5000); // timeout 5s
        });
      }
      
      // –°–æ–∑–¥–∞–µ–º –∫–ª–æ–Ω –≤ —Å–∫—Ä—ã—Ç–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞
      const originalCard = $('#stats-card');
      const container = $('#screenshot-container');
      container.innerHTML = '';
      
      // –ö–ª–æ–Ω–∏—Ä—É–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
      const clone = originalCard.cloneNode(true);
      clone.style.position = 'static';
      clone.style.maxHeight = 'none';
      clone.style.overflow = 'visible';
      clone.style.transform = 'none';
      clone.style.width = '520px';
      clone.style.background = 'white';
      
      // –£–±–∏—Ä–∞–µ–º –∫–Ω–æ–ø–∫–∏ –∏–∑ –∫–ª–æ–Ω–∞
      const buttons = clone.querySelector('.modal-header-fixed');
      if (buttons) buttons.remove();
      
      // –§–∏–∫—Å–∏—Ä—É–µ–º —à–∏—Ä–∏–Ω—É —Å—Ç–∞—Ç–æ–≤ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞
      const bars = clone.querySelectorAll('.stat-bar-fill');
      bars.forEach(bar => {
        const width = bar.getAttribute('data-width');
        bar.style.width = width;
      });
      
      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ - –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ dataURL –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
      const cloneImg = clone.querySelector('#m-img');
      if (cloneImg && img.complete) {
        try {
          // –°–æ–∑–¥–∞–µ–º canvas –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ dataURL (–æ–±—Ö–æ–¥ CORS)
          const canvas = document.createElement('canvas');
          canvas.width = img.naturalWidth || 400;
          canvas.height = img.naturalHeight || 400;
          const ctx = canvas.getContext('2d');
          
          // –†–∏—Å—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          const dataUrl = canvas.toDataURL('image/png');
          cloneImg.src = dataUrl;
        } catch (e) {
          console.log('CORS image handling failed, using original');
        }
      }
      
      container.appendChild(clone);
      
      // –î–∞–µ–º –±—Ä–∞—É–∑–µ—Ä—É –≤—Ä–µ–º—è –Ω–∞ —Ä–µ–Ω–¥–µ—Ä
      await new Promise(resolve => setTimeout(resolve, 300));
      
      // –†–µ–Ω–¥–µ—Ä–∏–º html2canvas
      const canvas = await html2canvas(clone, {
        scale: 2,
        useCORS: true,
        allowTaint: true,
        backgroundColor: '#ffffff',
        logging: false,
        width: 520,
        height: clone.offsetHeight,
        windowWidth: 520,
        windowHeight: clone.offsetHeight,
        onclone: (clonedDoc) => {
          // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–ª–æ–Ω–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
          const clonedImg = clonedDoc.querySelector('#m-img');
          if (clonedImg) clonedImg.style.opacity = '1';
        }
      });
      
      // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
      container.innerHTML = '';
      
      const playerName = $('#m-name')?.textContent || 'player';
      const safeName = playerName.replace(/[^a-zA-Z–∞-—è–ê-–Ø0-9]/g, '_');
      const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png', 1.0));
      
      if (!blob) throw new Error('Canvas to Blob failed');
      
      const file = new File([blob], `BOX1V1_${safeName}.png`, { type: 'image/png' });
      
      // –ü—Ä–æ–±—É–µ–º Web Share API —Å —Ñ–∞–π–ª–∞–º–∏
      if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
        try {
          await navigator.share({ 
            files: [file], 
            title: `BOX1V1 ${playerName}`, 
            text: '–ö–∞—Ä—Ç–æ—á–∫–∞ –∏–≥—Ä–æ–∫–∞' 
          });
          showToast('–ì–æ—Ç–æ–≤–æ!');
          resetBtn();
          return;
        } catch (err) {
          if (err.name === 'AbortError') { 
            resetBtn(); 
            return; 
          }
          // –ï—Å–ª–∏ share –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, —Å–∫–∞—á–∏–≤–∞–µ–º
        }
      }
      
      // Fallback: —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `BOX1V1_${safeName}.png`;
      document.body.appendChild(link);
      link.click();
      
      setTimeout(() => {
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      }, 100);
      
      showToast('–ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
      
    } catch (error) {
      console.error('Download error:', error);
      showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
    } finally {
      resetBtn();
    }
    
    function resetBtn() {
      btn.style.opacity = '';
      btn.disabled = false;
      btn.style.transform = '';
    }
  });
}

function updateTimer() {
  const now = Date.now();
  const diff = TARGET_DATE - now;
  
  if (diff <= 0) {
    $('#timer-status').textContent = '–°–µ–∑–æ–Ω –æ—Ç–∫—Ä—ã—Ç!';
    $('#timer').style.display = 'none';
    return;
  }
  
  const days = Math.floor(diff / 86400000);
  const hours = Math.floor((diff % 86400000) / 3600000);
  const mins = Math.floor((diff % 3600000) / 60000);
  const secs = Math.floor((diff % 60000) / 1000);
  
  $('#days').textContent = days.toString().padStart(2, '0');
  $('#hours').textContent = hours.toString().padStart(2, '0');
  $('#mins').textContent = mins.toString().padStart(2, '0');
  $('#secs').textContent = secs.toString().padStart(2, '0');
}

function setupScrollDetection() {
  let ticking = false;
  window.addEventListener('scroll', () => {
    if (!ticking) {
      window.requestAnimationFrame(() => {
        $('#navbar').classList.toggle('scrolled', window.scrollY > 50);
        ticking = false;
      });
      ticking = true;
    }
  }, { passive: true });
}

window.addEventListener('DOMContentLoaded', init);
window.addEventListener('hashchange', handleHashAndDeepLink);
</script>
</body>
</html>
